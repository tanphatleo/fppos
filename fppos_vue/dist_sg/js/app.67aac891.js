(function(){"use strict";var e={3864:function(e,t,a){var l=a(5130),s=a(6768);function o(e,t,a,l,o,n){const i=(0,s.g2)("LoadingOverlay"),r=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)(s.FK,null,[l.store.getters.isLoading?((0,s.uX)(),(0,s.Wv)(i,{key:0})):(0,s.Q3)("",!0),(0,s.bF)(r)],64)}a(4114);var n=a(782),i=a(8728),r=a(4373);const c={key:0,class:"loading-overlay"};function u(e,t,a,l,o,n){return e.isLoading?((0,s.uX)(),(0,s.CE)("div",c,[...t[0]||(t[0]=[(0,s.Lk)("div",{class:"spinner"},null,-1)])])):(0,s.Q3)("",!0)}var d={name:"LoadingOverlay",computed:{...(0,n.L8)(["isLoading"])}},p=a(1241);const m=(0,p.A)(d,[["render",u],["__scopeId","data-v-14c58e71"]]);var v=m;r.A.defaults.baseURL="https://fitpackvnapi.fitpack.io.vn/api/v1";var h={name:"App",components:{LoadingOverlay:v},setup(){const e=(0,n.Pj)(),t=(0,i.rd)(),a=async()=>{try{const t=await r.A.get("/who_i_am/"),a=t.data.usergroups||[],l=a.includes("admin");e.dispatch("setUserAdmin",l);const s=a.includes("super_user");e.dispatch("setUserSuperadmin",s),e.dispatch("setUserName",t.data.username||"")}catch(a){console.error("Invalid token:",a),e.dispatch("removeToken"),t.push("/signin")}};return e.dispatch("checkAuthentication").then(()=>{if(e.getters.isAuthenticated){const t=e.getters.getToken;r.A.defaults.headers.common["Authorization"]=`Bearer ${t}`,a(),e.commit("setLoading",!1)}else t.push("/signin"),e.commit("setLoading",!1)}),{store:e}}};const k=(0,p.A)(h,[["render",o]]);var g=k,b=a(6169),f=(a(5524),a(901)),L=a(4597),y=a(4232);const w={style:{height:"100%"}},_={class:"home-page",style:{height:"100%"}},C={class:"page-header"},x={class:"header-left"},S={class:"col-left-control"},E={class:"product-search"},A={class:"product-search-results"},T=["data-product-id","onMousedown"],P={class:"suggestions-item-info"},D={class:"number-blue"},I={class:"suggestions-item-info"},K={class:"carts-tab"},R={class:"pending-sales-list"},V=["data-sale-id","onClick"],N={class:"header-right"},X={class:"user-name"},F={class:"user-name"},U={class:"menu-toggle"},O={class:"body-page"},W={class:"detail-box"},q={class:"shortcut-box"},Q={class:"shortcut-box-header"},J={class:"search_filter-control"},M={class:"customer-search-results is-hidden"},$=["id","onMousedown"],B={class:"suggestions-item"},H={class:"suggestions-item-info"},j={class:"number-blue"},G={class:"suggestions-item-info"},z={class:"product-short-list"},Y={class:"product-grid-container"},Z={class:"product-list"},ee=["data-product-id","onClick"],te={class:"product-card-bottom"},ae={class:"product-name"},le={class:"product-price no-select"},se={class:"payment-action no-select"},oe=["disabled"];function ne(e,t,a,l,o,n){const i=(0,s.g2)("menu_toggle"),r=(0,s.g2)("Carts"),c=(0,s.g2)("AddCust"),u=(0,s.g2)("ProfuctFilterCate"),d=(0,s.g2)("Payment"),p=(0,s.g2)("AddEditTrans");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",w,[(0,s.Lk)("div",_,[(0,s.Lk)("div",C,[(0,s.Lk)("div",x,[(0,s.Lk)("div",S,[(0,s.Lk)("div",E,[t[17]||(t[17]=(0,s.Lk)("i",{class:"fas fa-search"},null,-1)),(0,s.Lk)("input",{class:"product-search-input c-input",placeholder:"Tìm hàng hóa",onFocus:t[0]||(t[0]=(...e)=>n.search_input_focus&&n.search_input_focus(...e)),onBlur:t[1]||(t[1]=(...e)=>n.search_input_blur&&n.search_input_blur(...e)),onInput:t[2]||(t[2]=(...e)=>n.search_input_change&&n.search_input_change(...e))},null,32),t[18]||(t[18]=(0,s.Lk)("div",{class:"place-holder"},null,-1)),(0,s.Lk)("div",A,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredProducts,e=>((0,s.uX)(),(0,s.CE)("ul",{key:e.id},[(0,s.Lk)("li",{class:"suggestions-item","data-product-id":e.id,onMousedown:t=>n.add_product(e)},[(0,s.Lk)("div",P,[(0,s.Lk)("h5",null,[(0,s.Lk)("b",null,(0,y.v_)(e.name),1)]),(0,s.Lk)("div",D,(0,y.v_)(n.formatPrice(e.price)),1)]),(0,s.Lk)("div",I,(0,y.v_)(e.code),1)],40,T)]))),128))])]),(0,s.Lk)("div",K,[(0,s.Lk)("ul",R,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.localPendingSales,(e,a)=>((0,s.uX)(),(0,s.CE)("li",{key:e.id,"data-sale-id":e.id,class:(0,y.C4)(["pending-sales-item",{selected:0===a}]),onClick:t=>n.select_pending_invoice(e.id,t)},[(0,s.Lk)("h5",null," Hóa đơn "+(0,y.v_)(e.id),1),(0,s.Lk)("i",{class:"fa fa-times",onClick:t[3]||(t[3]=(...e)=>n.remove_pending_sale&&n.remove_pending_sale(...e))})],10,V))),128)),(0,s.Lk)("li",{class:"new_pending_sale pending-sales-item",onClick:t[4]||(t[4]=(...e)=>n.add_new_pending_sale&&n.add_new_pending_sale(...e))},[...t[19]||(t[19]=[(0,s.Lk)("h5",null," Đơn mới ",-1)])])])])]),t[20]||(t[20]=(0,s.Lk)("div",{class:"header-left-info"},null,-1))]),(0,s.Lk)("div",N,[(0,s.Lk)("div",X,(0,y.v_)(this.branch),1),(0,s.Lk)("div",F,(0,y.v_)(this.user),1),t[21]||(t[21]=(0,s.Lk)("div",{style:{"text-align":"center",margin:"1rem 0"}},null,-1)),(0,s.Lk)("div",U,[(0,s.bF)(i,{onMenuAction:n.handleMenuAction},null,8,["onMenuAction"])])])]),(0,s.Lk)("div",O,[(0,s.Lk)("div",W,[(0,s.bF)(r,{focus_invoice:o.focus_invoice,onUpdateInvoice:n.handleUpdateItem},null,8,["focus_invoice","onUpdateInvoice"])]),(0,s.Lk)("div",q,[(0,s.Lk)("div",Q,[(0,s.Lk)("div",J,[(0,s.Lk)("div",{class:(0,y.C4)(["customer-search",{"is-hidden":o.focus_invoice&&o.focus_invoice.customer}])},[t[22]||(t[22]=(0,s.Lk)("i",{class:"fas fa-search"},null,-1)),(0,s.Lk)("input",{class:"customer-search-input c-input",placeholder:"Tìm khách hàng",onFocus:t[5]||(t[5]=(...e)=>n.search_input_focus&&n.search_input_focus(...e)),onBlur:t[6]||(t[6]=(...e)=>n.search_input_cust_blur&&n.search_input_cust_blur(...e)),onInput:t[7]||(t[7]=(...e)=>n.search_input_change_cust&&n.search_input_change_cust(...e))},null,32),(0,s.Lk)("i",{class:"fas fa-plus add-cust",onClick:t[8]||(t[8]=e=>{this.editOrNew="new",o.isCustomerModalOpen=!0})}),t[23]||(t[23]=(0,s.Lk)("div",{class:"place-holder"},null,-1)),(0,s.Lk)("div",M,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredCust,e=>((0,s.uX)(),(0,s.CE)("ul",{key:e.id,id:"customer-"+e.id,onMousedown:t=>n.select_focus_customer(e)},[(0,s.Lk)("li",B,[(0,s.Lk)("div",H,[(0,s.Lk)("h5",null,[(0,s.Lk)("b",null,(0,y.v_)(e.name),1)]),(0,s.Lk)("div",j,(0,y.v_)(e.phone_number),1)]),(0,s.Lk)("div",G,(0,y.v_)(e.code),1)])],40,$))),128))])],2),(0,s.Lk)("div",{class:(0,y.C4)(["customer-selected",{"is-hidden":!o.focus_invoice||!o.focus_invoice.customer}])},[(0,s.Lk)("span",{class:"customer-search-input c-input edit-cust",onClick:t[9]||(t[9]=e=>{this.editOrNew="edit",o.isCustomerModalOpen=!0})},(0,y.v_)(o.focus_invoice&&o.focus_invoice.customer?o.focus_invoice.customer.name:""),1),(0,s.Lk)("i",{class:"fa fa-times add-cust",onClick:t[10]||(t[10]=(...e)=>n.remove_focus_customer&&n.remove_focus_customer(...e))}),t[24]||(t[24]=(0,s.Lk)("div",{class:"place-holder"},null,-1))],2)]),(0,s.Lk)("div",{class:"product-header-right",onClick:t[11]||(t[11]=e=>o.isFilterModalOpen=!0)},[...t[25]||(t[25]=[(0,s.Lk)("i",{class:"fas fa-list-ul no-select"},null,-1)])])]),(0,s.Lk)("div",z,[(0,s.Lk)("div",Y,[(0,s.Lk)("div",Z,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.products,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,"data-product-id":e.id,class:(0,y.C4)(["product-item is-hidden",{"is-not-hidden":e.is_active&&(0===o.productGroupFilter.length||o.productGroupFilter.includes(e.productGroup))&&(""===o.searchQuery||e.name.toLowerCase().includes(o.searchQuery)||e.code.toLowerCase().includes(o.searchQuery))}]),onClick:t=>n.add_product(e)},[t[26]||(t[26]=(0,s.Lk)("div",{class:"product-card-top"},[(0,s.Lk)("i",{class:"fas fa-image placeholder-icon"})],-1)),(0,s.Lk)("div",te,[(0,s.Lk)("h4",ae,(0,y.v_)(n.limit_text(e.name,25)),1),(0,s.Lk)("h4",le,(0,y.v_)(n.formatPrice(e.price)),1)])],10,ee))),128))])])]),(0,s.Lk)("div",se,[(0,s.Lk)("button",{class:"payment-button",disabled:!o.focus_invoice.totalItems,onClick:t[12]||(t[12]=(...e)=>n.openPaymentModal&&n.openPaymentModal(...e))}," Thanh toán ",8,oe)])])]),t[27]||(t[27]=(0,s.Lk)("div",{class:"page-footer no-select"},null,-1))])]),o.isCustomerModalOpen?((0,s.uX)(),(0,s.Wv)(c,{key:0,"current-branch":this.branch,customer:o.focus_invoice.customer,regionList:this.provinces,wardList:this.wards,type:this.editOrNew,onClose:t[13]||(t[13]=e=>o.isCustomerModalOpen=!1),onSave:e.handleCustomerSave},null,8,["current-branch","customer","regionList","wardList","type","onSave"])):(0,s.Q3)("",!0),o.isFilterModalOpen?((0,s.uX)(),(0,s.Wv)(u,{key:1,dataSource:this.productGroups,"onUpdate:visible":t[14]||(t[14]=e=>o.isFilterModalOpen=!1),onApply:n.applyProductFilter},null,8,["dataSource","onApply"])):(0,s.Q3)("",!0),o.isPaymentModalOpen?((0,s.uX)(),(0,s.Wv)(d,{key:2,visible:o.isPaymentModalOpen,"cart-data":this.focus_invoice,channels:this.channels,"default-surcharges":this.defaultSurcharges,"bank-accounts":this.bankAccounts,"transport-companies":this.transportCompanies,onClose:t[15]||(t[15]=e=>o.isPaymentModalOpen=!1),onUpdateCartData:n.handleUpdateItem,onCompletePayment:n.handleCompletePayment},null,8,["visible","cart-data","channels","default-surcharges","bank-accounts","transport-companies","onUpdateCartData","onCompletePayment"])):(0,s.Q3)("",!0),o.showAddEditTrans?((0,s.uX)(),(0,s.Wv)(p,{key:3,item:o.selectedTransItem,accounts:o.allAccounts,"transaction-types":o.transactionTypes,onClose:t[16]||(t[16]=e=>o.showAddEditTrans=!1),onSaved:n.onTransSaved},null,8,["item","accounts","transaction-types","onSaved"])):(0,s.Q3)("",!0)],64)}a(8111),a(2489),a(116),a(7588),a(1701),a(3110),a(8335);const ie={class:"menu-container"},re={class:"dropdown-trigger"},ce={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},ue={class:"dropdown-content"},de=["onClick"],pe={class:"icon-text"},me={class:"icon has-text-info"};function ve(e,t,a,o,n,i){const r=(0,s.gN)("click-outside");return(0,s.uX)(),(0,s.CE)("div",ie,[(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",{class:(0,y.C4)(["dropdown",{"is-active":n.isOpen}])},[(0,s.Lk)("div",re,[(0,s.Lk)("button",{class:"button",onClick:t[0]||(t[0]=e=>n.isOpen=!n.isOpen),"aria-haspopup":"true"},[...t[2]||(t[2]=[(0,s.Lk)("span",{class:"icon"},[(0,s.Lk)("i",{class:"fas fa-bars"})],-1)])])]),(0,s.Lk)("div",ce,[(0,s.Lk)("div",ue,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.menuItems,e=>((0,s.uX)(),(0,s.CE)("a",{key:e.text,href:"#",class:"dropdown-item",onClick:(0,l.D$)(t=>i.handleAction(e.action),["prevent"])},[(0,s.Lk)("span",pe,[(0,s.Lk)("span",me,[(0,s.Lk)("i",{class:(0,y.C4)(e.icon)},null,2)]),(0,s.Lk)("span",null,(0,y.v_)(e.text),1)])],8,de))),128)),t[4]||(t[4]=(0,s.Lk)("hr",{class:"dropdown-divider"},null,-1)),(0,s.Lk)("a",{class:"dropdown-item has-text-danger",onClick:t[1]||(t[1]=(0,l.D$)((...e)=>i.logout&&i.logout(...e),["prevent"]))},[...t[3]||(t[3]=[(0,s.Lk)("span",{class:"icon-text"},[(0,s.Lk)("span",{class:"icon"},[(0,s.Lk)("i",{class:"fas fa-sign-out-alt"})]),(0,s.Lk)("span",null,"Đăng xuất")],-1)])])])])],2)),[[r,i.closeMenu]])])}var he={name:"menu_toggle",props:{msg:String},emits:["menu-action"],data(){return{isOpen:!1,menuItems:[{text:"Quản lý",icon:"fas fa-chart-pie",action:"viewReport"},{text:"Lập phiếu thu",icon:"fas fa-edit",action:"receipt"},{text:"Lập phiếu chi",icon:"fas fa-edit",action:"payment"},{text:"Chốt hàng",icon:"fas fa-eye",action:"date_end_inventory"},{text:"Chốt tiền",icon:"fas fa-info-circle",action:"date_end_cash_balance"}]}},methods:{closeMenu(){this.isOpen=!1},handleAction(e){console.log("Triggered:",e),this.$emit("menu-action",e),this.isOpen=!1},logout(){this.$store.dispatch("removeToken"),this.$router.push("/signin")}}};const ke=(0,p.A)(he,[["render",ve],["__scopeId","data-v-27724d1a"]]);var ge=ke,be=a(144);const fe={class:"window-header"},Le={class:"window-title"},ye={class:"no-select"},we={class:"branch-info"},_e={class:"window-content"},Ce={class:"tabs-nav no-select"},xe={class:"form-body"},Se={key:0,class:"tab-pane"},Ee={class:"form-layout"},Ae={class:"col-left"},Te={class:"form-group"},Pe=["disabled"],De={class:"form-group"},Ie={class:"form-group"},Ke={class:"form-group"},Re={class:"form-group"},Ve={class:"autocomplete-wrapper"},Ne=["onMousedown"],Xe={class:"form-group"},Fe={class:"autocomplete-wrapper"},Ue=["disabled"],Oe=["onMousedown"],We={class:"col-right"},qe={class:"form-group"},Qe={class:"row-inputs"},Je={class:"gender-radios"},Me={class:"form-group"},$e={class:"form-group"},Be={class:"form-group"},He={class:"window-footer"},je=["disabled"];var Ge={__name:"AddCust",props:{currentBranch:{type:String,default:"Chi nhánh Gia"},customer:{type:Object,default:null},regionList:{type:Array,default:()=>[]},wardList:{type:Array,default:()=>[]},type:{type:String,default:"new"}},emits:["close","saved"],setup(e,{emit:t}){const a=(0,be.KR)("general"),o=t,n=e,i=()=>({code:"",name:"",phone_number:"",address:"",location:"",locationName:"",ward:null,ward_name:"",province:null,province_name:"",birthdate:"",gender:!0,email:"",facebook:"",comments:""});function c(e){let t=e.target.value;u.phone_number=t.replace(/[^0-9+\-()]/g,"")}const u=(0,be.Kh)(i()),d=(0,be.KR)(!1),p=(0,be.KR)(!1),m=(0,be.KR)(null),v=(0,be.KR)(null),h=(0,be.Kh)({top:"0px",left:"0px",width:"0px",display:"block"}),k=e=>{if(!e)return;const t=e.getBoundingClientRect();h.top=`${t.bottom+window.scrollY}px`,h.left=`${t.left+window.scrollX}px`,h.width=`${t.width}px`},g=e=>{d.value=!1,p.value=!1,(0,s.dY)(()=>{"location"===e?(console.log("Opening location dropdown"),k(m.value),d.value=!0):"ward"===e&&(k(v.value),p.value=!0)})},b=(0,s.EW)(()=>{const e=u.province_name?u.province_name.toLowerCase():"";return e?(n.regionList||[]).filter(t=>t.name.toLowerCase().includes(e)):n.regionList||[]});function f(e){u.province=e.id,u.province_name=e.name,u.ward=null,u.ward_name="",d.value=!1}function L(){u.ward_id=null,u.ward=""}const w=(0,s.EW)(()=>{const e=u.ward_name?u.ward_name.toLowerCase():"";let t=n.wardList||[];return u.province&&(t=t.filter(e=>e.province===u.province)),t.filter(t=>t.name.toLowerCase().includes(e))});function _(e){u.ward=e.id,u.ward_name=e.name,p.value=!1}function C(e){setTimeout(()=>{"location"===e&&(d.value=!1),"ward"===e&&(p.value=!1)},200)}const x=async()=>{const e={...u};"edit"===n.type?(delete e.province_name,delete e.ward_name,await r.A.put(`/customers/${n.customer.id}/`,e).then(e=>{console.log("Customer updated:",e.data),o("saved",e.data),o("close")}).catch(e=>{console.error("Error updating customer:",e),window.alert("Lỗi cập nhật khách hàng: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))})):(delete e.province_name,delete e.ward_name,await r.A.post("/customers/",e).then(e=>{console.log("Customer created:",e.data),o("saved",e.data),o("close")}).catch(e=>{console.error("Error creating customer:",e),window.alert("Lỗi tạo khách hàng: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))}))},S=()=>{o("close")};return(0,s.sV)(()=>{if(n.customer){if(Object.assign(u,i(),n.customer),n.customer.province){const e=n.regionList.find(e=>e.id===n.customer.province);e&&(u.province_name=e.name)}if(n.customer.ward){const e=n.wardList.find(e=>e.id===n.customer.ward);e&&(u.ward_name=e.name)}}else Object.assign(u,i())}),(t,o)=>((0,s.uX)(),(0,s.CE)("div",{class:"modal-overlay",onClick:S},[(0,s.Lk)("div",{class:"customer-window",onClick:o[19]||(o[19]=(0,l.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",fe,[(0,s.Lk)("span",Le,[(0,s.Lk)("span",ye,(0,y.v_)(n.customer?"Cập nhật khách hàng":"Thêm khách hàng"),1),(0,s.Lk)("span",we,[o[20]||(o[20]=(0,s.eW)(" Chi nhánh tạo: ",-1)),(0,s.Lk)("span",null,(0,y.v_)(n.currentBranch),1)])]),(0,s.Lk)("div",{class:"window-actions no-select"},[(0,s.Lk)("button",{onClick:S,class:"close-btn"},[...o[21]||(o[21]=[(0,s.Lk)("span",null,"×",-1)])])])]),(0,s.Lk)("div",_e,[(0,s.Lk)("div",Ce,[(0,s.Lk)("ul",null,[(0,s.Lk)("li",{class:(0,y.C4)({active:"general"===a.value})},[(0,s.Lk)("a",{href:"#",onClick:o[0]||(o[0]=(0,l.D$)(e=>a.value="general",["prevent"]))},"Thông tin chung")],2)])]),(0,s.Lk)("div",xe,["general"===a.value?((0,s.uX)(),(0,s.CE)("div",Se,[(0,s.Lk)("div",Ee,[(0,s.Lk)("div",Ae,[(0,s.Lk)("div",Te,[o[22]||(o[22]=(0,s.Lk)("label",{class:"no-select"},"Mã khách hàng",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=e=>u.code=e),placeholder:"Mã mặc định",disabled:"new"!==e.type},null,8,Pe),[[l.Jo,u.code]])]),(0,s.Lk)("div",De,[o[23]||(o[23]=(0,s.Lk)("label",{class:"required no-select"},"Tên khách hàng",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=e=>u.name=e),placeholder:"Bắt buộc"},null,512),[[l.Jo,u.name]])]),(0,s.Lk)("div",Ie,[o[24]||(o[24]=(0,s.Lk)("label",{class:"no-select"},"Điện thoại",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=e=>u.phone_number=e),placeholder:"Bắt buộc",onInput:c},null,544),[[l.Jo,u.phone_number]])]),(0,s.Lk)("div",Ke,[o[25]||(o[25]=(0,s.Lk)("label",{class:"no-select"},"Địa chỉ",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":o[4]||(o[4]=e=>u.address=e),rows:"2",placeholder:"Số nhà, tòa nhà, ngõ, đường"},null,512),[[l.Jo,u.address]])]),(0,s.Lk)("div",Re,[o[26]||(o[26]=(0,s.Lk)("label",{class:"no-select"},"Khu vực",-1)),(0,s.Lk)("div",Ve,[(0,s.bo)((0,s.Lk)("input",{ref_key:"locationInputRef",ref:m,type:"text","onUpdate:modelValue":o[5]||(o[5]=e=>u.province_name=e),placeholder:"Chọn Tỉnh/TP",onFocus:o[6]||(o[6]=e=>g("location")),onInput:o[7]||(o[7]=e=>g("location")),onBlur:o[8]||(o[8]=e=>C("location")),onChange:L},null,544),[[l.Jo,u.province_name]]),((0,s.uX)(),(0,s.Wv)(s.Im,{to:"body"},[d.value&&b.value.length?((0,s.uX)(),(0,s.CE)("ul",{key:0,class:"autocomplete-list",style:(0,y.Tr)(h)},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(b.value,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.id,onMousedown:(0,l.D$)(t=>f(e),["prevent"])},(0,y.v_)(e.name),41,Ne))),128))],4)):(0,s.Q3)("",!0)]))])]),(0,s.Lk)("div",Xe,[o[27]||(o[27]=(0,s.Lk)("label",{class:"no-select"},"Phường xã",-1)),(0,s.Lk)("div",Fe,[(0,s.bo)((0,s.Lk)("input",{ref_key:"wardInputRef",ref:v,type:"text","onUpdate:modelValue":o[9]||(o[9]=e=>u.ward_name=e),placeholder:"Chọn Phường/Xã",disabled:!u.province,onFocus:o[10]||(o[10]=e=>g("ward")),onInput:o[11]||(o[11]=e=>g("ward")),onBlur:o[12]||(o[12]=e=>C("ward"))},null,40,Ue),[[l.Jo,u.ward_name]]),((0,s.uX)(),(0,s.Wv)(s.Im,{to:"body"},[p.value&&w.value.length?((0,s.uX)(),(0,s.CE)("ul",{key:0,class:"autocomplete-list",style:(0,y.Tr)(h)},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(w.value,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.id,onMousedown:(0,l.D$)(t=>_(e),["prevent"])},(0,y.v_)(e.name),41,Oe))),128))],4)):(0,s.Q3)("",!0)]))])])]),(0,s.Lk)("div",We,[(0,s.Lk)("div",qe,[o[30]||(o[30]=(0,s.Lk)("label",{class:"no-select"},"Ngày sinh",-1)),(0,s.Lk)("div",Qe,[(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":o[13]||(o[13]=e=>u.birthdate=e),class:"input-date"},null,512),[[l.Jo,u.birthdate]]),(0,s.Lk)("div",Je,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"radio",value:!0,"onUpdate:modelValue":o[14]||(o[14]=e=>u.gender=e)},null,512),[[l.XL,u.gender]]),o[28]||(o[28]=(0,s.eW)(" Nam",-1))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"radio",value:!1,"onUpdate:modelValue":o[15]||(o[15]=e=>u.gender=e)},null,512),[[l.XL,u.gender]]),o[29]||(o[29]=(0,s.eW)(" Nữ",-1))])])])]),(0,s.Lk)("div",Me,[o[31]||(o[31]=(0,s.Lk)("label",{class:"no-select"},"Email",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email","onUpdate:modelValue":o[16]||(o[16]=e=>u.email=e)},null,512),[[l.Jo,u.email]])]),(0,s.Lk)("div",$e,[o[32]||(o[32]=(0,s.Lk)("label",{class:"no-select"},"Facebook",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":o[17]||(o[17]=e=>u.facebook=e)},null,512),[[l.Jo,u.facebook]])]),(0,s.Lk)("div",Be,[o[33]||(o[33]=(0,s.Lk)("label",{class:"no-select"},"Ghi chú",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":o[18]||(o[18]=e=>u.comments=e),rows:"3"},null,512),[[l.Jo,u.comments]])])])])])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",He,[(0,s.Lk)("button",{class:"btn btn-outline",onClick:S},[...o[34]||(o[34]=[(0,s.Lk)("i",{class:"icon-ban"},null,-1),(0,s.eW)(" Bỏ qua ",-1)])]),(0,s.Lk)("button",{class:"btn btn-primary new-button",onClick:x,disabled:!u.name.trim()||!u.phone_number.trim()||!u.address.trim()||!u.province_name.trim()},[...o[35]||(o[35]=[(0,s.Lk)("i",{class:"icon-save"},null,-1),(0,s.eW)(" Lưu ",-1)])],8,je)])])])]))}};const ze=(0,p.A)(Ge,[["__scopeId","data-v-fc3a5938"]]);var Ye=ze;const Ze={class:"cart-products-component"},et={key:0,class:"welcome-page no-select"},tt={class:"carts-item"},at={class:"carts-left"},lt={key:0,class:"cell-order"},st={class:"cell-actions carts-actions"},ot=["onClick"],nt={class:"carts-content"},it={class:"carts-container"},rt={class:"carts-content-info"},ct={class:"carts-content-top"},ut={key:0,class:"cell-code"},dt={class:"cell-info"},pt={class:"info-content"},mt={key:1,class:"cell-units"},vt=["onUpdate:modelValue","onChange"],ht=["value"],kt={class:"carts-content-bottom"},gt={class:"cell-quantity"},bt={class:"quantity quantity-sm"},ft=["onClick"],Lt=["onUpdate:modelValue","onChange"],yt=["onClick"],wt={key:0,class:"cell-change-price"},_t={class:"form-control form-control-sm text-right no-select"},Ct={key:0,class:"sub-label label-discount"},xt={key:1,class:"cell-change-price"},St={class:"cell-total text-right"},Et={class:"cart-price-new"},At={key:0,class:"carts-secondary cell-secondary"},Tt={class:"carts-note"},Pt=["onUpdate:modelValue"],Dt={class:"cell-actions carts-actions"},It=["onClick"],Kt={key:0,class:"popover-menu"},Rt=["onClick"],Vt=["onClick"],Nt={key:0,class:"carts-item row-serial-child"},Xt={class:"carts-content"},Ft={class:"carts-container"},Ut={class:"cell-name"},Ot={class:"tags-input-wrapper"},Wt=["onClick"],qt=["onKeydown"],Qt={class:"carts-footer no-select"},Jt={key:0,class:"carts-footer-left"},Mt={key:1,class:"cart-footer-right"},$t={class:"form-group-inline form-group-row form-group-row-sm"},Bt={class:"col-form-wrap d-flex"},Ht={key:0,class:"text-bg-default"},jt={class:"form-group-inline form-group-row-sm form-group-price"},Gt={class:"form-control-plaintext text-right font-size-medium has-currency font-bold"};var zt={__name:"Carts",props:{focus_invoice:{type:Object,required:!0,default:()=>({id:1,total:4e4,totalItems:1,discount:0,finalTotal:4e4,items:[{uuid:"1",code:"FP0011",name:"Ức gà Teriyaki 150g",price:4e4,quantity:1,onHand:6,ordered:45,hasNote:!1,units:[{id:1,name:"Gói"}],productType:2,actualProducts:[{code:"FP0011",quantity:1}],isSerial:!1,note:"",isOpenPopover:!1}]})}},emits:["update-invoice"],setup(e,{emit:t}){(0,be.KR)("");const a=(0,be.Kh)({numberOrder:!0,code:!0,price:!0,total:!0,duplicateCartItem:!0,usingSortProduct:!1});"isOnlineMode"in a||(a.isOnlineMode=!1),"saleScreenMode"in a||(a.saleScreenMode=2),"isWarrantyCart"in a||(a.isWarrantyCart=!1),"useTotalQuantity"in a||(a.useTotalQuantity=!0);const o=t,n=e,i=(0,s.EW)(()=>n.focus_invoice.items||[]),r=(0,be.KR)(!1),c=()=>{let e=0,t=0;i.value.forEach(a=>{e+=a.price*a.quantity,t+=a.quantity}),n.focus_invoice.total=e,n.focus_invoice.finalTotal=e-n.focus_invoice.discount,n.focus_invoice.totalItems=t,o("update-invoice",n.focus_invoice)},u={mounted(e,t){e.clickOutsideEvent=a=>{e===a.target||e.contains(a.target)||t.value(a)},setTimeout(()=>{document.addEventListener("click",e.clickOutsideEvent)},0)},unmounted(e){document.removeEventListener("click",e.clickOutsideEvent)}},d=e=>{const t=n.focus_invoice.items.indexOf(e);t>-1&&(n.focus_invoice.items.splice(t,1),c())},p=e=>new Intl.NumberFormat("vi-VN").format(e),m=(e,t)=>{console.log("Button clicked",t);const a=Number(e.quantity)||0,l=a+t;l>0&&(e.quantity=l,c())},v=e=>{let t=Number(e.quantity);(isNaN(t)||t<1)&&(t=1),e.quantity=t,c()},h=e=>{console.log("Unit changed",e.selectedUnit)},k=e=>{n.focus_invoice.items.forEach(t=>{t!==e&&(t.isOpenPopover=!1)}),e.isOpenPopover=!e.isOpenPopover},g=e=>{e.isOpenPopover&&(e.isOpenPopover=!1)},b=e=>{e.hasNote&&(e.note=""),e.hasNote=!e.hasNote,g(e),o("update-invoice",n.focus_invoice)},f=(e,t)=>{const a=t.target.value.trim();a&&(e.serials||(e.serials=[]),e.serials.push(a),t.target.value="")},L=(e,t)=>{e.serials.splice(t,1)};return(e,t)=>((0,s.uX)(),(0,s.CE)("div",Ze,[i.value.length||r.value?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",et,[...t[2]||(t[2]=[(0,s.Lk)("p",null,"Chưa có sản phẩm nào trong giỏ hàng",-1)])])),(0,s.Lk)("div",{class:(0,y.C4)(["carts-list no-select",{"show-duplicate-item":a.duplicateCartItem}])},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.value,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:e.uuid,class:(0,y.C4)(["carts active",{"carts-item-sortable":a.usingSortProduct}])},[(0,s.Lk)("div",tt,[(0,s.Lk)("div",at,[a.numberOrder?((0,s.uX)(),(0,s.CE)("div",lt,(0,y.v_)(i+1),1)):(0,s.Q3)("",!0),(0,s.Lk)("div",st,[(0,s.Lk)("button",{class:"btn-icon btn-icon-default",onClick:t=>d(e),title:"Xóa hàng hóa"},[...t[3]||(t[3]=[(0,s.Lk)("i",{class:"far fa-trash-alt"},null,-1)])],8,ot)])]),(0,s.Lk)("div",nt,[(0,s.Lk)("div",it,[(0,s.Lk)("div",rt,[(0,s.Lk)("div",ct,[a.code?((0,s.uX)(),(0,s.CE)("div",ut,(0,y.v_)(e.code),1)):(0,s.Q3)("",!0),(0,s.Lk)("div",dt,[(0,s.Lk)("div",pt,[(0,s.Lk)("span",null,(0,y.v_)(e.name),1)])]),e.units&&e.units.length>1?((0,s.uX)(),(0,s.CE)("div",mt,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t=>e.selectedUnit=t,onChange:t=>h(e),class:"form-control"},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.units,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,y.v_)(e.name),9,ht))),128))],40,vt),[[l.u1,e.selectedUnit]])])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",kt,[(0,s.Lk)("div",gt,[(0,s.Lk)("div",bt,[(0,s.Lk)("button",{type:"button",class:"btn-icon btn-icon-bg-default down",onClick:t=>m(e,-1)},[...t[4]||(t[4]=[(0,s.Lk)("i",{class:"fas fa-minus"},null,-1)])],8,ft),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.quantity=t,class:"form-control form-control-sm input-white",onChange:t=>v(e)},null,40,Lt),[[l.Jo,e.quantity,void 0,{number:!0}]]),(0,s.Lk)("button",{type:"button",class:"btn-icon btn-icon-bg-default up",onClick:t=>m(e,1)},[...t[5]||(t[5]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1)])],8,yt)])]),a.price?((0,s.uX)(),(0,s.CE)("div",wt,[(0,s.Lk)("button",_t,(0,y.v_)(p(e.price)),1),e.discount>0?((0,s.uX)(),(0,s.CE)("span",Ct," - "+(0,y.v_)(p(e.discount)),1)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),a.total?((0,s.uX)(),(0,s.CE)("div",xt,[(0,s.Lk)("div",St,[(0,s.Lk)("span",Et,(0,y.v_)(p(e.quantity*e.price)),1)])])):(0,s.Q3)("",!0)])])]),e.hasNote||e.note?((0,s.uX)(),(0,s.CE)("div",At,[(0,s.Lk)("div",Tt,[(0,s.bo)((0,s.Lk)("textarea",{class:"form-control form-control-custom","onUpdate:modelValue":t=>e.note=t,placeholder:"Ghi chú...",rows:"1",onChange:t[0]||(t[0]=e=>o("update-invoice",n.focus_invoice))},null,40,Pt),[[l.Jo,e.note]])])])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Dt,[(0,s.Lk)("button",{class:"btn-icon btn-icon-default btn-more",onClick:t=>k(e)},[...t[6]||(t[6]=[(0,s.Lk)("i",{class:"fas fa-ellipsis-v"},null,-1)])],8,It),e.isOpenPopover?(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",Kt,[(0,s.Lk)("a",{onClick:t=>d(e)},[...t[7]||(t[7]=[(0,s.Lk)("i",{class:"far fa-trash-alt"},null,-1),(0,s.eW)(" Xóa hàng hóa",-1)])],8,Rt),(0,s.Lk)("a",{onClick:t=>b(e)},[...t[8]||(t[8]=[(0,s.Lk)("i",{class:"fa-regular fa-note-sticky"},null,-1),(0,s.eW)(" Ghi chú",-1)])],8,Vt)])),[[u,()=>g(e)]]):(0,s.Q3)("",!0)])]),e.isSerial?((0,s.uX)(),(0,s.CE)("div",Nt,[t[9]||(t[9]=(0,s.Lk)("div",{class:"carts-left"},null,-1)),t[10]||(t[10]=(0,s.eW)()),(0,s.Lk)("div",Xt,[(0,s.Lk)("div",Ft,[(0,s.Lk)("div",Ut,[(0,s.Lk)("div",Ot,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.serials,(t,a)=>((0,s.uX)(),(0,s.CE)("span",{key:a,class:"tag"},[(0,s.eW)((0,y.v_)(t)+" ",1),(0,s.Lk)("span",{onClick:t=>L(e,a)},"×",8,Wt)]))),128)),(0,s.Lk)("input",{type:"text",placeholder:"Nhập Serial/Imei",onKeydown:(0,l.jR)(t=>f(e,t),["enter"])},null,40,qt)])])])])])):(0,s.Q3)("",!0)],2))),128))],2),(0,s.Lk)("div",Qt,[a.isOnlineMode?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Jt,[(0,s.bo)((0,s.Lk)("textarea",{class:"form-control form-control-custom note-cart","onUpdate:modelValue":t[1]||(t[1]=e=>n.focus_invoice.note=e),placeholder:"Ghi chú đơn hàng",maxlength:"4000",tabindex:"1500",style:{height:"43px"}},null,512),[[l.Jo,n.focus_invoice.note]])])),2!==a.saleScreenMode||r.value||a.isWarrantyCart||a.isOnlineMode?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Mt,[(0,s.Lk)("div",$t,[t[11]||(t[11]=(0,s.Lk)("label",{class:"col-form-label no-select"},"Tổng tiền hàng",-1)),(0,s.Lk)("div",Bt,[a.useTotalQuantity?((0,s.uX)(),(0,s.CE)("span",Ht,(0,y.v_)(n.focus_invoice.totalItems),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",jt,[(0,s.Lk)("div",Gt,(0,y.v_)(p(n.focus_invoice.total)),1)])]))])]))}};const Yt=(0,p.A)(zt,[["__scopeId","data-v-0679cb49"]]);var Zt=Yt;const ea={class:"product-filter-cate-component"},ta={key:0,class:"float-nav"},aa={class:"float-nav-content"},la={class:"filter-header"},sa={class:"filter-header-autocomplete"},oa={class:"autocomplete"},na={class:"scroll-content"},ia={class:"kv-treeview k-widget k-treeview",role:"tree"},ra={class:"k-group k-treeview-lines"},ca={role:"treeitem",class:"k-first k-last","aria-expanded":"true"},ua={class:"k-top k-bot"},da={class:"k-checkbox-wrapper",role:"presentation"},pa=["checked","indeterminate"],ma={class:"k-group"},va={class:"k-checkbox-wrapper",role:"presentation"},ha=["id","value"],ka=["for"],ga=["onClick"],ba={class:"not-found",style:{color:"#a5a6ae",padding:"20px","text-align":"center"}};var fa={__name:"ProfuctFilterCate",props:{visible:{type:Boolean,default:!0},dataSource:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]}},emits:["update:visible","update:modelValue","apply"],setup(e,{emit:t}){const a=e,o=t,n=(0,be.KR)(""),i=(0,be.KR)(!0),r=(0,be.KR)([]);(0,s.wB)(()=>a.visible,e=>{e&&(r.value=[...a.modelValue],n.value="")});const c=(0,s.EW)(()=>{if(!n.value)return a.dataSource;const e=n.value.toLowerCase();return a.dataSource.filter(t=>t.name.toLowerCase().includes(e))}),u=(0,s.EW)(()=>c.value.length>0&&r.value.length===c.value.length),d=(0,s.EW)(()=>r.value.length>0&&r.value.length<c.value.length),p=e=>{e.target.checked?r.value=c.value.map(e=>e.name):r.value=[]},m=()=>{u.value?r.value=[]:r.value=c.value.map(e=>e.name)},v=e=>{const t=r.value.indexOf(e);t>-1?r.value.splice(t,1):r.value.push(e)},h=()=>{r.value=[]},k=()=>{o("update:visible",!1)},g=()=>{o("update:modelValue",r.value),o("apply",r.value),k()};return(t,a)=>((0,s.uX)(),(0,s.CE)("div",ea,[e.visible?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"float-overlay",onMousedown:a[0]||(a[0]=(0,l.D$)(()=>{},["self"]))},null,32)):(0,s.Q3)("",!0),(0,s.bF)(l.eB,{name:"slide-fade"},{default:(0,s.k6)(()=>[e.visible?((0,s.uX)(),(0,s.CE)("div",ta,[(0,s.Lk)("div",aa,[(0,s.Lk)("h3",{class:"float-nav-title filter no-select"},[a[5]||(a[5]=(0,s.eW)(" Lọc theo nhóm hàng ",-1)),(0,s.Lk)("button",{tabindex:"-1",onClick:k,class:"btn-icon btn-icon-default"},[...a[4]||(a[4]=[(0,s.Lk)("i",{class:"fa fa-times"},null,-1)])])]),(0,s.Lk)("div",la,[a[7]||(a[7]=(0,s.Lk)("h4",{class:"filter-header-title no-select"},[(0,s.Lk)("span",null,"Nhóm hàng")],-1)),(0,s.Lk)("div",sa,[(0,s.Lk)("div",oa,[a[6]||(a[6]=(0,s.Lk)("i",{class:"fa fa-search"},null,-1)),(0,s.bo)((0,s.Lk)("input",{tabindex:"-1",type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>n.value=e),placeholder:"Tìm nhóm hàng",class:"form-control form-control-custom"},null,512),[[l.Jo,n.value]])])])]),(0,s.Lk)("div",na,[(0,s.Lk)("div",ia,[(0,s.Lk)("ul",ra,[(0,s.Lk)("li",ca,[(0,s.Lk)("div",ua,[(0,s.Lk)("span",{class:(0,y.C4)(["k-icon fixed-cate-align",i.value?"k-minus":"k-plus"]),onClick:a[2]||(a[2]=e=>i.value=!i.value),role:"presentation"},null,2),(0,s.Lk)("span",da,[(0,s.Lk)("input",{type:"checkbox",id:"node-all",class:"k-checkbox",checked:u.value,indeterminate:d.value,onChange:p},null,40,pa),a[8]||(a[8]=(0,s.Lk)("label",{for:"node-all",class:"k-checkbox-label"},null,-1))]),(0,s.Lk)("span",{class:"k-in"},[(0,s.Lk)("span",{onClick:m,class:"cate-item no-select"},"Tất cả")])]),(0,s.bo)((0,s.Lk)("ul",ma,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(c.value,(e,t)=>((0,s.uX)(),(0,s.CE)("li",{key:e.name,role:"treeitem",class:(0,y.C4)(["k-item adjusted-k-item no-select",{"k-last":t===c.value.length-1}])},[a[9]||(a[9]=(0,s.Lk)("div",{class:"k-top k-bot fixed-cate-align"},[(0,s.Lk)("span",{class:"k-icon fixed-cate-align"})],-1)),(0,s.Lk)("div",{class:(0,y.C4)(t===c.value.length-1?"k-bot":"k-mid")},[(0,s.Lk)("span",va,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox",id:"node-"+e.name,class:"k-checkbox",value:e.name,"onUpdate:modelValue":a[3]||(a[3]=e=>r.value=e)},null,8,ha),[[l.lH,r.value]]),(0,s.Lk)("label",{for:"node-"+e.name,class:"k-checkbox-label"},null,8,ka)]),(0,s.Lk)("span",{class:"k-in cate-item",onClick:t=>v(e.name)},[(0,s.Lk)("span",null,(0,y.v_)(e.name),1)],8,ga)],2)],2))),128))],512),[[l.aG,i.value]])])])]),(0,s.bo)((0,s.Lk)("div",ba,[...a[10]||(a[10]=[(0,s.Lk)("i",{class:"far fa-file-search",style:{"font-size":"32px",display:"block","margin-bottom":"10px"}},null,-1),(0,s.eW)(" Không có kết quả nào được tìm thấy ",-1)])],512),[[l.aG,0===c.value.length]])]),(0,s.Lk)("div",{class:"group-buttons"},[(0,s.Lk)("div",{class:"group-buttons-left no-select"},[(0,s.Lk)("div",{onClick:h,class:"btn-remove-filter font-medium cursor-pointer"},[...a[11]||(a[11]=[(0,s.Lk)("i",{class:"far fa-trash-alt"},null,-1),(0,s.eW)(" Xóa chọn tất cả ",-1)])])]),(0,s.Lk)("div",{class:"group-buttons-right no-select"},[(0,s.Lk)("div",{onClick:k,class:"btn btn-outline-primary"}," Bỏ qua "),(0,s.Lk)("div",{onClick:g,class:"btn btn-primary no-select"},[...a[12]||(a[12]=[(0,s.Lk)("button",{class:""},"Xong",-1)])])])])])])):(0,s.Q3)("",!0)]),_:1})]))}};const La=(0,p.A)(fa,[["__scopeId","data-v-ac8f1de2"]]);var ya=La;a(8237);const wa={class:"modal-body"},_a={class:"table-container"},Ca={class:"grid-blue"},xa={class:"tr-summary"},Sa={class:"text-right font-bold text-primary"},Ea={class:"cell-checkbox text-center"},Aa=["onUpdate:modelValue"],Ta={class:"cell-code"},Pa={class:"cell-name"},Da={class:"cell-price text-right"},Ia={key:0},Ka={key:1,class:"text-muted"},Ra={class:"cell-price"},Va=["onUpdate:modelValue","disabled"];var Na={__name:"Surcharge",props:{visible:{type:Boolean,default:!1},items:{type:Array,default:()=>[]},defaultSurcharges:{type:Array,default:()=>[]},chosenSurcharges:{type:Array,default:()=>[]}},emits:["close","update-surcharges"],setup(e,{emit:t}){const a=(0,be.KR)(null),o=(0,be.KR)(null),n=e=>{o.value&&!o.value.contains(e.target)&&v()},i=e,r=t,c=i.defaultSurcharges,u=e=>{e.target.select()},d=(0,be.KR)(JSON.parse(JSON.stringify(c)));i.chosenSurcharges&&i.chosenSurcharges.length>0&&i.chosenSurcharges.forEach(e=>{const t=d.value.find(t=>t.id===e.id);t&&(t.selected=e.selected,t.amount=e.amount)}),(0,s.wB)(()=>i.items,e=>{e&&e.length>0&&(d.value=JSON.parse(JSON.stringify(e)))},{immediate:!0});const p=(0,s.EW)(()=>(console.log("Calculating totalAmount from surchargeList:",d.value),d.value.reduce((e,t)=>{const a=isNaN(Number(t.amount))?0:Number(t.amount);return e+(t.selected?a:0)},0))),m=e=>new Intl.NumberFormat("vi-VN").format(e),v=()=>{r("close",d.value.filter(e=>e.selected))};return(t,i)=>e.visible?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-overlay-a",onMousedown:(0,l.D$)(n,["self"]),ref_key:"overlayRef",ref:a},[(0,s.Lk)("div",{class:"modal-container",ref_key:"modalRef",ref:o},[(0,s.Lk)("div",{class:"modal-header"},[i[0]||(i[0]=(0,s.Lk)("h3",{class:"title"},"Các khoản thu khác",-1)),(0,s.Lk)("button",{onClick:v,class:"close-btn"},"×")]),(0,s.Lk)("div",wa,[(0,s.Lk)("div",_a,[(0,s.Lk)("table",Ca,[i[2]||(i[2]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",{class:"cell-checkbox"}),(0,s.Lk)("th",{class:"cell-code"},"Mã thu khác"),(0,s.Lk)("th",{class:"cell-name"},"Loại thu"),(0,s.Lk)("th",{class:"cell-price text-right"},"Mức thu"),(0,s.Lk)("th",{class:"cell-price text-right"},"Thu trên hóa đơn")])],-1)),(0,s.Lk)("tbody",null,[(0,s.Lk)("tr",xa,[i[1]||(i[1]=(0,s.Lk)("td",{colspan:"4",class:"text-right font-bold"},"Tổng thu:",-1)),(0,s.Lk)("td",Sa,(0,y.v_)(m(p.value)),1)]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(d.value,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id,class:(0,y.C4)({selected:e.selected})},[(0,s.Lk)("td",Ea,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.selected=t,class:"form-check-input"},null,8,Aa),[[l.lH,e.selected]])]),(0,s.Lk)("td",Ta,(0,y.v_)(e.code),1),(0,s.Lk)("td",Pa,(0,y.v_)(e.description),1),(0,s.Lk)("td",Da,[e.value>0?((0,s.uX)(),(0,s.CE)("span",Ia,(0,y.v_)(m(e.amount)),1)):((0,s.uX)(),(0,s.CE)("span",Ka,"-"))]),(0,s.Lk)("td",Ra,[(0,s.bo)((0,s.Lk)("input",{type:"number",onFocus:u,"onUpdate:modelValue":t=>e.amount=t,disabled:!e.selected,class:"form-control-sm text-right no-arrow"},null,40,Va),[[l.Jo,e.amount]])])],2))),128))])])])])],512)],544)):(0,s.Q3)("",!0)}};const Xa=(0,p.A)(Na,[["__scopeId","data-v-7ab45bcc"]]);var Fa=Xa,Ua="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAAyCAYAAAAZUZThAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAA+FSURBVHhe7ZwJkBxVGcfx1kJLLYSQcMmVO9lsdnemezabxMgZUIgcIgLBgCCg3OEMIIdSHOEQEKKgiKhESyw0iBdKQuJBQEW5PEETAjv3tbM7e8zn///2ddJpX+/2zG6KhLxf1b8m0/29I7Pv63d9r3ewWCwWi8VisWyziP60WCw+kh3NuxZc59quWYnnSwnnmnJr6xh9y2LZfim57pRyu7u0mIinpa1FKlMnCz/5vYjrGdzXphbL9kEpHt+l3O6cWEg4j+XcWL/MnCGFKRMl9+lPSdc9d6tPfud13i8m3J8WYF9ynJ11FhbLmwfp6HhXOZFoyrc7Z+UT8Ufybjw7EG+TXvQW2RnTJbfwJOlZ8RORvj5R4JPfcwtPVPd7p00W2jOdSo98mB/z1UVYLFs3smDBW4uzW3Yquu6EXHt8Ti4RX5hPONdn3diKnBN7OR9rlVpLs3KKfNM0yc4/REpfuk56n3l60ClC4P3Sddcq+3zTVJWe+TA/5sv8WQ7LY7ksn/VgfXTVLJY3nozjnDIwuz2XxpO+gqd+PxpzbdoUPP2nSIlDpXlzJX/yQinfeov0/naN1Lq6tAtsou+lF6Xrq3epzyC0ryJd+dalKp/cvDkqX+bPclgey2X5qh5u7DO6ahbLG0/KjV8lHe2SmztHimd8TkpXLJGuO74i3Q8/jF7gGRlIp3VT35xatSrVlU9I4fxzJY3JeXL/fdQnv/M675tgfsyX+bMcllc843RVPuuRdmJX6KpZLG88aJBfruGJnj/9s7oJh1OrVKR37VNSXnqzZI88QlIYNqWmTFJP/3TCUZ/8zuu8TzvaM91wsHzWg/XRVbNY3nhSidhtteYmKZx7tm6qmoEBGejslN6n10rlwQeleNFiyR4+X1KYhyQnjZcU0qTdeKh4X9lx3oJ0xYsXq3yYH/Nl/n4K55wtrEcq4dyqq2bZttkTcqHDoY9BCWhv6O3QtkPade4awBygeMlFuqmKVO77umQPPVjSsxKSmjxRkvvuLcnx+0kKc4YUJtqp1pmSppyY0TnUddynnbKfPhX5TIDDTJAUysrM6VD5sxwPOmCNcxHUR1ctCsdAT4xAF0JBjoNMtsdCQY6CTLZ1ady4cQ8vX7783fg3uRgy2hn0I+hmiL9DPUvpe0G/hkx5ngc1Ch2Cf78XoB6IARZ+9UL/hB6AjoDeA3nEIFN9LoGG4ttQMM1q6EZo5KSc2LIBPOWLSy7XTRVP88UXSHLvPSU9e5ZkDj5QMocc9P86YJ7qHVRPwuEVHQOf/M7rvL/RFhN95SxwEOVYsVZJ7rOXFC66UJcIB7n8MmE9kk7sHl21KLAxBf8I9Yh/qCCXQybbS6EgiyGTbb2q7rjjjh/EJ/kuZLIZThnoJmhHaDiuhEx5UCmo3mX4CRCd1ZTfUPoC5HEYZLJ5CArjc5ApDRWHRk7aid/Bhlm66krdVNFYL7lYOvfYTbqXPyS1UsmogWxWqk/8RrIfO0z1Cso58MnvvM77G20zael7/nnpWrZMOV1qJpwI85TipZfoEkVKV16hHIT10VWLwrmQ6ceJqmVQEPYqJtvzoSBnQybbepWGPgCR+yCTTVQ9Cw0V7vM26B+QKa0n9oxRYU+Qh0z5DCc+4DwOhkw234RMfAjiQ8GUZvQWelJufGkNDdPfg/DfnbuPlZ5HH9VXwul/5RVJd2AohkbPz/7//EffMUNH4dAtOWF/KV7hK/OySzHEgoO4DocMUbEOYtYvoTDCGqJfP4eiwPmFKX1U+Ye49TpI2O/0F4gPgdEBQ6yrOfbnHMCjdM0XpXPcGOlZsUJfGZpBhxqnlmyjUL75RuS/K8q5Wl9BHosvVHOQjBv/oq5aFEbqIBzOBKnHQUY6xPPLG2KNhoNQB0ImfgCZ7P3qg/aBhmIPqACZ0vtVhl6G/g2V9DVPF0Ae9TiIA5lsKc5lRg9MqM+t4elf+PxZuqmyAd8kyf33ldxxx0rhnC9I4exNyp91BoZGF2+2YchNxM5dd1H7Gh68z4l//rRT1fCJQy2Pnp89phyEy8AeLJ/1wBzkHF21KIQ5yO+gayOIw4Mg9TgIJ6WmfO+FTHn8CzLZXwZ5k/QwB7ke4kKBp9OhFZDJljL1juOgCmSyD+oaaCg4OTal80RHZA/DMt8BcfVqV4iO8DVoALoa8qjHQZ6GTLa3QKNLynGO72cIyMkn6aYqUrn365KcOF7S7a5kPjJHMnNnbxSvcZ5RKxa19aBDdY4dI12336avwEEKhcFl4ViLZI/8OOYhGX0HDvKLnysHqdx3r74iqnzWI+W0fUpXLQphDuL/4eulHgcJ48OQKY+fQMMR5iCzIBN0BJM9V3KCmP5vnRBtg9dfgcKWZNm7sJcJpqHYSxwJDQd7ATqFR1QHCZuYc3XMvyo2OqQSsbmV1pmSW3DExqDDnh8/Ip27jcWTf4nUenqk1t29uXBNajVlS0wOwvsqLTcJfbak6847BodwKEeBcll+pW2msD66alEIc5CRLPGNhoM0Q6Y8ooztwxzkUMjEbMhkvxby8xboeSho9yj08cA1T/MhExdBJnuKex6NEOYgd0MenKdlIZPdAdDok4zH90u3tfTn583dGFbS+9RTktxvb8l/9lT1fTiMDhLCwPr1g8u+kydK79q1g9dSKcmjp0qhHqyPrloUwhxkJLvxW6uDHAKZWACZ7IMOEuZIZ0B0HlPDewQyQacK2lI/hholzEGegTgEpbj4YLIJm8iPnFebm9+TirW+VkIvwhUm1WA3bFB7FdzL8A+lwhjWQXp7VZ6Mv+IGIZd40x3t6hrpe+45YfnpeOsG1kdXLQphDrIOWjWMuGdgYmt1kDlQkEkQl3VN9sGyuOcTtOFm3u4QMc0puqHdID90pr9DQVuqnuXhIGEOMpw2QN4K4JYh5cae7Jk2ZfBsB+nvl9zRnxjc1zhqASbrn1QTdiqL6/lTF2026TbOQXA/f8oilU8Wwye1/8E4rZkzlHLHHKXKISyX5aMebLj1EOYgUbQSMrG1Ogh7hJ/69HuoCplsqSWQB/cMgitIlL8+7KGC96ngBul7Ic5bgnacdHPDsFEacRCW2eiQLjoqHmv6FCnfdINqsKS45DI1DFKbenAUT0kGJ87pkFo+ry1DHAT3/U6RxmTdC0Vhvv49kPKNN0iN4Sioh65SVEbiIGxkJrZWB6lHnEAz7snjTMhkdxLk8U6IPW/Q5m8Qew0PLkebNujYWP1l1svW6yAZN3a0Wsk66QTdZAcn6oyd2hhf5TVuDIUYfsJVKg+jg+B+5qADBkNLAnkw340TdJA/8dNqBSvtxurtoq2DmHUB5OePUNCGcw72Bn6WQkE7ah7k8T4oCQVt2FjHQ43S6BDrNWgLD7ESM8ZiztGdTzjSv36darSMuOWON+ci/sY9YgdhT4J8B5Kdyq5/3ToeyWU53cnmZq6T18NIHGQNZGJbdhAGAwaHRNw4M9lyk5SnN7lH4YlLyf1Q0NYfD8Vdai6pBm2oT0KNEuYgdMY/aIWFtGy5SbpHyok/UZ06Sbof+p5quISHn9R5D18DH6mDpKZgeHX+edpKpILyWG7Kjf9GV6UewhzktxD3QobSiZCJbdFBuFPN5dCpUJCwfRI2PO51+MXdbvYEQVvuhvujhR+DgjbUk1CjhDkIN109hupl/L3c6IMJ8pnCYdaiz+imK1Jd/aRq0Js18FFwkOrq1doKw6tFJwvLhYNwubFewhyEDtAoW6uD3A6d6tMiiPsUfL1SWPTt+6GwfYN6xd/ag0M4kw1Vz2/vraCRsMb/DcjPtyCTHQMwvWiE0ef1eHyXrBMrFzCh5rKrolaTHOYHPAcyGg7CfHKc5+iNw77n/iqF5ibJoNwGXw0U5iBhS7hR2FodpB2qF57vN+XViLic7MGGPdQKGoc8Q+1ncemYxxr8sXBhDhIcPu0EMbjTZDs6Z0DCSLrx+6Vp6mZh6NU1q9Wqk3c4qmEHQXrmU12zRluIiumSpmnsPRodQ25PDhK2kz4UHGqa8mpUjD3z4MlPk40nxnxxIYTBp6dBjB1jfBfjx7wgxwchj6gOQhZCJlsOD2dCWwa+DbGExpxlL/LipjeU8HwIw9PVmY9GHATpVHi7z/H6XnxBlVN04wMjeAujdZBwpkOmfLg5GJx7BGXa56D8jZUHs3hy0GQXVRwuedTjIORXkMmeO+/+ZenRpdOJfVeap0vutE0vceDhJzqFOjrb1lKfg8Ce6XiykPl4qPxRTqcT/44uuhGsg4QT9oTnYSL/ypVJHAKZQtlzkH9JlUGLnNgH7aJqJA7CJWXTsV6KsWJbhtfi8b0KrlMpTJ4g3T/4vm7OeOI/+2fVeySnTlaNPZKD0Kn45hOk63v2WX1HpPL95VKYNIHv8e3KOg4P9zeKdRAzfLqbegFuIPI8ehS4tBtMT3Go5IdL84zBMtkOpx9CHvU6CAk7Hs0QmX2hLQPmBOdLAvOGWKv0vfSSbtaYj6xcORhHNXvW8OHuuM94K07Mq6tW6qtwtJdeVPkKhl2voxxdZKPwQL/pB6rnxQ9B+IQ15clguai0QaY8eE5lOJZDprSMuI1KWEh4WHiNCa6QmfLgHogpDJ57IAwVMqUxiatOnEt4hJ1O5LmSMLgnY4pQpv4EjX74u0fadR7n8mtm/iEq2tajumqVOufhv2ZykIFUUrKHzZfqk6v0FV5LqfyYL+YlHEOOlInQCQaNZKI2GTLlycDAqDAcw5THR6Hh4ETYlJYHj6LCDT9THvy/RYVOwDe8BPPg/tFQDa8J+jx0P8S9LT4UKJ45YWPnCyO4Z8HQFj9joWBZlH9hwARXy0zpToG8U5qjT2dr65hCu7O+ivlD9tijNzvwxCjcWrmsv4X0IOXSxmhdwvTZY44W5ldod9fxTfG6KItl2+RVx2kut7vFbgyTMguOUC9oMGFyED/9r7ys0jMf5veqM5NjdItl22eD0zqbjbrKN47MnS3VXz+um/0mhnKQ6uO/UtG/1RnTpWuWW9jgtnXorC2WNwevOS1t5VmJdYLJNSfdpWuv2WzIZZyD4D7taM90SP/fDW5rq87SYnlzsb6lZXf0JI/zDex5hsEfeIBUvv2A1Ko90nXXndI5ZmepfG2Zeqt75YEH1H3a0b6IdP9Aep2VxfLmJd/uLim1uz01vtF90ng18c4df5x63WjuhOPVd17nfdrRXie1WLYPMo4ztdzu/KiH5zraWiTLZVu+DqhlhvrO6yXcp51OYrFsf+QSsbmlhPtIIeGIYCLOT37ndW1isVhyiUQTeo3z+KkvWSwWi8VisVgsFovFYrFYLFHZYYf/AaE+wb5bgdUeAAAAAElFTkSuQmCC";const Oa={class:"receipt-container"},Wa={class:"receipt-body",id:"printable-area"},qa={class:"header"},Qa=["src"],Ja={class:"date"},Ma={class:"customer-info"},$a={key:0},Ba={class:"items-table"},Ha={class:"item-name"},ja={class:"sku"},Ga={class:"text-center"},za={class:"text-right"},Ya={class:"totals"},Za={class:"row"},el={key:0,class:"row discount"},tl={class:"row final-total"},al={class:"row final-total"},ll={class:"row final-total"};var sl={__name:"PrintInvoice",props:{order:{type:Object,required:!0,default:()=>({})}},setup(e){const t=e,a=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),l=e=>{if(!e)return"";const t=new Date(e),a=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${a}-${l}-${s}`},o=(0,s.EW)(()=>{const e=Number(t.order.total)||0,a=Number(t.order.discount)||0,l=t.order.surcharges?t.order.surcharges.reduce((e,t)=>e+(t.is_active?t.amount:0),0):0;return e-a+l});return(t,n)=>((0,s.uX)(),(0,s.CE)("div",Oa,[(0,s.Lk)("div",Wa,[(0,s.Lk)("div",qa,[(0,s.Lk)("img",{src:(0,be.R1)(Ua),alt:"Fitpack Logo",class:"fitpack-logo"},null,8,Qa),(0,s.Lk)("h2",null,[n[0]||(n[0]=(0,s.eW)(" HÓA ĐƠN ",-1)),(0,s.Lk)("span",null,(0,y.v_)(e.order.code),1)]),(0,s.Lk)("span",Ja,(0,y.v_)(l(e.order.date)),1)]),n[11]||(n[11]=(0,s.Lk)("div",{class:"divider"},null,-1)),(0,s.Lk)("div",Ma,[(0,s.Lk)("p",null,[n[1]||(n[1]=(0,s.Lk)("strong",null,"Khách hàng:",-1)),(0,s.eW)(" "+(0,y.v_)(e.order.customer_name+" - "+e.order.customer_phone_number),1)]),(0,s.Lk)("h3",null,(0,y.v_)(e.order.delivery_address),1),e.order.note?((0,s.uX)(),(0,s.CE)("p",$a,[n[2]||(n[2]=(0,s.Lk)("strong",null,"Ghi chú:",-1)),(0,s.eW)(" "+(0,y.v_)(e.order.note),1)])):(0,s.Q3)("",!0)]),n[12]||(n[12]=(0,s.Lk)("div",{class:"divider"},null,-1)),(0,s.Lk)("table",Ba,[n[3]||(n[3]=(0,s.Lk)("thead",{style:{"background-color":"white"}},[(0,s.Lk)("tr",{style:{"background-color":"white"}},[(0,s.Lk)("th",{class:"text-left",style:{"background-color":"white"}},"Món"),(0,s.Lk)("th",{class:"text-center",style:{"background-color":"white"}},"SL"),(0,s.Lk)("th",{class:"text-right",style:{"background-color":"white"}},"Thành tiền")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.order.items,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.uuid,class:"item-row"},[(0,s.Lk)("td",Ha,[(0,s.eW)((0,y.v_)(e.name)+" ",1),(0,s.Lk)("div",ja,(0,y.v_)(a(e.price)),1)]),(0,s.Lk)("td",Ga,(0,y.v_)(e.quantity),1),(0,s.Lk)("td",za,(0,y.v_)(a(e.price*e.quantity)),1)]))),128))])]),n[13]||(n[13]=(0,s.Lk)("div",{class:"divider"},null,-1)),(0,s.Lk)("div",Ya,[(0,s.Lk)("div",Za,[n[4]||(n[4]=(0,s.Lk)("span",null,"Tổng tiền hàng:",-1)),(0,s.Lk)("span",null,(0,y.v_)(a(e.order.total)),1)]),Number(e.order.discount)>0?((0,s.uX)(),(0,s.CE)("div",el,[n[5]||(n[5]=(0,s.Lk)("span",null,"Giảm giá:",-1)),(0,s.Lk)("span",null,"- "+(0,y.v_)(a(e.order.discount)),1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.order.surcharges,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"row"},[(0,s.Lk)("span",null,(0,y.v_)(e.description)+":",1),(0,s.Lk)("span",null,"+ "+(0,y.v_)(a(e.amount)),1)]))),128)),n[9]||(n[9]=(0,s.Lk)("div",{class:"divider-dashed"},null,-1)),(0,s.Lk)("div",tl,[n[6]||(n[6]=(0,s.Lk)("span",null,"THÀNH TIỀN:",-1)),(0,s.Lk)("span",null,(0,y.v_)(a(o.value)),1)]),(0,s.Lk)("div",al,[n[7]||(n[7]=(0,s.Lk)("span",null,"ĐÃ THANH TOÁN:",-1)),(0,s.Lk)("span",null,(0,y.v_)(a(e.order.amount_paid_by_customer)),1)]),(0,s.Lk)("div",ll,[n[8]||(n[8]=(0,s.Lk)("span",null,"CÒN LẠI:",-1)),(0,s.Lk)("span",null,(0,y.v_)(a(o.value-e.order.amount_paid_by_customer)),1)]),n[10]||(n[10]=(0,s.Lk)("div",{class:"row final-total"}," Thank you for shopping with us! ",-1))])])]))}};const ol=(0,p.A)(sl,[["__scopeId","data-v-3447db6a"]]);var nl=ol;const il={class:"modal-container"},rl={class:"modal-body"},cl={class:"top-controls"},ul={class:"label-group"},dl={class:"control-group"},pl=["value"],ml={class:"date-group"},vl=["disabled","max"],hl=["disabled"],kl={class:"customer-info"},gl={class:"customer-name font-bold"},bl={class:"customer-name"},fl={key:0,class:"customer-stats"},Ll={key:0,class:"tag debt"},yl={key:1,class:"tag points"},wl={class:"payment-details"},_l={class:"row"},Cl={class:"value-amt"},xl={class:"row"},Sl={style:{position:"relative"}},El={class:"row"},Al={style:{position:"relative"}},Tl={class:"row highlight"},Pl={class:"value font-bold text-primary"},Dl={class:"row payment-input-row"},Il=["disabled"],Kl={class:"row methods-row"},Rl={class:"radio-group"},Vl=["value"],Nl={key:0,class:"bank-holder"},Xl=["value","selected"],Fl={key:0,class:"row"},Ul={class:"value"},Ol={key:1,class:"row confirm-missing-payment"},Wl={class:"confirm-missing-payment-row"},ql={class:"value text-danger"},Ql={key:0,class:"confirm-missing-payment-row-2"},Jl={class:"row"},Ml=["value"],$l={class:"row"},Bl={class:"modal-footer"},Hl=["disabled"];var jl={__name:"Payment",props:{visible:{type:Boolean,default:!1},cartData:{type:Object,required:!0},channels:{type:Array,default:()=>[]},defaultSurcharges:{type:Array,default:()=>[]},bankAccounts:{type:Array,default:()=>[]},transportCompanies:{type:Array,default:()=>[]}},emits:["close","complete-payment","update-cart-data"],setup(e,{emit:t}){const a=(0,s.EW)(()=>{const e=new Date;return e.setDate(e.getDate()),e.toISOString().split("T")[0]}),o=e,i=(0,n.Pj)(),c=(0,be.KR)({}),u=t,d=e=>{const t=e.target.value,a=e.data||String.fromCharCode(e.which||e.keyCode);[8,9,13,27,37,39,46].includes(e.keyCode)||("%"!==a?/\d/.test(a)||e.preventDefault():(t.includes("%")||e.target.selectionStart!==t.length)&&e.preventDefault())},p=e=>{_.value=!1,q.value=e.reduce((e,t)=>e+(isNaN(Number(t.amount))?0:Number(t.amount)),0),u("update-cart-data",{...o.cartData,surcharges:e,totalSurcharge:q.value})},m=e=>{const t=e.which?e.which:e.keyCode;t>31&&(t<48||t>57)&&e.preventDefault()},v=e=>{const t=L.value;if(t.endsWith("%")){const e=t.slice(0,-1).trim(),a=parseFloat(e);isNaN(a)?(O.value=0,X.value=0):(O.value=Math.round(a/100*N.value),X.value=O.value)}else{const e=parseInt(t.replace(/\D/g,""),10);isNaN(e)?(O.value=0,X.value=0):(O.value=e,X.value=O.value)}u("update-cart-data",{...o.cartData,discount:O.value,discountMethodValue:O.value,chosenDiscountMethod:"VND"})},h=()=>{if("receivable"===M.value&&(F.value=0,V.value=!1,u("update-cart-data",{...o.cartData,amountPaidByCustomer:0,paymentMethod:M.value,paymentAccount:null})),"receivable"!==M.value&&F.value!==B.value&&(F.value=B.value),"cash"===M.value&&(J.value=1),"transfer"===M.value){const e=o.bankAccounts.find(e=>!e.bank_name.toLowerCase().includes("cash"));e&&(J.value=e.id)}u("update-cart-data",{...o.cartData,amountPaidByCustomer:F.value,paymentMethod:M.value,paymentAccount:J.value})},k=()=>{u("update-cart-data",{...o.cartData,paymentAccount:J.value})},g=(0,s.EW)({get:()=>0===F.value?"0":new Intl.NumberFormat("vi-VN").format(F.value),set:e=>{const t=e.replace(/\D/g,"");F.value=t?parseInt(t,10):0}}),b=()=>{u("update-cart-data",{...o.cartData,amountPaidByCustomer:F.value})},f=(0,s.EW)({get:()=>0===U.value?"0":new Intl.NumberFormat("vi-VN").format(U.value),set:e=>{const t=e.replace(/\D/g,"");U.value=t?parseInt(t,10):0}}),L=(0,s.EW)({get:()=>{if(0===O.value)return"0";try{if(O.value.endsWith("%"))return O.value}catch(e){}return new Intl.NumberFormat("vi-VN").format(O.value)},set:e=>{const t=e.replace(/[^\d%]/g,"");O.value=t}}),w=e=>{e.target.select()},_=(0,be.KR)(!1),C=(0,be.KR)(36934),x=o.channels||[],S=(0,be.KR)("");function E(){const e=new Date,t=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0");return`${e.getFullYear()}-${t}-${a}`}function A(){const e=new Date,t=e.getHours().toString().padStart(2,"0"),a=e.getMinutes().toString().padStart(2,"0");return`${t}:${a}`}const T=(0,be.KR)(E()),P=(0,be.KR)(A()),D=(0,be.KR)(null),I=(0,be.KR)(null);function K(e){I.value&&("function"===typeof I.value.showPicker?I.value.showPicker():I.value.focus())}function R(e){D.value&&("function"===typeof D.value.showPicker?D.value.showPicker():D.value.focus())}const V=(0,be.KR)(!1),N=(0,be.KR)(0),X=(0,be.KR)(0),F=(0,be.KR)(0),U=(0,be.KR)(0),O=(0,be.KR)(0),W=(0,be.KR)("VND"),q=(0,be.KR)(0),Q=(0,be.KR)(null),J=(0,be.KR)(1),M=(0,be.KR)("cash"),$=[{value:"cash",label:"Tiền mặt"},{value:"transfer",label:"Chuyển khoản"},{value:"receivable",label:"Công Nợ"}],B=(0,s.EW)(()=>N.value-X.value+q.value),H=(0,s.EW)(()=>F.value-B.value),j=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e);(0,s.sV)(()=>{o.cartData&&(N.value=o.cartData.total,X.value=o.cartData.discount||0,O.value=o.cartData.discountMethodValue||0,W.value=o.cartData.chosenDiscountMethod||"VND",S.value=o.cartData.channel||(x.length>0?x[0].name:""),M.value=o.cartData.paymentMethod||"cash",J.value=o.cartData.paymentAccount||1,Q.value=o.cartData.transportCompany||o.transportCompanies[0],U.value=o.cartData.amountPaidTransportCompany||0,q.value=o.cartData.surcharge||0,"receivable"===M.value?F.value=0:F.value=o.cartData.amountPaidByCustomer||N.value-X.value+q.value),T.value=E(),P.value=A()});const G=()=>{window.print()},z=async()=>{const e=o.cartData?{...o.cartData}:{};"receivable"===M.value&&(F.value=0,J.value=null),"cash"===M.value&&(J.value=1),await r.A.post("/invoices/",{...e,amount_paid_by_customer:F.value,amount_paid_transport_company:U.value,surcharges:o.cartData.surcharges||[],total_surcharge:q.value,final_total:B.value,payment_method:M.value,payment_account:J.value,channel:S.value,transport_company:Q.value?.name||"",amount_paid_transport_company:U.value,date:T.value,time:P.value,delivery_address:o.cartData.customer?o.cartData.customer.address:"",customer:o.cartData.customer?o.cartData.customer.id:1}).then(async t=>{e.paymentConfirmation=t.data,c.value=t.data,await(0,s.dY)(),G(),u("complete-payment",t.data)}).catch(e=>{console.error("Error processing payment:",e)})},Y=()=>{u("update-cart-data",{...o.cartData,discount:X.value,amountPaidByCustomer:F.value,amountPaidTransportCompany:U.value,paymentMethod:M.value,paymentAccount:J.value,selectedChannel:S.value,selectedSeller:C.value,transportCompany:Q.value,amountPaidTransportCompany:U.value}),u("close")};return(t,n)=>((0,s.uX)(),(0,s.CE)(s.FK,null,[e.visible?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-overlay",onMousedown:(0,l.D$)(Y,["self"])},[(0,s.Lk)("div",il,[(0,s.Lk)("div",rl,[(0,s.Lk)("div",cl,[(0,s.Lk)("div",ul,[(0,s.Lk)("div",dl,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":n[0]||(n[0]=e=>S.value=e),class:"form-select custom-select"},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)((0,be.R1)(x),e=>((0,s.uX)(),(0,s.CE)("option",{key:e.name,value:e.name},(0,y.v_)(e.name),9,pl))),128))],512),[[l.u1,S.value]])]),(0,s.Lk)("div",ml,[(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":n[1]||(n[1]=e=>T.value=e),class:"form-input date-input",disabled:!(0,be.R1)(i).getters.userAdmin,onClick:n[2]||(n[2]=e=>R(e)),ref_key:"dateInputRef",ref:D,max:a.value},null,8,vl),[[l.Jo,T.value]]),(0,s.bo)((0,s.Lk)("input",{type:"time","onUpdate:modelValue":n[3]||(n[3]=e=>P.value=e),class:"form-input time-input",disabled:!(0,be.R1)(i).getters.userAdmin,onClick:n[4]||(n[4]=e=>K(e)),ref_key:"timeInputRef",ref:I},null,8,hl),[[l.Jo,P.value]])])]),(0,s.Lk)("div",{class:"close-btn-group"},[(0,s.Lk)("button",{onClick:Y,class:"close-btn"},"x")])]),(0,s.Lk)("div",kl,[(0,s.Lk)("span",gl,(0,y.v_)(o.cartData?.customer?.name||"Khách lẻ"),1),(0,s.Lk)("span",bl,(0,y.v_)(o.cartData?.customer?.address||""),1),o.cartData?.customer?((0,s.uX)(),(0,s.CE)("div",fl,[o.cartData.customer.debt?((0,s.uX)(),(0,s.CE)("span",Ll," Nợ: "+(0,y.v_)(j(o.cartData.customer.debt)),1)):(0,s.Q3)("",!0),o.cartData.customer.points?((0,s.uX)(),(0,s.CE)("span",yl," Điểm: "+(0,y.v_)(o.cartData.customer.points),1)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",wl,[(0,s.Lk)("div",_l,[n[13]||(n[13]=(0,s.Lk)("span",{class:"row-label"},"Tổng tiền hàng",-1)),n[14]||(n[14]=(0,s.Lk)("span",{class:"side-info"},null,-1)),(0,s.Lk)("div",Cl,(0,y.v_)(j(N.value)),1)]),(0,s.Lk)("div",xl,[n[15]||(n[15]=(0,s.Lk)("span",{class:"row-label"},"Giảm giá",-1)),n[16]||(n[16]=(0,s.Lk)("span",{class:"side-info"},null,-1)),(0,s.Lk)("div",Sl,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":n[5]||(n[5]=e=>L.value=e),onFocus:w,onKeypress:d,onChange:v,class:"value-input font-bold text-right customer-payment-input",placeholder:"0"},null,544),[[l.Jo,L.value]])])]),(0,s.Lk)("div",El,[n[17]||(n[17]=(0,s.Lk)("span",{class:"row-label"},"Thu khác",-1)),n[18]||(n[18]=(0,s.Lk)("span",{class:"side-info"},null,-1)),(0,s.Lk)("div",Al,[(0,s.Lk)("button",{class:"value-amt",onClick:n[6]||(n[6]=e=>_.value=!0)},(0,y.v_)(j(q.value)),1)])]),n[26]||(n[26]=(0,s.Lk)("hr",{class:"divider"},null,-1)),(0,s.Lk)("div",Tl,[n[19]||(n[19]=(0,s.Lk)("label",{class:"font-bold"},"Khách cần trả",-1)),(0,s.Lk)("div",Pl,(0,y.v_)(j(B.value)),1)]),(0,s.Lk)("div",Dl,[n[20]||(n[20]=(0,s.Lk)("label",{class:"font-bold"},"Khách thanh toán",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":n[7]||(n[7]=e=>g.value=e),onFocus:w,onKeypress:m,onChange:b,disabled:"receivable"==M.value,class:"value-input font-bold text-right customer-payment-input",placeholder:"0"},null,40,Il),[[l.Jo,g.value]])]),(0,s.Lk)("div",Kl,[(0,s.Lk)("div",Rl,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)($,e=>(0,s.Lk)("label",{key:e.value,class:"radio-label"},[(0,s.bo)((0,s.Lk)("input",{type:"radio",value:e.value,"onUpdate:modelValue":n[8]||(n[8]=e=>M.value=e),onChange:h},null,40,Vl),[[l.XL,M.value]]),(0,s.eW)(" "+(0,y.v_)(e.label),1)])),64))]),"transfer"===M.value?((0,s.uX)(),(0,s.CE)("div",Nl,[(0,s.bo)((0,s.Lk)("select",{class:"form-select custom-select","onUpdate:modelValue":n[9]||(n[9]=e=>J.value=e),onChange:k},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.bankAccounts,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id,selected:e.default,class:(0,y.C4)({"d-none":e.bank_name.toLowerCase().includes("cash")})},(0,y.v_)(e.bank_name+" - "+e.account_number),11,Xl))),128))],544),[[l.u1,J.value]])])):(0,s.Q3)("",!0)]),H.value>0?((0,s.uX)(),(0,s.CE)("div",Fl,[n[21]||(n[21]=(0,s.Lk)("label",null,"Tiền thừa trả khách",-1)),(0,s.Lk)("div",Ul,(0,y.v_)(j(H.value)),1)])):H.value<0?((0,s.uX)(),(0,s.CE)("div",Ol,[(0,s.Lk)("div",Wl,[n[22]||(n[22]=(0,s.Lk)("label",{class:"text-danger"},"Khách còn thiếu",-1)),(0,s.Lk)("div",ql,(0,y.v_)(j(Math.abs(H.value))),1)]),"receivable"!==M.value?((0,s.uX)(),(0,s.CE)("div",Ql,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[10]||(n[10]=e=>V.value=e)},null,512),[[l.lH,V.value]]),n[23]||(n[23]=(0,s.eW)(" Xác nhận thanh toán thiếu ",-1))])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),n[27]||(n[27]=(0,s.Lk)("hr",{class:"divider"},null,-1)),(0,s.Lk)("div",Jl,[n[24]||(n[24]=(0,s.Lk)("label",null,"Đơn vị vận chuyển",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":n[11]||(n[11]=e=>Q.value=e),class:"form-select custom-select transport-company-select"},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.transportCompanies,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e},(0,y.v_)(e.name),9,Ml))),128))],512),[[l.u1,Q.value]])]),(0,s.Lk)("div",$l,[n[25]||(n[25]=(0,s.Lk)("label",{for:""}," Phí ship mình trả tiền mặt",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":n[12]||(n[12]=e=>f.value=e),onFocus:w,onKeypress:m,type:"text",class:"value-input font-bold text-right transport-company-amount"},null,544),[[l.Jo,f.value]])])])]),(0,s.Lk)("div",Bl,[(0,s.Lk)("button",{class:"btn-primary",onClick:z,disabled:"receivable"!==M.value&&F.value<B.value&&!V.value},"Thanh toán",8,Hl)])])],32)):(0,s.Q3)("",!0),_.value?((0,s.uX)(),(0,s.Wv)(Fa,{key:1,visible:_.value,"default-surcharges":o.defaultSurcharges,"chosen-surcharges":o?.cartData?.surcharges||[],onClose:p},null,8,["visible","default-surcharges","chosen-surcharges"])):(0,s.Q3)("",!0),c.value.id?((0,s.uX)(),(0,s.Wv)(nl,{order:c.value,key:"print-invoice-"+c.value.id+"-"+JSON.stringify(c.value)},null,8,["order"])):(0,s.Q3)("",!0)],64))}};const Gl=(0,p.A)(jl,[["__scopeId","data-v-b7b90920"]]);var zl=Gl;const Yl={key:0,class:"alert-module"},Zl={class:"alert-message"};var es={__name:"AlertModule",props:{message:{type:String,required:!0},duration:{type:Number,default:3e4}},setup(e){const t=e,a=(0,be.KR)(!0);let l=setTimeout(()=>{a.value=!1},t.duration);function o(){a.value=!1,clearTimeout(l)}return(0,s.hi)(()=>{clearTimeout(l)}),(t,l)=>a.value?((0,s.uX)(),(0,s.CE)("div",Yl,[(0,s.Lk)("span",Zl,(0,y.v_)(e.message),1),(0,s.Lk)("span",{class:"alert-close",onClick:o},"×")])):(0,s.Q3)("",!0)}};const ts=(0,p.A)(es,[["__scopeId","data-v-11ecf15b"]]);var as=ts;const ls={class:"window-header"},ss={class:"window-title"},os={class:"no-select"},ns={class:"window-actions no-select"},is={class:"window-content"},rs={class:"form-body"},cs={class:"tab-pane"},us={class:"form-layout"},ds={class:"col-left"},ps={class:"form-group"},ms=["min","max"],vs={class:"form-group"},hs={class:"form-group"},ks={class:"form-group"},gs=["value"],bs={class:"col-right"},fs={class:"form-group"},Ls=["value"],ys={class:"form-group"},ws={class:"form-group"},_s=["disabled"],Cs={class:"window-footer"},xs=["disabled"];function Ss(e,t,a,o,n,i){return(0,s.uX)(),(0,s.CE)("div",{class:"modal-overlay",onMousedown:t[13]||(t[13]=(0,l.D$)(t=>e.$emit("close"),["self"]))},[(0,s.Lk)("div",{class:"transaction-window",onClick:t[12]||(t[12]=(0,l.D$)(()=>{},["stop"])),style:{"border-radius":"0.5rem"}},[(0,s.Lk)("div",ls,[(0,s.Lk)("span",ss,[(0,s.Lk)("span",os,(0,y.v_)((o.item&&o.item.id?"Sửa ":"Lập ")+("DR"===o.debit_or_credit?"Phiếu Thu":"Phiếu Chi")),1)]),(0,s.Lk)("div",ns,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},[...t[14]||(t[14]=[(0,s.Lk)("span",null,"×",-1)])])])]),(0,s.Lk)("div",is,[t[23]||(t[23]=(0,s.Lk)("div",{class:"tabs-nav no-select"},[(0,s.Lk)("ul",null,[(0,s.Lk)("li",{class:"active"},[(0,s.Lk)("a",{href:"#"},"Thông tin chung")])])],-1)),(0,s.Lk)("div",rs,[(0,s.Lk)("div",cs,[(0,s.Lk)("div",us,[(0,s.Lk)("div",ds,[(0,s.Lk)("div",ps,[t[15]||(t[15]=(0,s.Lk)("label",{for:"date"},"Ngày",-1)),(0,s.bo)((0,s.Lk)("input",{id:"date",ref:"dateInput","onUpdate:modelValue":t[1]||(t[1]=e=>o.date=e),type:"date",required:"",onClick:t[2]||(t[2]=(...e)=>o.openDatePicker&&o.openDatePicker(...e)),min:o.minDate,max:o.maxDate},null,8,ms),[[l.Jo,o.date]])]),(0,s.Lk)("div",vs,[t[16]||(t[16]=(0,s.Lk)("label",{for:"amount"},"Số tiền",-1)),(0,s.bo)((0,s.Lk)("input",{id:"amount","onUpdate:modelValue":t[3]||(t[3]=e=>o.amountDisplay=e),type:"text",required:"",style:{"text-align":"right"},onFocus:t[4]||(t[4]=(...e)=>o.selectAll&&o.selectAll(...e))},null,544),[[l.Jo,o.amountDisplay]])]),(0,s.Lk)("div",hs,[t[18]||(t[18]=(0,s.Lk)("label",{for:"debit_or_credit"},"Loại phiếu",-1)),(0,s.bo)((0,s.Lk)("select",{id:"debit_or_credit","onUpdate:modelValue":t[5]||(t[5]=e=>o.debit_or_credit=e),required:"",disabled:""},[...t[17]||(t[17]=[(0,s.Lk)("option",{value:"DR"},"Thu (Debit)",-1),(0,s.Lk)("option",{value:"CR"},"Chi (Credit)",-1)])],512),[[l.u1,o.debit_or_credit]])]),(0,s.Lk)("div",ks,[t[19]||(t[19]=(0,s.Lk)("label",{for:"account"},"Tài khoản",-1)),(0,s.bo)((0,s.Lk)("select",{id:"account","onUpdate:modelValue":t[6]||(t[6]=e=>o.account_id=e),required:""},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.accounts,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,y.v_)(e.bank_name)+" - "+(0,y.v_)(e.account_number)+" ("+(0,y.v_)(e.account_holder_name)+") ",9,gs))),128))],512),[[l.u1,o.account_id]])])]),(0,s.Lk)("div",bs,[(0,s.Lk)("div",fs,[t[20]||(t[20]=(0,s.Lk)("label",{for:"transaction_type"},"Loại giao dịch",-1)),(0,s.bo)((0,s.Lk)("select",{id:"transaction_type","onUpdate:modelValue":t[7]||(t[7]=e=>o.transaction_type_id=e),required:""},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredTransactionTypes,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,y.v_)(e.name),9,Ls))),128))],512),[[l.u1,o.transaction_type_id]])]),(0,s.Lk)("div",ys,[t[21]||(t[21]=(0,s.Lk)("label",{for:"description"},"Mô tả",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"description","onUpdate:modelValue":t[8]||(t[8]=e=>o.description=e),rows:"3"},null,512),[[l.Jo,o.description]])]),(0,s.Lk)("div",ws,[t[22]||(t[22]=(0,s.Lk)("label",{for:"is_active"},"Kích hoạt",-1)),(0,s.bo)((0,s.Lk)("input",{id:"is_active","onUpdate:modelValue":t[9]||(t[9]=e=>o.isActive=e),type:"checkbox",disabled:!o.store.getters.userAdmin||!o.store.getters.userSuperadmin},null,8,_s),[[l.lH,o.isActive]])])])])])]),(0,s.Lk)("div",Cs,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline",onClick:t[10]||(t[10]=t=>e.$emit("close"))},"Đóng"),(0,s.Lk)("button",{type:"button",class:"btn btn-primary new-button",onClick:t[11]||(t[11]=(...e)=>o.handleSubmit&&o.handleSubmit(...e)),disabled:"0"===o.amountDisplay||!o.description.trim()},"Lưu",8,xs)])])])],32)}var Es={name:"AddEditTrans",props:{item:{type:Object,default:null},accounts:{type:Array,default:()=>[]},transactionTypes:{type:Array,default:()=>[]},d_edit_days:{type:Number,default:0}},emits:["close","saved"],setup(e,{emit:t}){const{item:a,accounts:l,transactionTypes:o,d_edit_days:i}=(0,be.QW)(e),c=(0,be.KR)(null),u=e=>{const t=6e4*e.getTimezoneOffset(),a=new Date(e-t).toISOString().slice(0,10);return a},d=(0,n.Pj)(),p=(0,s.EW)(()=>u(new Date)),m=(0,s.EW)(()=>{if(d.getters.userAdmin||d.getters.userSuperadmin)return"";const t=new Date,a=new Date;return a.setDate(t.getDate()-(e.d_edit_days||3)),u(a)}),v=(0,be.KR)(a.value?.debit_or_credit||"DR"),h=(0,be.KR)(a.value&&a.value.id?a.value.amount:""),k=(0,be.KR)(a.value&&a.value.id?a.value.account:1),g=(0,be.KR)(a.value&&a.value.id?a.value.date:(new Date).toISOString().slice(0,10)),b=(0,be.KR)(a.value&&a.value.id?a.value.ref:""),f=(0,be.KR)(a.value&&a.value.id?a.value.description:""),L=(0,be.KR)(!a.value||void 0===a.value.is_active||a.value.is_active),y=(0,s.EW)(()=>o.value?o.value.filter(e=>e.debit_or_credit===v.value):[]),w=(0,be.KR)(a.value&&a.value.id?a.value.transaction_type:"DR"===a.value?.debit_or_credit?2:1);(0,s.wB)(y,e=>{const t=a.value&&a.value.id;!t&&e&&e.length>0&&!w.value&&(w.value=e[0].id)});const _=(0,s.EW)({get:()=>""===h.value||0===h.value?"0":new Intl.NumberFormat("vi-VN").format(h.value),set:e=>{const t=e.replace(/\D/g,"");h.value=t?parseInt(t,10):0}});function C(){if(c.value)if("function"===typeof c.value.showPicker)try{c.value.showPicker()}catch(e){c.value.focus()}else c.value.focus()}async function x(){const e={transaction_type:w.value,debit_or_credit:v.value,amount:h.value,account:k.value,date:g.value,ref:b.value,description:f.value,is_active:L.value};a.value&&a.value.id?await r.A.put(`/transactions/${a.value.id}/`,e).then(e=>{t("saved",e.data)}).catch(e=>{console.error("Error updating transaction:",e),window.alert("Lỗi khi cập nhật giao dịch: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))}):await r.A.post("/transactions/",e).then(e=>{t("saved",e.data)}).catch(e=>{console.error("Error creating transaction:",e),window.alert("Lỗi khi tạo giao dịch: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))})}function S(e){e.target.select()}return(0,s.wB)(a,e=>{const t=e&&e.id;v.value=e?.debit_or_credit||"DR",w.value=t?e.transaction_type:null,h.value=t?e.amount:"",k.value=t?e.account:null,g.value=t?e.date:(new Date).toISOString().slice(0,10),b.value=t?e.ref:"",f.value=t?e.description:"",L.value=!e||void 0===e.is_active||e.is_active}),{transaction_type_id:w,debit_or_credit:v,amount:h,amountDisplay:_,account_id:k,date:g,ref_field:b,description:f,isActive:L,item:a,accounts:l,transactionTypes:o,filteredTransactionTypes:y,dateInput:c,openDatePicker:C,handleSubmit:x,selectAll:S,minDate:m,maxDate:p,store:d}}};const As=(0,p.A)(Es,[["render",Ss],["__scopeId","data-v-108df820"]]);var Ts=As,Ps={name:"SaleView",components:{menu_toggle:ge,AddCust:Ye,Carts:Zt,ProfuctFilterCate:ya,Payment:zl,AlertModule:as,AddEditTrans:Ts},data(){return{products:[],filteredProducts:[],localPendingSales:[],branch:"",isCustomerModalOpen:!1,isPaymentModalOpen:!1,focus_invoice:{},isFilterModalOpen:!1,filteredCust:[],provinces:[],wards:[],productGroupFilter:[],editOrNew:"new",bankAccounts:[],transportCompanies:[],channels:[],defaultSurcharges:[],allAccounts:[],transactionTypes:[],showAddEditTrans:!1,selectedTransItem:{},searchQuery:"",sampleInvoice:{id:1,total:0,totalItems:0,discount:0,finalTotal:0,note:"",customer:null,totalSurcharge:0,surcharges:[],paymentMethod:"cash",paymentAccount:1,chosenDiscountMethod:"VND",discountMethodValue:0,transportCompany:null,amountPaidByCustomer:0,changeDue:0,amountPaidTransportCompany:0,chosenBankAccount:null,items:[]}}},computed:{user(){return this.$store.getters.userName}},methods:{handleMenuAction(e){switch(e){case"viewReport":this.$router.push("/manage");break;case"receipt":this.selectedTransItem={debit_or_credit:"DR"},this.showAddEditTrans=!0;break;case"payment":this.selectedTransItem={debit_or_credit:"CR"},this.showAddEditTrans=!0;break;case"date_end_inventory":this.$router.push("/manage?view=date_end_inventory");break;case"date_end_cash_balance":this.$router.push("/manage?view=date_end_cash_balance");break;default:console.log("Unknown action:",e)}},onTransSaved(){this.showAddEditTrans=!1,this.triggerAlert("Lưu giao dịch thành công!",3e3)},triggerAlert(e,t=3e4){const a=document.createElement("div");document.body.appendChild(a);const s=(0,l.Ef)(as,{message:e,duration:t});s.mount(a),setTimeout(()=>{s.unmount(),document.body.removeChild(a)},t+1e3)},async handleCompletePayment(e){if(!this.isPaymentModalOpen)return;console.log("Payment completed with payload:",e),console.log("Pending sales before payment:",this.localPendingSales),console.log("Focus invoice before payment:",this.focus_invoice),console.log("Removing invoice with ID:",this.focus_invoice.id),setTimeout(()=>{},10),this.localPendingSales=this.localPendingSales.filter(e=>parseInt(e.id)!==parseInt(this.focus_invoice.id)),console.log("Pending sales after removal:",this.localPendingSales),await this.$nextTick(),localStorage.setItem("pendingSales",JSON.stringify(this.localPendingSales)),this.localPendingSales.length>0?this.select_pending_invoice(this.localPendingSales[0].id,null):(this.add_new_pending_sale(),localStorage.setItem("pendingSales",JSON.stringify(this.localPendingSales)),this.select_pending_invoice(this.localPendingSales[0].id,null),this.focus_invoice=this.localPendingSales[0]),console.log("Pending sales after payment:",this.localPendingSales),this.isPaymentModalOpen=!1;const t="Tạo hóa đơn #"+e.code+" thành công!";this.triggerAlert(t,5e3)},openPaymentModal(){this.focus_invoice=JSON.parse(JSON.stringify(this.focus_invoice)),this.isPaymentModalOpen=!0},limit_text(e,t){return e.length<=t?e:e.slice(0,t)+"..."},select_focus_customer(e){this.focus_invoice.customer=e,this.handleUpdateItem(this.focus_invoice),document.querySelector(".customer-search-input").value=""},applyProductFilter(e){this.productGroupFilter=e},formatPrice(e){return new Intl.NumberFormat("vi-VN").format(e)},search_input_focus(e){e.target.select()},search_input_blur(e){document.querySelector(".product-search-results").classList.add("is-hidden")},async fetchSurcharges(){try{const e=await r.A.get("/surcharges/");this.defaultSurcharges=e.data.filter(e=>e.is_active)}catch(e){console.error("Error fetching surcharges:",e)}},async search_input_change_cust(e){document.querySelector(".customer-search-results").classList.remove("is-hidden");const t=e.target.value.toLowerCase();await r.A.get("/search_customers/",{params:{query:t,exclude:"SP_"}}).then(e=>{this.filteredCust=e.data}).catch(e=>{console.error("Error searching customers:",e)})},search_input_cust_blur(e){document.querySelector(".customer-search-results").classList.add("is-hidden")},search_input_change(e){document.querySelector(".product-search-results").classList.remove("is-hidden");const t=e.target.value.toLowerCase();this.searchQuery=t,this.filteredProducts=this.products.filter(e=>e.name.toLowerCase().includes(t)||e.code.toLowerCase().includes(t))},async select_pending_invoice(e,t){const a=document.querySelectorAll(".pending-sales-item");a.forEach(e=>{e.classList.remove("selected")});const l=document.querySelector(`[data-sale-id="${e}"]`);l&&l.classList.add("selected"),this.focus_invoice=this.localPendingSales.find(t=>t.id===e),localStorage.setItem("selected_invoice_id",e)},remove_pending_sale(e){e.stopPropagation();const t=Array.from(e.currentTarget.parentNode.parentNode.children).indexOf(e.currentTarget.parentNode);this.localPendingSales.splice(t,1),0===this.localPendingSales.length?(this.focus_invoice={},localStorage.removeItem("selected_invoice_id"),this.localPendingSales.push(this.sampleInvoice),this.select_pending_invoice(this.localPendingSales[0].id,null)):this.select_pending_invoice(this.localPendingSales[0].id,null),localStorage.setItem("pendingSales",JSON.stringify(this.localPendingSales))},async add_new_pending_sale(){const e=this.localPendingSales.length>0?Math.max(...this.localPendingSales.map(e=>e.id))+1:1,t=JSON.parse(JSON.stringify(this.sampleInvoice));t.id=e,this.localPendingSales.push(t),localStorage.setItem("pendingSales",JSON.stringify(this.localPendingSales)),this.$nextTick(()=>{this.select_pending_invoice(e,null)})},async handleUpdateItem(e){const t=this.localPendingSales.findIndex(t=>t.id===e.id);-1!==t&&(this.localPendingSales.splice(t,1,e),localStorage.setItem("pendingSales",JSON.stringify(this.localPendingSales))),await this.select_pending_invoice(e.id,null)},async update_total_and_quantity(){if(!this.focus_invoice||!Array.isArray(this.focus_invoice.items))return;let e=0,t=0;this.focus_invoice.items.forEach(a=>{e+=(a.price||0)*(a.quantity||0),t+=a.quantity||0}),this.focus_invoice.total=e,this.focus_invoice.finalTotal=e-(this.focus_invoice.discount||0)+(this.focus_invoice.totalSurcharge||0),this.focus_invoice.totalItems=t},remove_focus_customer(){this.focus_invoice.customer=null,this.handleUpdateItem(this.focus_invoice)},async add_product(e){if(!e)return;const t=this.focus_invoice.items.find(t=>t.code===e.code);t?t.quantity+=1:this.focus_invoice.items.push({code:e.code,name:e.name,price:e.price,quantity:1,hasNote:!1,product_type:e.product_type,package_details:e.package_details||null,note:"",isOpenPopover:!1}),await this.update_total_and_quantity(),await this.handleUpdateItem(this.focus_invoice)},async fetchProducts(){try{const e=await r.A.get("/products/");this.products=e.data.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at)),this.products=this.products.filter(e=>e.is_active)}catch(e){console.error("Error fetching products:",e)}},async fetchProductGroups(){try{const e=await r.A.get("/productgroups/");this.productGroups=e.data}catch(e){console.error("Error fetching product groups:",e)}},async fetchLogicConfigs(){r.A.get("/logicconfigs/").then(e=>{for(const t of e.data)"branch_name"===t.key&&(this.branch=t.value),"channels"===t.key&&(this.channels=JSON.parse(t.value)),"transportCompanies"===t.key&&(this.transportCompanies=JSON.parse(t.value))}).catch(e=>{console.error("Error fetching logic configurations:",e)})},async fetchProvincesWards(){try{const[e,t]=await Promise.all([r.A.get("/provinces/"),r.A.get("/wards/")]);this.provinces=e.data,this.wards=t.data}catch(e){console.error("Error fetching provinces or wards:",e)}},async fetchBankAccounts(){try{const e=await r.A.get("/accounts/");this.allAccounts=e.data.filter(e=>e.is_active),this.bankAccounts=this.allAccounts.filter(e=>"Cash"!==e.bank_name)}catch(e){console.error("Error fetching bank accounts:",e)}},async fetchTransactionTypes(){try{const e=await r.A.get("/transactiontypes/");this.transactionTypes=e.data}catch(e){console.error("Error fetching transaction types:",e)}}},created(){this.fetchProducts(),this.fetchProductGroups(),this.fetchLogicConfigs(),this.fetchProvincesWards(),this.fetchSurcharges(),this.fetchBankAccounts(),this.fetchTransactionTypes();const e=localStorage.getItem("pendingSales");e?(this.localPendingSales=JSON.parse(e),this.focus_invoice=this.localPendingSales[0]):(this.localPendingSales.push(this.sampleInvoice),this.focus_invoice=this.localPendingSales[0])},mounted(){const e=localStorage.getItem("selected_invoice_id");parseInt(e)?this.select_pending_invoice(parseInt(e),null):this.focus_invoice=this.localPendingSales[0]}};const Ds=(0,p.A)(Ps,[["render",ne],["__scopeId","data-v-99502ed0"]]);var Is=Ds;const Ks={class:"manage-view"},Rs={class:"manage"},Vs={class:"kv-navbar kv-navbar-main"},Ns={class:"kv-navbar-container"},Xs={class:"kv-navbar-list"},Fs=["onClick"],Us={class:"kv-navbar-list"},Os={class:"kv-navbar-item kv-navbar-item-light"},Ws={class:"text-white"},qs={key:0,class:"kv-navbar-item kv-navbar-item-light"},Qs={class:"main-area"};function Js(e,t,a,o,n,i){const r=(0,s.g2)("Products"),c=(0,s.g2)("Customers"),u=(0,s.g2)("Invoices"),d=(0,s.g2)("Settings"),p=(0,s.g2)("Trans"),m=(0,s.g2)("Users"),v=(0,s.g2)("Purchases"),h=(0,s.g2)("DateEndInventory"),k=(0,s.g2)("DateEndCashBalance");return(0,s.uX)(),(0,s.CE)("div",Ks,[(0,s.Lk)("div",Rs,[(0,s.Lk)("nav",Vs,[(0,s.Lk)("section",Ns,[(0,s.Lk)("ul",Xs,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(this.menus,t=>((0,s.uX)(),(0,s.CE)("li",{key:t.Id,class:(0,y.C4)(["kv-navbar-item kv-dropdown kv-menu-item",{active:n.activeView===t.name,"d-none":t.require_admin&&!e.$store.getters.userAdmin}])},[(0,s.Lk)("a",{onClick:(0,l.D$)(e=>i.setActiveView(t.name),["prevent"])},[(0,s.Lk)("span",null,(0,y.v_)(t.name),1)],8,Fs)],2))),128))]),(0,s.Lk)("ul",Us,[t[2]||(t[2]=(0,s.Lk)("li",{class:"kv-navbar-item kv-navbar-item-light"},[(0,s.Lk)("a",{class:"kv-nav-link",href:"/sale/"},[(0,s.Lk)("i",{class:"fas fa-cart-shopping icon-item"}),(0,s.Lk)("span",null,"Bán hàng")])],-1)),(0,s.Lk)("li",Os,[(0,s.Lk)("span",Ws,(0,y.v_)(e.$store.getters.userName),1)]),e.$store.getters.isAuthenticated?((0,s.uX)(),(0,s.CE)("li",qs,[(0,s.Lk)("a",{class:"kv-nav-link",onClick:t[0]||(t[0]=(0,l.D$)((...e)=>i.handleSignOut&&i.handleSignOut(...e),["prevent"]))},[...t[1]||(t[1]=[(0,s.Lk)("i",{class:"fas fa-sign-out-alt icon-item"},null,-1)])])])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",Qs,["Sản phẩm"===n.activeView?((0,s.uX)(),(0,s.Wv)(r,{key:0,isVisible:!0})):(0,s.Q3)("",!0),"Khách hàng"===n.activeView?((0,s.uX)(),(0,s.Wv)(c,{key:1,isVisible:!0})):(0,s.Q3)("",!0),"Hóa Đơn"===n.activeView?((0,s.uX)(),(0,s.Wv)(u,{key:2,isVisible:!0,channels:n.channels,d_edit_days:n.d_edit_days},null,8,["channels","d_edit_days"])):(0,s.Q3)("",!0),"Cài đặt"===n.activeView?((0,s.uX)(),(0,s.Wv)(d,{key:3,isVisible:!0})):(0,s.Q3)("",!0),"Sổ quỹ"===n.activeView?((0,s.uX)(),(0,s.Wv)(p,{key:4,isVisible:!0,d_edit_days:n.d_edit_days},null,8,["d_edit_days"])):(0,s.Q3)("",!0),"Người dùng"===n.activeView?((0,s.uX)(),(0,s.Wv)(m,{key:5,isVisible:!0})):(0,s.Q3)("",!0),"Mua hàng"===n.activeView?((0,s.uX)(),(0,s.Wv)(v,{key:6,isVisible:!0,d_edit_days:n.d_edit_days},null,8,["d_edit_days"])):(0,s.Q3)("",!0),"Chốt Kho"===n.activeView?((0,s.uX)(),(0,s.Wv)(h,{key:7,isVisible:!0,d_edit_days:n.d_edit_days},null,8,["d_edit_days"])):(0,s.Q3)("",!0),"Chốt Quỹ"===n.activeView?((0,s.uX)(),(0,s.Wv)(k,{key:8,isVisible:!0,d_edit_days:n.d_edit_days},null,8,["d_edit_days"])):(0,s.Q3)("",!0)])])])}const Ms={class:"work-area"},$s={class:"top-area"},Bs={class:"action-area"},Hs={class:"page-actions"},js={class:"datatable-toolbar"},Gs=["value"],zs={class:"other-actions"},Ys={class:"buttons-area"},Zs={class:"list-product-groups btn-group",style:{position:"relative"}},eo={style:{margin:"0",padding:"0","list-style":"none"}},to=["onClick"],ao={style:{padding:"0.5rem 0","border-bottom":"none"}},lo={style:{"text-align":"right","margin-top":"0.5rem"}},so={class:"bottom-area"},oo={class:"filter-area"},no={class:"filters"},io={class:"form-group"},ro={class:"checkbox-group"},co={class:"form-group"},uo={class:"multiselect-dropdown",ref:"productGroupFilterDropdownRef"},po={key:0,class:"multiselect-menu"},mo={class:"multiselect-item"},vo=["value"],ho={class:"data-area"},ko=["onClick"],go={style:{display:"flex","align-items":"center",width:"100%"}};function bo(e,t,a,o,n,i){const r=(0,s.g2)("v-data-table"),c=(0,s.g2)("AddEditProduct"),u=(0,s.g2)("AddEditProductGroup");return(0,s.uX)(),(0,s.CE)("div",Ms,[(0,s.Lk)("div",$s,[t[17]||(t[17]=(0,s.Lk)("div",{class:"page-name-area"},"Hàng Hóa",-1)),(0,s.Lk)("div",Bs,[(0,s.Lk)("div",Hs,[(0,s.Lk)("div",js,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.filterText=e),placeholder:"Tìm kiếm...",class:"search-input",style:{"margin-right":"1rem"}},null,512),[[l.Jo,o.filterText]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.pageSize=e),class:"page-size-select"},[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)([5,10,20,50,100,200],e=>(0,s.Lk)("option",{key:e,value:e},(0,y.v_)(e)+" rows",9,Gs)),64))],512),[[l.u1,o.pageSize]])])]),(0,s.Lk)("div",zs,[(0,s.Lk)("div",Ys,[(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>o.createNewProduct&&o.createNewProduct(...e)),class:"btn btn-primary",style:{"margin-right":"0.5rem"}}," Tạo mới "),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>o.toggleGroupList&&o.toggleGroupList(...e)),class:"btn btn-outline create-new-btn-group",style:{"margin-right":"0.5rem"}}," Nhóm SP "),(0,s.Lk)("div",Zs,[((0,s.uX)(),(0,s.Wv)(s.Im,{to:"body"},[o.showGroupList?((0,s.uX)(),(0,s.CE)("div",{key:0,ref:"groupListRef",class:"product-group-teleport",onClick:t[6]||(t[6]=(0,l.D$)(e=>o.showGroupList=!1,["self"])),style:(0,y.Tr)({position:"fixed",maxHeight:"50vh",overflow:"auto",top:o.groupListPosition.top,left:o.groupListPosition.left,zIndex:9999,background:"white",border:"1px solid #ccc",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",padding:"1rem",minWidth:o.groupListPosition.width})},[(0,s.Lk)("ul",eo,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.productGroups,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.id,style:{padding:"0.5rem 0","border-bottom":"1px solid #eee"}},[(0,s.Lk)("span",null,(0,y.v_)(e.name),1),(0,s.Lk)("button",{onClick:(0,l.D$)(t=>o.openAddEditProductGroup(e),["stop","prevent"]),class:"c-button"},[...t[15]||(t[15]=[(0,s.Lk)("i",{class:"fa-solid fa-pen-to-square"},null,-1)])],8,to)]))),128)),(0,s.Lk)("li",ao,[(0,s.Lk)("button",{onClick:t[4]||(t[4]=e=>o.openAddEditProductGroup(null)),style:{padding:"0.3rem 1rem"}},"+ Tạo nhóm mới")])]),(0,s.Lk)("div",lo,[(0,s.Lk)("button",{onClick:t[5]||(t[5]=e=>o.showGroupList=!1),style:{padding:"0.3rem 1rem"}},"Đóng")])],4)):(0,s.Q3)("",!0)]))]),(0,s.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>o.exportToCSV&&o.exportToCSV(...e)),class:"btn btn-secondary"},[...t[16]||(t[16]=[(0,s.Lk)("i",{class:"fa-solid fa-file-excel",style:{"margin-right":"0.5rem"}},null,-1),(0,s.eW)(" Export CSV ",-1)])])])])])]),(0,s.Lk)("div",so,[(0,s.Lk)("div",oo,[(0,s.Lk)("div",no,[(0,s.Lk)("div",io,[t[20]||(t[20]=(0,s.Lk)("label",null,"Trạng thái",-1)),(0,s.Lk)("div",ro,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>o.isActiveFilter=e),value:!0},null,512),[[l.lH,o.isActiveFilter]]),t[18]||(t[18]=(0,s.eW)(" Kích hoạt",-1))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=e=>o.isActiveFilter=e),value:!1},null,512),[[l.lH,o.isActiveFilter]]),t[19]||(t[19]=(0,s.eW)(" Không kích hoạt",-1))])])]),(0,s.Lk)("div",co,[t[22]||(t[22]=(0,s.Lk)("label",null,"Nhóm sản phẩm",-1)),(0,s.Lk)("div",uo,[(0,s.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>o.toggleProductGroupFilterDropdown&&o.toggleProductGroupFilterDropdown(...e)),class:"multiselect-toggle"},(0,y.v_)(o.selectedGroupNames),1),o.showProductGroupFilterDropdown?((0,s.uX)(),(0,s.CE)("div",po,[(0,s.Lk)("div",mo,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=e=>o.allGroupsSelected=e),style:{"margin-right":"0.5rem"}},null,512),[[l.lH,o.allGroupsSelected]]),t[21]||(t[21]=(0,s.eW)(" Tất cả ",-1))])]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.productGroups,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"multiselect-item"},[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[12]||(t[12]=e=>o.productGroupFilter=e),value:e.id,style:{"margin-right":"0.5rem"}},null,8,vo),[[l.lH,o.productGroupFilter]]),(0,s.eW)(" "+(0,y.v_)(e.name),1)])]))),128))])):(0,s.Q3)("",!0)],512)])])]),(0,s.Lk)("div",ho,[(0,s.bF)(r,{headers:o.headers,items:o.filteredProducts,"items-per-page":o.pageSize,page:o.currentPage,class:"elevation-1","fixed-header":"",search:o.filterText},{"item.actions":(0,s.k6)(({item:e})=>[(0,s.Lk)("button",{class:"c-button",onClick:t=>o.openEditProduct(t,{item:e})},[...t[23]||(t[23]=[(0,s.Lk)("i",{class:"fa-solid fa-pen-to-square"},null,-1)])],8,ko)]),"item.price":(0,s.k6)(({item:e})=>[(0,s.eW)((0,y.v_)(o.formatPrice(e.price)),1)]),"item.productGroup":(0,s.k6)(({item:e})=>[(0,s.Lk)("div",go,[(0,s.Lk)("span",null,(0,y.v_)(e.productGroup),1)])]),_:1},8,["headers","items","items-per-page","page","search"])])]),o.showAddEdit?((0,s.uX)(),(0,s.Wv)(c,{key:0,productData:o.selectedProduct,products:o.products,productGroups:o.productGroups,onClose:t[13]||(t[13]=e=>o.showAddEdit=!1),onSaved:o.onProductSaved},null,8,["productData","products","productGroups","onSaved"])):(0,s.Q3)("",!0),o.showAddEditProductGroupModal?((0,s.uX)(),(0,s.Wv)(u,{key:1,item:o.editingProductGroup,onClose:t[14]||(t[14]=e=>o.showAddEditProductGroupModal=!1),onSaved:o.onProductGroupSaved},null,8,["item","onSaved"])):(0,s.Q3)("",!0)])}a(3579),a(4603),a(7566),a(8721);var fo=(0,n.y$)({state:{isAuthenticated:!1,token:null,isLoading:!1,user_admin:!1,user_name:"",user_superadmin:!1},getters:{isAuthenticated:e=>e.isAuthenticated,getToken:e=>e.token,isLoading:e=>e.isLoading,userAdmin:e=>e.user_admin,userName:e=>e.user_name,userSuperadmin:e=>e.user_superadmin},mutations:{setAuthentication(e,t){e.isAuthenticated=t},setToken(e,t){e.token=t},clearToken(e){e.token=null},setLoading(e,t){e.isLoading=t},setUserAdmin(e,t){e.user_admin=!!t},setUserName(e,t){e.user_name=t},setUserSuperadmin(e,t){e.user_superadmin=!!t}},actions:{checkAuthentication({commit:e}){e("setLoading",!0);const t=localStorage.getItem("token");t?(e("setToken",t),e("setAuthentication",!0)):(e("clearToken"),e("setAuthentication",!1)),e("setLoading",!1)},setUserAdmin({commit:e},t){e("setUserAdmin",t)},setUserName({commit:e},t){e("setUserName",t)},setUserSuperadmin({commit:e},t){e("setUserSuperadmin",t)},setToken({commit:e},t){e("setLoading",!0),localStorage.setItem("token",t),e("setToken",t),e("setAuthentication",!0),e("setLoading",!1)},removeToken({commit:e}){e("setLoading",!0),localStorage.removeItem("token"),e("clearToken"),e("setAuthentication",!1),e("setLoading",!1),e("setUserAdmin",!1),e("setUserName",""),e("setUserSuperadmin",!1)}},modules:{}});const Lo={class:"window-header"},yo={class:"window-title"},wo={class:"no-select"},_o={class:"window-actions no-select"},Co={class:"window-content"},xo={class:"form-body"},So={class:"tab-pane"},Eo={class:"form-layout"},Ao={class:"col-left"},To={class:"form-group"},Po={class:"form-group"},Do={class:"form-group"},Io={class:"form-group"},Ko=["disabled"],Ro={class:"form-group"},Vo=["value"],No={class:"form-group"},Xo={key:0,class:"col-right"},Fo={class:"combo-area"},Uo={class:"combo-item-input-wrapper",style:{position:"relative",flex:"1"}},Oo=["onUpdate:modelValue","onFocus"],Wo=["onUpdate:modelValue"],qo=["onClick"],Qo={class:"window-footer"},Jo=["disabled"],Mo=["onMousedown"],$o={key:0,class:"combo-dropdown-item",style:{color:"#999",cursor:"default"}};var Bo={__name:"AddEditProduct",props:{productData:{type:Object,default:()=>({})},productGroups:{type:Array,default:()=>[]},products:{type:Array,default:()=>[]}},emits:["close","saved"],setup(e,{emit:t}){const a=e,o=t,n=(0,be.KR)({id:null,productGroup:"",name:"",product_type:"normal",price:0,package_details:null,is_active:!0,code:"",product_group:null}),i=(0,be.KR)([]),c=(0,be.KR)(null),u=(0,be.KR)({}),d=(0,s.EW)({get:()=>n.value.price&&0!==n.value.price?new Intl.NumberFormat("vi-VN").format(n.value.price):"0",set:e=>{const t=e.replace(/\D/g,"");n.value.price=t?parseInt(t,10):0}}),p=(0,s.EW)(()=>a.products.filter(e=>"normal"===e.product_type));function m(){i.value.push({code:"",name:"",quantity:1,searchText:""})}function v(e){i.value.splice(e,1)}function h(e){e.target.select()}function k(e){e.data&&!/^\d+$/.test(e.data)&&e.preventDefault()}function g(e){let t=p.value;console.log("Filtering products with text:",t);const a=e.toLowerCase();return t=t.filter(e=>e.is_active),t=t.filter(e=>e.name&&e.name.toLowerCase().includes(a)||e.code&&e.code.toLowerCase().includes(a)),t.filter(e=>!i.value.some(t=>t.code===e.code))}function b(e,t){e.code=t.code,e.name=t.name,e.searchText=`${t.name} (${t.code})`,c.value=null}function f(e,t){const a=e.target.getBoundingClientRect();u.value={top:`${a.bottom}px`,left:`${a.left}px`,width:`${a.width}px`},c.value=t}function L(){setTimeout(()=>{c.value=null},200)}async function w(){let e=null;"combo"===n.value.product_type&&(e=i.value.filter(e=>e.code&&e.quantity>0).map(e=>({code:e.code,quantity:e.quantity})));const t={name:n.value.name,product_type:n.value.product_type,price:n.value.price,package_details:e,is_active:n.value.is_active,code:n.value.code,product_group:n.value.product_group};try{n.value.id?await r.A.put(`/products/${n.value.id}/`,t):await r.A.post("/products/",t),o("saved"),o("close")}catch(a){console.error("Error saving product:",a),window.alert("Lỗi khi lưu sản phẩm: "+(a.response&&a.response.data?JSON.stringify(a.response.data):a.message))}}return(0,s.wB)(()=>a.productData,e=>{e&&Object.keys(e).length>0&&e.id?(n.value={...e},console.log("Loaded product package_details:",n),"combo"===n.value.product_type&&Array.isArray(n.value.package_details)?i.value=n.value.package_details.map(e=>{const t=a.products.find(t=>t.code===e.code),l=t?t.name:e.name||e.code;return{code:e.code,name:l,quantity:e.quantity,searchText:l?`${l} (${e.code})`:e.code}}):i.value=[]):(n.value={id:null,productGroup:"",name:"",product_type:"normal",price:0,package_details:null,is_active:!0,code:"",product_group:null},i.value=[])},{immediate:!0,deep:!0}),(0,s.wB)(()=>n.value.product_type,e=>{"combo"!==e&&(i.value=[])}),(t,a)=>((0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",{class:"modal-overlay",onClick:a[9]||(a[9]=(0,l.D$)(e=>t.$emit("close"),["self"]))},[(0,s.Lk)("div",{class:"product-window",onClick:a[8]||(a[8]=(0,l.D$)(()=>{},["stop"])),style:(0,y.Tr)({width:"combo"===n.value.product_type?"60rem":"30rem"})},[(0,s.Lk)("div",Lo,[(0,s.Lk)("span",yo,[(0,s.Lk)("span",wo,(0,y.v_)(n.value.id?"Sửa sản phẩm":"Tạo mới sản phẩm"),1)]),(0,s.Lk)("div",_o,[(0,s.Lk)("button",{onClick:a[0]||(a[0]=e=>t.$emit("close")),class:"close-btn"},[...a[10]||(a[10]=[(0,s.Lk)("span",null,"×",-1)])])])]),(0,s.Lk)("div",Co,[a[19]||(a[19]=(0,s.Lk)("div",{class:"tabs-nav no-select"},[(0,s.Lk)("ul",null,[(0,s.Lk)("li",{class:"active"},[(0,s.Lk)("a",{href:"#"},"Thông tin chung")])])],-1)),(0,s.Lk)("div",xo,[(0,s.Lk)("div",So,[(0,s.Lk)("div",Eo,[(0,s.Lk)("div",Ao,[(0,s.Lk)("div",To,[a[11]||(a[11]=(0,s.Lk)("label",null,"Tên",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>n.value.name=e)},null,512),[[l.Jo,n.value.name]])]),(0,s.Lk)("div",Po,[a[12]||(a[12]=(0,s.Lk)("label",null,"Mã",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>n.value.code=e)},null,512),[[l.Jo,n.value.code]])]),(0,s.Lk)("div",Do,[a[13]||(a[13]=(0,s.Lk)("label",null,"Giá",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>d.value=e),style:{"text-align":"right"},onFocus:h,onBeforeinput:k},null,544),[[l.Jo,d.value]])]),(0,s.Lk)("div",Io,[a[15]||(a[15]=(0,s.Lk)("label",null,"Loại",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>n.value.product_type=e),disabled:!!n.value.id&&!(0,be.R1)(fo).getters.userSuperadmin},[...a[14]||(a[14]=[(0,s.Lk)("option",{value:"normal"},"Thường",-1),(0,s.Lk)("option",{value:"combo"},"Combo",-1)])],8,Ko),[[l.u1,n.value.product_type]])]),(0,s.Lk)("div",Ro,[a[16]||(a[16]=(0,s.Lk)("label",null,"Nhóm sản phẩm",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[5]||(a[5]=e=>n.value.product_group=e)},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.productGroups.filter(e=>e.is_active),e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,y.v_)(e.name),9,Vo))),128))],512),[[l.u1,n.value.product_group]])]),(0,s.Lk)("div",No,[a[17]||(a[17]=(0,s.Lk)("label",null,"Kích hoạt",-1)),(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a[6]||(a[6]=e=>n.value.is_active=e)},null,512),[[l.lH,n.value.is_active]])])]),"combo"===n.value.product_type?((0,s.uX)(),(0,s.CE)("div",Xo,[(0,s.Lk)("div",Fo,[a[18]||(a[18]=(0,s.Lk)("label",{style:{"font-weight":"bold","margin-bottom":"1rem",display:"block"}},"Sản phẩm thành phần",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"combo-item-row"},[(0,s.Lk)("div",Uo,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.searchText=t,onFocus:t=>f(t,e),onBlur:L,placeholder:"Tìm sản phẩm...",class:"combo-product-input",style:{width:"100%"}},null,40,Oo),[[l.Jo,e.searchText]])]),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.quantity=t,min:"1",class:"combo-quantity-input"},null,8,Wo),[[l.Jo,e.quantity,void 0,{number:!0}]]),(0,s.Lk)("button",{onClick:e=>v(t),class:"btn-remove-combo"},"×",8,qo)]))),128)),(0,s.Lk)("button",{onClick:m,class:"btn btn-secondary",style:{"margin-top":"1rem"}},"Thêm sản phẩm")])])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",Qo,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline",onClick:a[7]||(a[7]=e=>t.$emit("close"))},"Đóng"),(0,s.Lk)("button",{type:"button",class:"btn btn-primary new-button",onClick:w,disabled:!n.value.name.trim()||"combo"===n.value.product_type&&(0===i.value.length||i.value.some(e=>!e.code))},"Lưu",8,Jo)])])],4)]),((0,s.uX)(),(0,s.Wv)(s.Im,{to:"body"},[c.value?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"combo-dropdown-teleport",style:(0,y.Tr)(u.value)},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(g(c.value.searchText),e=>((0,s.uX)(),(0,s.CE)("div",{key:e.code,class:"combo-dropdown-item",onMousedown:(0,l.D$)(t=>b(c.value,e),["prevent"])},(0,y.v_)(e.name)+" ("+(0,y.v_)(e.code)+") ",41,Mo))),128)),0===g(c.value.searchText).length?((0,s.uX)(),(0,s.CE)("div",$o," Không tìm thấy ")):(0,s.Q3)("",!0)],4)):(0,s.Q3)("",!0)]))],64))}};const Ho=(0,p.A)(Bo,[["__scopeId","data-v-207629a1"]]);var jo=Ho;const Go={class:"window-header"},zo={class:"window-title"},Yo={class:"no-select"},Zo={class:"window-actions no-select"},en={class:"window-content"},tn={class:"form-body"},an={class:"tab-pane"},ln={class:"form-layout"},sn={class:"col-left"},on={class:"form-group"},nn={class:"form-group"},rn={class:"form-group"},cn={class:"window-footer"},un=["disabled"];function dn(e,t,a,o,n,i){return(0,s.uX)(),(0,s.CE)("div",{class:"modal-overlay",onMousedown:t[7]||(t[7]=(0,l.D$)(t=>e.$emit("close"),["self"]))},[(0,s.Lk)("div",{class:"product-group-window",onClick:t[6]||(t[6]=(0,l.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",Go,[(0,s.Lk)("span",zo,[(0,s.Lk)("span",Yo,(0,y.v_)(o.item&&o.item.id?"Chỉnh sửa nhóm sản phẩm":"Tạo nhóm sản phẩm mới"),1)]),(0,s.Lk)("div",Zo,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},[...t[8]||(t[8]=[(0,s.Lk)("span",null,"×",-1)])])])]),(0,s.Lk)("div",en,[t[12]||(t[12]=(0,s.Lk)("div",{class:"tabs-nav no-select"},[(0,s.Lk)("ul",null,[(0,s.Lk)("li",{class:"active"},[(0,s.Lk)("a",{href:"#"},"Thông tin chung")])])],-1)),(0,s.Lk)("div",tn,[(0,s.Lk)("div",an,[(0,s.Lk)("div",ln,[(0,s.Lk)("div",sn,[(0,s.Lk)("div",on,[t[9]||(t[9]=(0,s.Lk)("label",{for:"name"},"Tên nhóm",-1)),(0,s.bo)((0,s.Lk)("input",{id:"name","onUpdate:modelValue":t[1]||(t[1]=e=>o.name=e),type:"text",required:""},null,512),[[l.Jo,o.name]])]),(0,s.Lk)("div",nn,[t[10]||(t[10]=(0,s.Lk)("label",{for:"description"},"Mô tả",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"description","onUpdate:modelValue":t[2]||(t[2]=e=>o.description=e),rows:"3"},null,512),[[l.Jo,o.description]])]),(0,s.Lk)("div",rn,[t[11]||(t[11]=(0,s.Lk)("label",{for:"is_active"},"Kích hoạt",-1)),(0,s.bo)((0,s.Lk)("input",{id:"is_active","onUpdate:modelValue":t[3]||(t[3]=e=>o.isActive=e),type:"checkbox"},null,512),[[l.lH,o.isActive]])])])])])]),(0,s.Lk)("div",cn,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline",onClick:t[4]||(t[4]=t=>e.$emit("close"))},"Đóng"),(0,s.Lk)("button",{type:"button",class:"btn btn-primary new-button",disabled:!o.name.trim(),onClick:t[5]||(t[5]=(...e)=>o.handleSubmit&&o.handleSubmit(...e))},(0,y.v_)(o.item&&o.item.id?"Lưu":"Tạo mới"),9,un)])])])],32)}var pn={name:"AddEditProductGroup",props:{item:{type:Object,default:null}},emits:["close","saved"],setup(e,{emit:t}){const{item:a}=(0,be.QW)(e),l=(0,be.KR)(a.value?a.value.name:""),o=(0,be.KR)(a.value?a.value.description:""),n=(0,be.KR)(!a.value||void 0===a.value.is_active||a.value.is_active);async function i(){if(a.value&&a.value.id){const e={id:a.value.id,name:l.value,description:o.value,is_active:n.value};return void await r.A.put(`/productgroups/${a.value.id}/`,e).then(a=>{console.log("Product group updated:",a.data),t("saved",e)}).catch(e=>{console.error("Error updating product group:",e),window.alert("Lỗi khi cập nhật nhóm sản phẩm: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))})}{const e={name:l.value,description:o.value,is_active:n.value};await r.A.post("/productgroups/",e).then(a=>{console.log("Product group created:",a.data),t("saved",e)}).catch(e=>{console.error("Error creating product group:",e),window.alert("Lỗi khi tạo nhóm sản phẩm: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))})}}return(0,s.wB)(a,e=>{l.value=e?e.name:"",o.value=e?e.description:"",n.value=!e||void 0===e.is_active||e.is_active}),{name:l,description:o,isActive:n,item:a,handleSubmit:i}}};const mn=(0,p.A)(pn,[["render",dn],["__scopeId","data-v-583c84f8"]]);var vn=mn,hn={name:"Products",components:{AddEditProduct:jo,AddEditProductGroup:vn},setup(){const e=(0,be.KR)(!1),t=(0,be.KR)({top:"0px",left:"0px",width:"200px"}),a=(0,be.KR)(null),l=(0,be.KR)(!1),o=(0,be.KR)(null),n=t=>{if(e.value){const l=a.value;l&&!l.contains(t.target)&&(e.value=!1)}l.value&&o.value&&!o.value.contains(t.target)&&(l.value=!1)},i=(0,be.KR)([]),c=(0,be.KR)(""),u=(0,be.KR)(1),d=(0,be.KR)(50),p=(0,be.KR)(!1),m=(0,be.KR)({}),v=(0,be.KR)([]),h=(0,be.KR)(!1),k=(0,be.KR)(null),g=[{title:"",key:"actions",sortable:!1,headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Mã",key:"code",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Tên",key:"name",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Giá",key:"price",headerProps:{class:"my-custom-header-class pr-3"},align:"end",cellProps:{class:"text-right pr-3"}},{title:"Nhóm",key:"productGroup",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Loại",key:"product_type",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Trạng thái",key:"is_active",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}}],b=(0,be.KR)([!0]),f=(0,be.KR)([]),L=(0,s.EW)(()=>f.value&&0!==f.value.length?f.value.length===v.value.length?"Tất cả":f.value.length>1?`${f.value.length} nhóm đã chọn`:v.value.find(e=>e.id===f.value[0])?.name||"Chọn nhóm":"Tất cả"),y=(0,s.EW)({get:()=>v.value.length>0&&f.value.length===v.value.length,set:e=>{f.value=e?v.value.map(e=>e.id):[]}}),w=(0,s.EW)(()=>{let e=i.value;if(b.value&&b.value.length>0&&(e=e.filter(e=>b.value.includes(e.is_active))),f.value&&f.value.length>0&&(e=e.filter(e=>void 0!==e.product_group&&null!==e.product_group?f.value.includes(e.product_group):void 0!==e.productGroup&&null!==e.productGroup&&f.value.some(t=>e.productGroup===v.find(e=>e.id===t)?.name))),!c.value.trim())return e;const t=c.value.toLowerCase();return e.filter(e=>e.name&&e.name.toLowerCase().includes(t)||e.productGroup&&e.productGroup.toLowerCase().includes(t)||e.code&&e.code.toLowerCase().includes(t)||e.product_type&&e.product_type.toLowerCase().includes(t))}),_=async()=>{try{const e=await r.A.get("/products/");i.value=e.data.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at))}catch(e){console.error("Error fetching products:",e)}},C=async()=>{try{const e=await r.A.get("/productgroups/");v.value=e.data}catch(e){console.error("Error fetching product groups:",e)}},x=e=>"number"!==typeof e?e:e.toLocaleString("en-US");function S(){const e=[];e.push(g.map(e=>e.title).join(",")),w.value.forEach(t=>{e.push(g.map(e=>{let a=t[e.key];return"price"===e.key&&(a=x(a)),'"'+(void 0!==a?String(a).replace(/"/g,'""'):"")+'"'}).join(","))});const t=e.join("\n"),a=new Blob([t],{type:"text/csv"}),l=window.URL.createObjectURL(a),s=document.createElement("a");s.href=l,s.download="products.csv",s.click(),window.URL.revokeObjectURL(l)}function E(){m.value={},p.value=!0}function A(e,{item:t}){console.log("Clicked item:",t),m.value={...t},p.value=!0}function T(){m.value={},p.value=!0}async function P(){console.log("Product saved, refreshing list..."),await _(),p.value=!1}async function D(){console.log("Product saved, refreshing list..."),await _(),await C(),p.value=!1,h.value=!1}const I=t=>{let a=v.value.find(e=>"object"===typeof t&&null!==t?e.id===t.id:e.id===t);console.log("Editing product group:",a),e.value=!1,k.value=a,h.value=!0},K=()=>{(0,s.dY)(()=>{const e=document.querySelector(".create-new-btn-group");if(e){const a=e.getBoundingClientRect();t.value={top:`${a.bottom+window.scrollY}px`,left:`${a.left+window.scrollX}px`,width:`${a.width}px`}}})};function R(){e.value=!e.value,e.value&&K()}const V=()=>{l.value=!l.value};return(0,s.sV)(()=>{_(),C(),document.addEventListener("mousedown",n)}),(0,s.xo)(()=>{document.removeEventListener("mousedown",n)}),{products:i,filterText:c,currentPage:u,pageSize:d,showAddEdit:p,selectedProduct:m,productGroups:v,headers:g,filteredProducts:w,productGroupFilter:f,isActiveFilter:b,formatPrice:x,exportToCSV:S,openAddProduct:E,openEditProduct:A,createNewProduct:T,onProductSaved:P,onProductGroupSaved:D,openAddEditProductGroup:I,editingProductGroup:k,showAddEditProductGroupModal:h,showGroupList:e,groupListPosition:t,toggleGroupList:R,groupListRef:a,showProductGroupFilterDropdown:l,productGroupFilterDropdownRef:o,toggleProductGroupFilterDropdown:V,selectedGroupNames:L,allGroupsSelected:y}}};const kn=(0,p.A)(hn,[["render",bo],["__scopeId","data-v-7a8e3c03"]]);var gn=kn;const bn={class:"work-area"},fn={class:"top-area"},Ln={class:"action-area"},yn={class:"page-actions"},wn={class:"datatable-toolbar"},_n=["value"],Cn={class:"other-actions"},xn={class:"buttons-area"},Sn={class:"bottom-area"},En={class:"filter-area"},An={class:"filters"},Tn={class:"form-group"},Pn={class:"checkbox-group"},Dn={class:"data-area"},In=["onClick"];function Kn(e,t,a,o,n,i){const r=(0,s.g2)("v-data-table"),c=(0,s.g2)("AddEditCustomer");return(0,s.uX)(),(0,s.CE)("div",bn,[(0,s.Lk)("div",fn,[t[8]||(t[8]=(0,s.Lk)("div",{class:"page-name-area"},"Khách Hàng",-1)),(0,s.Lk)("div",Ln,[(0,s.Lk)("div",yn,[(0,s.Lk)("div",wn,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.filterText=e),placeholder:"Tìm kiếm...",class:"search-input",style:{"margin-right":"1rem"}},null,512),[[l.Jo,o.filterText]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.pageSize=e),class:"page-size-select"},[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)([5,10,20,50,100,200],e=>(0,s.Lk)("option",{key:e,value:e},(0,y.v_)(e)+" rows",9,_n)),64))],512),[[l.u1,o.pageSize]])])]),(0,s.Lk)("div",Cn,[(0,s.Lk)("div",xn,[(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>o.createNewCustomer&&o.createNewCustomer(...e)),class:"btn btn-primary"}," Tạo mới "),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>o.exportToCSV&&o.exportToCSV(...e)),class:"btn btn-secondary"},[...t[7]||(t[7]=[(0,s.Lk)("i",{class:"fa-solid fa-file-excel",style:{"margin-right":"0.5rem"}},null,-1),(0,s.eW)(" Export CSV ",-1)])])])])])]),(0,s.Lk)("div",Sn,[(0,s.Lk)("div",En,[(0,s.Lk)("div",An,[(0,s.Lk)("div",Tn,[t[11]||(t[11]=(0,s.Lk)("label",null,"Trạng thái",-1)),(0,s.Lk)("div",Pn,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>o.isActiveFilter=e),value:!0},null,512),[[l.lH,o.isActiveFilter]]),t[9]||(t[9]=(0,s.eW)(" Kích hoạt",-1))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>o.isActiveFilter=e),value:!1},null,512),[[l.lH,o.isActiveFilter]]),t[10]||(t[10]=(0,s.eW)(" Không kích hoạt",-1))])])])])]),(0,s.Lk)("div",Dn,[(0,s.bF)(r,{headers:o.headers,items:o.customers,"items-per-page":o.pageSize,page:o.currentPage,class:"elevation-1","server-items-length":o.totalCustomers,"fixed-header":""},{"item.actions":(0,s.k6)(({item:e})=>[(0,s.Lk)("button",{class:"c-button",onClick:t=>o.openEditCustomer(t,{item:e})},[...t[12]||(t[12]=[(0,s.Lk)("i",{class:"fa-solid fa-pen-to-square"},null,-1)])],8,In)]),_:1},8,["headers","items","items-per-page","page","server-items-length"])])]),o.showAddEdit?((0,s.uX)(),(0,s.Wv)(c,{key:0,customer:o.selectedCustomer,regionList:o.provinces,wardList:o.wards,type:o.editOrNew,onClose:t[6]||(t[6]=e=>o.showAddEdit=!1),onSaved:o.onCustomerSaved},null,8,["customer","regionList","wardList","type","onSaved"])):(0,s.Q3)("",!0)])}const Rn={class:"window-header"},Vn={class:"window-title"},Nn={class:"no-select"},Xn={class:"branch-info"},Fn={class:"window-content"},Un={class:"tabs-nav no-select"},On={class:"form-body"},Wn={key:0,class:"tab-pane"},qn={class:"form-layout"},Qn={class:"col-left"},Jn={class:"form-group"},Mn=["disabled"],$n={class:"form-group"},Bn={class:"form-group"},Hn={class:"form-group"},jn={class:"form-group"},Gn={class:"autocomplete-wrapper"},zn=["onMousedown"],Yn={class:"form-group"},Zn={class:"autocomplete-wrapper"},ei=["disabled"],ti=["onMousedown"],ai={class:"col-right"},li={class:"form-group"},si={class:"row-inputs"},oi={class:"gender-radios"},ni={class:"form-group"},ii={class:"form-group"},ri={class:"form-group"},ci={class:"window-footer"},ui=["disabled"];var di={__name:"AddEditCustomer",props:{currentBranch:{type:String,default:"Chi nhánh Gia"},customer:{type:Object,default:null},regionList:{type:Array,default:()=>[]},wardList:{type:Array,default:()=>[]},type:{type:String,default:"new"}},emits:["close","saved"],setup(e,{emit:t}){const a=(0,be.KR)("general"),o=t,n=e,i=()=>({code:"",name:"",phone_number:"",address:"",location:"",locationName:"",ward:null,ward_name:"",province:null,province_name:"",birthdate:"",gender:!0,email:"",facebook:"",comments:""});function c(e){let t=e.target.value;u.phone_number=t.replace(/[^0-9+\-()]/g,"")}const u=(0,be.Kh)(i()),d=(0,be.KR)(!1),p=(0,be.KR)(!1),m=(0,be.KR)(null),v=(0,be.KR)(null),h=(0,be.Kh)({top:"0px",left:"0px",width:"0px",display:"block"}),k=e=>{if(!e)return;const t=e.getBoundingClientRect();h.top=`${t.bottom+window.scrollY}px`,h.left=`${t.left+window.scrollX}px`,h.width=`${t.width}px`},g=e=>{d.value=!1,p.value=!1,(0,s.dY)(()=>{"location"===e?(console.log("Opening location dropdown"),k(m.value),d.value=!0):"ward"===e&&(k(v.value),p.value=!0)})},b=(0,s.EW)(()=>{const e=u.province_name?u.province_name.toLowerCase():"";return e?(n.regionList||[]).filter(t=>t.name.toLowerCase().includes(e)):n.regionList||[]});function f(e){u.province=e.id,u.province_name=e.name,u.ward=null,u.ward_name="",d.value=!1}function L(){u.ward_id=null,u.ward=""}const w=(0,s.EW)(()=>{const e=u.ward_name?u.ward_name.toLowerCase():"";let t=n.wardList||[];return u.province&&(t=t.filter(e=>e.province===u.province)),t.filter(t=>t.name.toLowerCase().includes(e))});function _(e){u.ward=e.id,u.ward_name=e.name,p.value=!1}function C(e){setTimeout(()=>{"location"===e&&(d.value=!1),"ward"===e&&(p.value=!1)},200)}const x=async()=>{const e={...u};"edit"===n.type?(delete e.province_name,delete e.ward_name,await r.A.put(`/customers/${n.customer.id}/`,e).then(e=>{console.log("Customer updated:",e.data),o("saved",e.data),o("close")}).catch(e=>{console.error("Error updating customer:",e),window.alert("Lỗi cập nhật khách hàng: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))})):(delete e.province_name,delete e.ward_name,await r.A.post("/customers/",e).then(e=>{console.log("Customer created:",e.data),o("saved",e.data),o("close")}).catch(e=>{console.error("Error creating customer:",e),window.alert("Lỗi tạo khách hàng: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))}))},S=()=>{o("close")};return(0,s.sV)(()=>{if(n.customer){if(Object.assign(u,i(),n.customer),n.customer.province){const e=n.regionList.find(e=>e.id===n.customer.province);e&&(u.province_name=e.name)}if(n.customer.ward){const e=n.wardList.find(e=>e.id===n.customer.ward);e&&(u.ward_name=e.name)}}else Object.assign(u,i())}),(t,o)=>((0,s.uX)(),(0,s.CE)("div",{class:"modal-overlay",onClick:S},[(0,s.Lk)("div",{class:"customer-window",onClick:o[19]||(o[19]=(0,l.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",Rn,[(0,s.Lk)("span",Vn,[(0,s.Lk)("span",Nn,(0,y.v_)(n.customer?"Cập nhật khách hàng":"Thêm khách hàng"),1),(0,s.Lk)("span",Xn,[o[20]||(o[20]=(0,s.eW)(" Chi nhánh tạo: ",-1)),(0,s.Lk)("span",null,(0,y.v_)(n.currentBranch),1)])]),(0,s.Lk)("div",{class:"window-actions no-select"},[(0,s.Lk)("button",{onClick:S,class:"close-btn"},[...o[21]||(o[21]=[(0,s.Lk)("span",null,"×",-1)])])])]),(0,s.Lk)("div",Fn,[(0,s.Lk)("div",Un,[(0,s.Lk)("ul",null,[(0,s.Lk)("li",{class:(0,y.C4)({active:"general"===a.value})},[(0,s.Lk)("a",{href:"#",onClick:o[0]||(o[0]=(0,l.D$)(e=>a.value="general",["prevent"]))},"Thông tin chung")],2)])]),(0,s.Lk)("div",On,["general"===a.value?((0,s.uX)(),(0,s.CE)("div",Wn,[(0,s.Lk)("div",qn,[(0,s.Lk)("div",Qn,[(0,s.Lk)("div",Jn,[o[22]||(o[22]=(0,s.Lk)("label",{class:"no-select"},"Mã khách hàng",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=e=>u.code=e),placeholder:"Mã mặc định",disabled:"new"!==e.type},null,8,Mn),[[l.Jo,u.code]])]),(0,s.Lk)("div",$n,[o[23]||(o[23]=(0,s.Lk)("label",{class:"required no-select"},"Tên khách hàng",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=e=>u.name=e),placeholder:"Bắt buộc"},null,512),[[l.Jo,u.name]])]),(0,s.Lk)("div",Bn,[o[24]||(o[24]=(0,s.Lk)("label",{class:"no-select"},"Điện thoại",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=e=>u.phone_number=e),placeholder:"Bắt buộc",onInput:c},null,544),[[l.Jo,u.phone_number]])]),(0,s.Lk)("div",Hn,[o[25]||(o[25]=(0,s.Lk)("label",{class:"no-select"},"Địa chỉ",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":o[4]||(o[4]=e=>u.address=e),rows:"2",placeholder:"Số nhà, tòa nhà, ngõ, đường"},null,512),[[l.Jo,u.address]])]),(0,s.Lk)("div",jn,[o[26]||(o[26]=(0,s.Lk)("label",{class:"no-select"},"Khu vực",-1)),(0,s.Lk)("div",Gn,[(0,s.bo)((0,s.Lk)("input",{ref_key:"locationInputRef",ref:m,type:"text","onUpdate:modelValue":o[5]||(o[5]=e=>u.province_name=e),placeholder:"Chọn Tỉnh/TP",onFocus:o[6]||(o[6]=e=>g("location")),onInput:o[7]||(o[7]=e=>g("location")),onBlur:o[8]||(o[8]=e=>C("location")),onChange:L},null,544),[[l.Jo,u.province_name]]),((0,s.uX)(),(0,s.Wv)(s.Im,{to:"body"},[d.value&&b.value.length?((0,s.uX)(),(0,s.CE)("ul",{key:0,class:"autocomplete-list",style:(0,y.Tr)(h)},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(b.value,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.id,onMousedown:(0,l.D$)(t=>f(e),["prevent"])},(0,y.v_)(e.name),41,zn))),128))],4)):(0,s.Q3)("",!0)]))])]),(0,s.Lk)("div",Yn,[o[27]||(o[27]=(0,s.Lk)("label",{class:"no-select"},"Phường xã",-1)),(0,s.Lk)("div",Zn,[(0,s.bo)((0,s.Lk)("input",{ref_key:"wardInputRef",ref:v,type:"text","onUpdate:modelValue":o[9]||(o[9]=e=>u.ward_name=e),placeholder:"Chọn Phường/Xã",disabled:!u.province,onFocus:o[10]||(o[10]=e=>g("ward")),onInput:o[11]||(o[11]=e=>g("ward")),onBlur:o[12]||(o[12]=e=>C("ward"))},null,40,ei),[[l.Jo,u.ward_name]]),((0,s.uX)(),(0,s.Wv)(s.Im,{to:"body"},[p.value&&w.value.length?((0,s.uX)(),(0,s.CE)("ul",{key:0,class:"autocomplete-list",style:(0,y.Tr)(h)},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(w.value,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.id,onMousedown:(0,l.D$)(t=>_(e),["prevent"])},(0,y.v_)(e.name),41,ti))),128))],4)):(0,s.Q3)("",!0)]))])])]),(0,s.Lk)("div",ai,[(0,s.Lk)("div",li,[o[30]||(o[30]=(0,s.Lk)("label",{class:"no-select"},"Ngày sinh",-1)),(0,s.Lk)("div",si,[(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":o[13]||(o[13]=e=>u.birthdate=e),class:"input-date"},null,512),[[l.Jo,u.birthdate]]),(0,s.Lk)("div",oi,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"radio",value:!0,"onUpdate:modelValue":o[14]||(o[14]=e=>u.gender=e)},null,512),[[l.XL,u.gender]]),o[28]||(o[28]=(0,s.eW)(" Nam",-1))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"radio",value:!1,"onUpdate:modelValue":o[15]||(o[15]=e=>u.gender=e)},null,512),[[l.XL,u.gender]]),o[29]||(o[29]=(0,s.eW)(" Nữ",-1))])])])]),(0,s.Lk)("div",ni,[o[31]||(o[31]=(0,s.Lk)("label",{class:"no-select"},"Email",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email","onUpdate:modelValue":o[16]||(o[16]=e=>u.email=e)},null,512),[[l.Jo,u.email]])]),(0,s.Lk)("div",ii,[o[32]||(o[32]=(0,s.Lk)("label",{class:"no-select"},"Facebook",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":o[17]||(o[17]=e=>u.facebook=e)},null,512),[[l.Jo,u.facebook]])]),(0,s.Lk)("div",ri,[o[33]||(o[33]=(0,s.Lk)("label",{class:"no-select"},"Ghi chú",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":o[18]||(o[18]=e=>u.comments=e),rows:"3"},null,512),[[l.Jo,u.comments]])])])])])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",ci,[(0,s.Lk)("button",{class:"btn btn-outline",onClick:S},[...o[34]||(o[34]=[(0,s.Lk)("i",{class:"icon-ban"},null,-1),(0,s.eW)(" Bỏ qua ",-1)])]),(0,s.Lk)("button",{class:"btn btn-primary new-button",onClick:x,disabled:!u.name.trim()||!u.phone_number.trim()||!u.address.trim()||!u.province_name.trim()},[...o[35]||(o[35]=[(0,s.Lk)("i",{class:"icon-save"},null,-1),(0,s.eW)(" Lưu ",-1)])],8,ui)])])])]))}};const pi=(0,p.A)(di,[["__scopeId","data-v-6fa675d2"]]);var mi=pi,vi={name:"Customers",components:{AddEditCustomer:mi},setup(){const e=(0,be.KR)("new"),t=((0,n.Pj)(),(0,be.KR)([])),a=(0,be.KR)(""),l=(0,be.KR)(1),o=(0,be.KR)(50),i=(0,be.KR)(!1),c=(0,be.KR)({}),u=(0,be.KR)([]),d=(0,be.KR)([]),p=(0,be.KR)(0),m=[{title:"",key:"actions",sortable:!1,headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Mã",key:"code",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Tên",key:"name",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Số điện thoại",key:"phone_number",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Trạng thái",key:"is_active",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}}],v=(0,be.KR)([!0]),h=async()=>{try{const e={page:l.value,page_size:o.value};a.value&&(e.search=a.value),v.value.length>0&&(e["is_active[]"]=v.value);const s=await r.A.get("/customers/",{params:e});t.value=s.data.results,p.value=s.data.count}catch(e){console.error("Error fetching customers:",e)}},k=async()=>{try{const[e,t]=await Promise.all([r.A.get("/provinces/"),r.A.get("/wards/")]);d.value=e.data,u.value=t.data}catch(e){console.error("Error fetching provinces or wards:",e)}};function g(){e.value="new",c.value={},i.value=!0}function b(){const e=[];e.push(m.map(e=>e.title).join(",")),t.value.forEach(t=>{e.push(m.map(e=>{let a=t[e.key];return'"'+(void 0!==a?String(a).replace(/"/g,'""'):"")+'"'}).join(","))});const a=e.join("\n"),l=new Blob([a],{type:"text/csv"}),s=window.URL.createObjectURL(l),o=document.createElement("a");o.href=s,o.download="customers.csv",o.click(),window.URL.revokeObjectURL(s)}function f(){c.value={},i.value=!0}function L(t,{item:a}){console.log("Editing customer:",a),c.value={...a},e.value="edit",i.value=!0}async function y(){console.log("Customer saved, refreshing list..."),await h(),i.value=!1}return(0,s.wB)([l,o,a,v],h,{deep:!0}),(0,s.sV)(()=>{h(),k()}),{editOrNew:e,customers:t,filterText:a,currentPage:l,pageSize:o,showAddEdit:i,selectedCustomer:c,headers:m,isActiveFilter:v,provinces:d,wards:u,totalCustomers:p,exportToCSV:b,openAddCustomer:f,openEditCustomer:L,onCustomerSaved:y,createNewCustomer:g}}};const hi=(0,p.A)(vi,[["render",Kn],["__scopeId","data-v-59f2d80c"]]);var ki=hi;const gi={class:"work-area"},bi={class:"top-area"},fi={class:"action-area"},Li={class:"page-actions"},yi={class:"datatable-toolbar"},wi=["value"],_i={class:"other-actions"},Ci={class:"buttons-area"},xi={class:"list-product-groups btn-group",style:{position:"relative"}},Si={style:{margin:"0",padding:"0","list-style":"none"}},Ei=["onClick"],Ai={style:{padding:"0.5rem 0","border-bottom":"none"}},Ti={style:{"text-align":"right","margin-top":"0.5rem"}},Pi={class:"bottom-area"},Di={class:"filter-area"},Ii={class:"filters"},Ki={class:"form-group"},Ri={class:"form-group"},Vi={class:"form-group"},Ni={class:"checkbox-group"},Xi={class:"form-group"},Fi={class:"multiselect-dropdown",ref:"sellerFilterDropdownRef"},Ui={key:0,class:"multiselect-menu"},Oi={class:"multiselect-item"},Wi=["value"],qi={class:"form-group"},Qi={class:"multiselect-dropdown",ref:"channelFilterDropdownRef"},Ji={key:0,class:"multiselect-menu"},Mi={class:"multiselect-item"},$i=["value"],Bi={class:"data-area"},Hi=["onClick"];function ji(e,t,a,o,n,i){const r=(0,s.g2)("v-data-table"),c=(0,s.g2)("AddEditInvoice"),u=(0,s.g2)("AddEditSurcharge");return(0,s.uX)(),(0,s.CE)("div",gi,[(0,s.Lk)("div",bi,[t[25]||(t[25]=(0,s.Lk)("div",{class:"page-name-area"},"Hóa Đơn",-1)),(0,s.Lk)("div",fi,[(0,s.Lk)("div",Li,[(0,s.Lk)("div",yi,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.filterText=e),placeholder:"Tìm kiếm...",class:"search-input",style:{"margin-right":"1rem"}},null,512),[[l.Jo,o.filterText]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.pageSize=e),class:"page-size-select"},[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)([5,10,20,50,100,200],e=>(0,s.Lk)("option",{key:e,value:e},(0,y.v_)(e)+" rows",9,wi)),64))],512),[[l.u1,o.pageSize]])])]),(0,s.Lk)("div",_i,[(0,s.Lk)("div",Ci,[(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>o.triggerImportShopee&&o.triggerImportShopee(...e)),class:"btn btn-primary",style:{"margin-right":"0.5rem"}}," Import SP "),o.store.getters.userAdmin||o.store.getters.userSuperadmin?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[3]||(t[3]=(...e)=>o.toggleGroupList&&o.toggleGroupList(...e)),class:"btn btn-outline create-new-btn-group",style:{"margin-right":"0.5rem"}}," Phụ Phí ")):(0,s.Q3)("",!0),(0,s.Lk)("div",xi,[((0,s.uX)(),(0,s.Wv)(s.Im,{to:"body"},[o.showSurchargeList?((0,s.uX)(),(0,s.CE)("div",{key:0,ref:"groupListRef",class:"product-group-teleport",onClick:t[6]||(t[6]=(0,l.D$)(e=>o.showSurchargeList=!1,["self"])),style:(0,y.Tr)({position:"fixed",maxHeight:"50vh",overflow:"auto",top:o.groupListPosition.top,left:o.groupListPosition.left,zIndex:9999,background:"white",border:"1px solid #ccc",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",padding:"1rem",minWidth:o.groupListPosition.width})},[(0,s.Lk)("ul",Si,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.surchargeList,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.id,style:{padding:"0.5rem 0","border-bottom":"1px solid #eee"}},[(0,s.Lk)("span",null,(0,y.v_)(e.code),1),(0,s.Lk)("button",{onClick:(0,l.D$)(t=>o.openAddEditSurcharge(e),["stop","prevent"]),class:"c-button"},[...t[23]||(t[23]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1)])],8,Ei)]))),128)),(0,s.Lk)("li",Ai,[(0,s.Lk)("button",{onClick:t[4]||(t[4]=e=>o.openAddEditSurcharge(null)),style:{padding:"0.3rem 1rem"}},"+ Tạo mới")])]),(0,s.Lk)("div",Ti,[(0,s.Lk)("button",{onClick:t[5]||(t[5]=e=>o.showSurchargeList=!1),style:{padding:"0.3rem 1rem"}},"Đóng")])],4)):(0,s.Q3)("",!0)]))]),(0,s.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>o.exportToCSV&&o.exportToCSV(...e)),class:"btn btn-secondary"},[...t[24]||(t[24]=[(0,s.Lk)("i",{class:"fas fa-file-excel",style:{"margin-right":"0.5rem"}},null,-1),(0,s.eW)(" Export CSV ",-1)])]),(0,s.Lk)("input",{type:"file",ref:"fileInputShopee",style:{display:"none"},onChange:t[8]||(t[8]=(...e)=>o.handleFileUploadShopee&&o.handleFileUploadShopee(...e))},null,544)])])])]),(0,s.Lk)("div",Pi,[(0,s.Lk)("div",Di,[(0,s.Lk)("div",Ii,[(0,s.Lk)("div",Ki,[t[26]||(t[26]=(0,s.Lk)("label",null,"Từ ngày",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[9]||(t[9]=e=>o.dateFrom=e),onClick:t[10]||(t[10]=e=>e.target.showPicker())},null,512),[[l.Jo,o.dateFrom]])]),(0,s.Lk)("div",Ri,[t[27]||(t[27]=(0,s.Lk)("label",null,"Đến ngày",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[11]||(t[11]=e=>o.dateTo=e),onClick:t[12]||(t[12]=e=>e.target.showPicker())},null,512),[[l.Jo,o.dateTo]])]),(0,s.Lk)("div",Vi,[t[30]||(t[30]=(0,s.Lk)("label",null,"Trạng thái",-1)),(0,s.Lk)("div",Ni,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[13]||(t[13]=e=>o.isActiveFilter=e),value:!0},null,512),[[l.lH,o.isActiveFilter]]),t[28]||(t[28]=(0,s.eW)(" Kích hoạt",-1))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[14]||(t[14]=e=>o.isActiveFilter=e),value:!1},null,512),[[l.lH,o.isActiveFilter]]),t[29]||(t[29]=(0,s.eW)(" Không kích hoạt",-1))])])]),(0,s.Lk)("div",Xi,[t[32]||(t[32]=(0,s.Lk)("label",null,"Người bán",-1)),(0,s.Lk)("div",Fi,[(0,s.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>o.toggleSellerFilterDropdown&&o.toggleSellerFilterDropdown(...e)),class:"multiselect-toggle"},(0,y.v_)(o.selectedSellerNames),1),o.showSellerFilterDropdown?((0,s.uX)(),(0,s.CE)("div",Ui,[(0,s.Lk)("div",Oi,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[16]||(t[16]=e=>o.allSellersSelected=e),style:{"margin-right":"0.5rem"}},null,512),[[l.lH,o.allSellersSelected]]),t[31]||(t[31]=(0,s.eW)(" Tất cả ",-1))])]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.uniqueSellers,e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"multiselect-item"},[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[17]||(t[17]=e=>o.sellerFilter=e),value:e,style:{"margin-right":"0.5rem"}},null,8,Wi),[[l.lH,o.sellerFilter]]),(0,s.eW)(" "+(0,y.v_)(e),1)])]))),128))])):(0,s.Q3)("",!0)],512)]),(0,s.Lk)("div",qi,[t[34]||(t[34]=(0,s.Lk)("label",null,"Kênh bán",-1)),(0,s.Lk)("div",Qi,[(0,s.Lk)("button",{onClick:t[18]||(t[18]=(...e)=>o.toggleChannelFilterDropdown&&o.toggleChannelFilterDropdown(...e)),class:"multiselect-toggle"},(0,y.v_)(o.selectedChannelNames),1),o.showChannelFilterDropdown?((0,s.uX)(),(0,s.CE)("div",Ji,[(0,s.Lk)("div",Mi,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[19]||(t[19]=e=>o.allChannelsSelected=e),style:{"margin-right":"0.5rem"}},null,512),[[l.lH,o.allChannelsSelected]]),t[33]||(t[33]=(0,s.eW)(" Tất cả ",-1))])]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.uniqueChannels,e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"multiselect-item"},[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[20]||(t[20]=e=>o.channelFilter=e),value:e,style:{"margin-right":"0.5rem"}},null,8,$i),[[l.lH,o.channelFilter]]),(0,s.eW)(" "+(0,y.v_)(e),1)])]))),128))])):(0,s.Q3)("",!0)],512)])])]),(0,s.Lk)("div",Bi,[(0,s.bF)(r,{headers:o.headers,items:o.filteredInvoices,"items-per-page":o.pageSize,page:o.currentPage,class:"elevation-1","fixed-header":"",search:o.filterText},{"item.actions":(0,s.k6)(({item:e})=>[o.isEditable(e.date)?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"c-button",onClick:t=>o.openEditInvoice(t,{item:e})},[...t[35]||(t[35]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1)])],8,Hi)):(0,s.Q3)("",!0)]),"item.final_total":(0,s.k6)(({item:e})=>[(0,s.eW)((0,y.v_)(o.formatPrice(e.final_total)),1)]),"item.created_at":(0,s.k6)(({item:e})=>[(0,s.eW)((0,y.v_)(o.formatDateTime(e.created_at)),1)]),_:1},8,["headers","items","items-per-page","page","search"])])]),o.showAddEdit?((0,s.uX)(),(0,s.Wv)(c,{key:0,item:o.selectedInvoice,channels:o.channels,onClose:t[21]||(t[21]=e=>o.showAddEdit=!1),onSaved:o.onInvoiceSaved},null,8,["item","channels","onSaved"])):(0,s.Q3)("",!0),o.showAddEditSurchargeModal?((0,s.uX)(),(0,s.Wv)(u,{key:1,item:o.editingSurcharge,onClose:t[22]||(t[22]=e=>o.showAddEditSurchargeModal=!1),onSaved:o.fetchSurcharges},null,8,["item","onSaved"])):(0,s.Q3)("",!0)])}a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698);const Gi={class:"window-header"},zi={class:"window-title"},Yi={class:"no-select"},Zi={class:"window-actions no-select"},er={class:"window-content"},tr={class:"form-body"},ar={class:"tab-pane"},lr={class:"form-layout"},sr={class:"col-left"},or={class:"form-group"},nr=["value"],ir={class:"form-group"},rr=["value"],cr={class:"form-group"},ur=["value"],dr={class:"form-group"},pr=["disabled","max","min"],mr={class:"form-group"},vr=["disabled"],hr=["value"],kr={class:"form-group"},gr=["value"],br={class:"form-group"},fr=["disabled"],Lr={class:"col-right"},yr={class:"items-section"},wr={class:"items-list"},_r={class:"item-name"},Cr={class:"item-qty"},xr={class:"item-price"},Sr={class:"totals-section"},Er={class:"total-row"},Ar={key:0,class:"total-row"},Tr={key:1,class:"total-row"},Pr={key:2},Dr={key:3,class:"total-row final"},Ir={key:4,class:"total-row"},Kr={key:5},Rr={key:6,class:"total-row final"},Vr={class:"window-footer"};function Nr(e,t,a,o,n,i){const r=(0,s.g2)("PrintInvoice");return o.showPrintView?((0,s.uX)(),(0,s.Wv)(r,{key:1,order:a.item},null,8,["order"])):((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-overlay",onMousedown:t[9]||(t[9]=(0,l.D$)(t=>e.$emit("close"),["self"]))},[(0,s.Lk)("div",{class:"invoice-window",onClick:t[8]||(t[8]=(0,l.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",Gi,[(0,s.Lk)("span",zi,[(0,s.Lk)("span",Yi,"Chi tiết Hóa Đơn: "+(0,y.v_)(a.item.code),1)]),(0,s.Lk)("div",Zi,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},[...t[10]||(t[10]=[(0,s.Lk)("span",null,"×",-1)])])])]),(0,s.Lk)("div",er,[t[26]||(t[26]=(0,s.Lk)("div",{class:"tabs-nav no-select"},[(0,s.Lk)("ul",null,[(0,s.Lk)("li",{class:"active"},[(0,s.Lk)("a",{href:"#"},"Thông tin chung")])])],-1)),(0,s.Lk)("div",tr,[(0,s.Lk)("div",ar,[(0,s.Lk)("div",lr,[(0,s.Lk)("div",sr,[(0,s.Lk)("div",or,[t[11]||(t[11]=(0,s.Lk)("label",null,"Khách hàng",-1)),(0,s.Lk)("input",{type:"text",value:a.item.customer_name,readonly:""},null,8,nr)]),(0,s.Lk)("div",ir,[t[12]||(t[12]=(0,s.Lk)("label",null,"Điện thoại",-1)),(0,s.Lk)("input",{type:"text",value:a.item.customer_phone_number,readonly:""},null,8,rr)]),(0,s.Lk)("div",cr,[t[13]||(t[13]=(0,s.Lk)("label",null,"Địa chỉ",-1)),(0,s.Lk)("textarea",{value:a.item.delivery_address,rows:"2",readonly:""},null,8,ur)]),(0,s.Lk)("div",dr,[t[14]||(t[14]=(0,s.Lk)("label",null,"Ngày",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=e=>o.form.date=e),disabled:!a.item.is_active,onClick:t[2]||(t[2]=e=>e.target.showPicker()),max:o.maxDate,min:o.minDate},null,8,pr),[[l.Jo,o.form.date]])]),(0,s.Lk)("div",mr,[t[15]||(t[15]=(0,s.Lk)("label",null,"Kênh bán",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>o.form.channel=e),disabled:!a.item.is_active},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.channels,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.name,value:e.name},(0,y.v_)(e.name),9,hr))),128))],8,vr),[[l.u1,o.form.channel]])]),(0,s.Lk)("div",kr,[t[16]||(t[16]=(0,s.Lk)("label",null,"Ghi chú",-1)),(0,s.Lk)("textarea",{value:a.item.note,rows:"2"},null,8,gr)]),(0,s.Lk)("div",br,[t[17]||(t[17]=(0,s.Lk)("label",null,"Kích hoạt",-1)),(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>o.form.is_active=e),disabled:!a.item.is_active||!o.store.getters.userAdmin&&!o.store.getters.userSuperadmin},null,8,fr),[[l.lH,o.form.is_active]])])]),(0,s.Lk)("div",Lr,[(0,s.Lk)("div",yr,[t[18]||(t[18]=(0,s.Lk)("strong",{style:{color:"black"}},"Các sản phẩm",-1)),(0,s.Lk)("div",wr,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.item.items,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.uuid,class:"item-row"},[(0,s.Lk)("div",_r,(0,y.v_)(e.name),1),(0,s.Lk)("div",Cr,"x"+(0,y.v_)(e.quantity),1),(0,s.Lk)("div",xr,(0,y.v_)(o.formatCurrency(e.price*e.quantity)),1)]))),128))])]),(0,s.Lk)("div",Sr,[t[25]||(t[25]=(0,s.Lk)("strong",{style:{color:"black"}},"Tổng cộng",-1)),(0,s.Lk)("div",Er,[t[19]||(t[19]=(0,s.Lk)("span",null,"Tiền hàng",-1)),(0,s.Lk)("span",null,(0,y.v_)(o.formatCurrency(a.item.total)),1)]),Number(a.item.discount)>0?((0,s.uX)(),(0,s.CE)("div",Ar,[t[20]||(t[20]=(0,s.Lk)("span",null,"Giảm giá",-1)),(0,s.Lk)("span",null,"-"+(0,y.v_)(o.formatCurrency(a.item.discount)),1)])):(0,s.Q3)("",!0),Number(a.item.total_surcharge)>0?((0,s.uX)(),(0,s.CE)("div",Tr,[t[21]||(t[21]=(0,s.Lk)("span",null,"Phụ phí",-1)),(0,s.Lk)("span",null,"+"+(0,y.v_)(o.formatCurrency(a.item.total_surcharge)),1)])):(0,s.Q3)("",!0),a.item.code.startsWith("SP_")?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("hr",Pr)),a.item.code.startsWith("SP_")?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Dr,[t[22]||(t[22]=(0,s.Lk)("span",null,"Khách phải trả",-1)),(0,s.Lk)("span",null,(0,y.v_)(o.formatCurrency(a.item.final_total)),1)])),a.item.code.startsWith("SP_")?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Ir,[t[23]||(t[23]=(0,s.Lk)("span",null,"Đã thanh toán",-1)),(0,s.Lk)("span",null,(0,y.v_)(o.formatCurrency(a.item.amount_paid_by_customer)),1)])),a.item.code.startsWith("SP_")?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("hr",Kr)),a.item.code.startsWith("SP_")?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Rr,[t[24]||(t[24]=(0,s.Lk)("span",null,"Tiền ship đã trả bằng tiền mặt",-1)),(0,s.Lk)("span",null,(0,y.v_)(o.formatCurrency(a.item.amount_paid_transport_company)),1)]))])])])])]),(0,s.Lk)("div",Vr,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline",onClick:t[5]||(t[5]=(...e)=>o.handlePrint&&o.handlePrint(...e)),style:{"margin-right":"auto"}}," In "),(0,s.Lk)("button",{type:"button",class:"btn btn-outline",onClick:t[6]||(t[6]=t=>e.$emit("close"))},"Đóng"),a.item.is_active?((0,s.uX)(),(0,s.CE)("button",{key:0,type:"button",class:"btn btn-primary",onClick:t[7]||(t[7]=(...e)=>o.handleSubmit&&o.handleSubmit(...e))},"Lưu")):(0,s.Q3)("",!0)])])])],32))}var Xr={name:"AddEditInvoice",components:{PrintInvoice:nl},props:{item:{type:Object,required:!0},channels:{type:Array,default:()=>[]},d_edit_days:{type:Number,default:3}},emits:["close","saved"],setup(e,{emit:t}){const a=(0,be.KR)(!1),l=e=>{const t=6e4*e.getTimezoneOffset(),a=new Date(e-t).toISOString().slice(0,10);return a},o=(0,s.EW)(()=>{const e=new Date;return e.toISOString().split("T")[0]}),i=(0,s.EW)(()=>{if(u.getters.userAdmin||u.getters.userSuperadmin)return"";const t=new Date,a=new Date;return a.setDate(t.getDate()-(e.d_edit_days||3)),l(a)}),{item:c}=(0,be.QW)(e),u=(0,n.Pj)(),d=(0,be.Kh)({date:"",is_active:!0,channel:""});(0,s.wB)(c,e=>{e&&(d.date=e.date,d.is_active=e.is_active,d.channel=e.channel)},{immediate:!0});const p=e=>{const t=Number(e);return isNaN(t)?"0 ₫":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t)};async function m(){const e={date:d.date,is_active:d.is_active,channel:d.channel};try{const a=await r.A.patch(`/invoices/${c.value.id}/`,e);t("saved",a.data),t("close")}catch(a){console.error("Error updating invoice:",a),window.alert("Lỗi cập nhật hóa đơn: "+(a.response&&a.response.data?JSON.stringify(a.response.data):a.message))}}const v=()=>{a.value=!0,(0,s.dY)(()=>{window.print(),a.value=!1})};return{form:d,formatCurrency:p,handleSubmit:m,store:u,maxDate:o,minDate:i,showPrintView:a,handlePrint:v}}};const Fr=(0,p.A)(Xr,[["render",Nr],["__scopeId","data-v-f49eebde"]]);var Ur=Fr;const Or={class:"window-header"},Wr={class:"window-title"},qr={class:"no-select"},Qr={class:"window-actions no-select"},Jr={class:"window-content"},Mr={class:"form-body"},$r={class:"tab-pane"},Br={class:"form-layout"},Hr={class:"col-left"},jr={class:"form-group"},Gr={class:"form-group"},zr={class:"form-group"},Yr={class:"form-group"},Zr={class:"window-footer"},ec=["disabled"];function tc(e,t,a,o,n,i){return(0,s.uX)(),(0,s.CE)("div",{class:"modal-overlay",onMousedown:t[10]||(t[10]=(0,l.D$)(t=>e.$emit("close"),["self"]))},[(0,s.Lk)("div",{class:"surcharge-window",onClick:t[9]||(t[9]=(0,l.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",Or,[(0,s.Lk)("span",Wr,[(0,s.Lk)("span",qr,(0,y.v_)(o.item&&o.item.id?"Chỉnh sửa phụ phí":"Tạo phụ phí mới"),1)]),(0,s.Lk)("div",Qr,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},[...t[11]||(t[11]=[(0,s.Lk)("span",null,"×",-1)])])])]),(0,s.Lk)("div",Jr,[t[16]||(t[16]=(0,s.Lk)("div",{class:"tabs-nav no-select"},[(0,s.Lk)("ul",null,[(0,s.Lk)("li",{class:"active"},[(0,s.Lk)("a",{href:"#"},"Thông tin chung")])])],-1)),(0,s.Lk)("div",Mr,[(0,s.Lk)("div",$r,[(0,s.Lk)("div",Br,[(0,s.Lk)("div",Hr,[(0,s.Lk)("div",jr,[t[12]||(t[12]=(0,s.Lk)("label",{for:"code"},"Mã",-1)),(0,s.bo)((0,s.Lk)("input",{id:"code","onUpdate:modelValue":t[1]||(t[1]=e=>o.code=e),type:"text",maxlength:"10"},null,512),[[l.Jo,o.code]])]),(0,s.Lk)("div",Gr,[t[13]||(t[13]=(0,s.Lk)("label",{for:"description"},"Mô tả",-1)),(0,s.bo)((0,s.Lk)("input",{id:"description","onUpdate:modelValue":t[2]||(t[2]=e=>o.description=e),type:"text",maxlength:"100",required:""},null,512),[[l.Jo,o.description]])]),(0,s.Lk)("div",zr,[t[14]||(t[14]=(0,s.Lk)("label",{for:"amount"},"Số tiền",-1)),(0,s.bo)((0,s.Lk)("input",{id:"amount","onUpdate:modelValue":t[3]||(t[3]=e=>o.amountDisplay=e),type:"text",required:"",style:{"text-align":"right"},onFocus:t[4]||(t[4]=(...e)=>o.selectAll&&o.selectAll(...e)),onBeforeinput:t[5]||(t[5]=(...e)=>o.onlyNumbers&&o.onlyNumbers(...e))},null,544),[[l.Jo,o.amountDisplay]])]),(0,s.Lk)("div",Yr,[t[15]||(t[15]=(0,s.Lk)("label",{for:"is_active"},"Kích hoạt",-1)),(0,s.bo)((0,s.Lk)("input",{id:"is_active","onUpdate:modelValue":t[6]||(t[6]=e=>o.isActive=e),type:"checkbox"},null,512),[[l.lH,o.isActive]])])])])])]),(0,s.Lk)("div",Zr,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline",onClick:t[7]||(t[7]=t=>e.$emit("close"))},"Đóng"),(0,s.Lk)("button",{type:"button",class:"btn btn-primary new-button",onClick:t[8]||(t[8]=(...e)=>o.handleSubmit&&o.handleSubmit(...e)),disabled:!o.code.trim()||0===o.amount||!o.description.trim()},(0,y.v_)(o.item&&o.item.id?"Lưu":"Tạo mới"),9,ec)])])])],32)}var ac={name:"AddEditSurcharge",props:{item:{type:Object,default:null}},emits:["close","saved"],setup(e,{emit:t}){const{item:a}=(0,be.QW)(e),l=(0,be.KR)(a.value?a.value.code:""),o=(0,be.KR)(a.value?a.value.description:""),n=(0,be.KR)(a.value?a.value.amount:0),i=(0,be.KR)(!a.value||void 0===a.value.is_active||a.value.is_active),c=(0,s.EW)({get:()=>0===n.value?"0":new Intl.NumberFormat("vi-VN").format(n.value),set:e=>{const t=e.replace(/\D/g,"");n.value=t?parseInt(t,10):0}});function u(e){e.target.select()}function d(e){e.data&&!/^\d+$/.test(e.data)&&e.preventDefault()}async function p(){const e={code:l.value,description:o.value,amount:n.value,is_active:i.value};a.value&&a.value.id?(e.id=a.value.id,await r.A.put(`/surcharges/${a.value.id}/`,e).then(e=>{console.log("Surcharge updated:",e.data),t("saved",e.data)}).catch(e=>{console.error("Error updating surcharge:",e),window.alert("Lỗi khi cập nhật phụ phí: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))})):await r.A.post("/surcharges/",e).then(e=>{console.log("Surcharge created:",e.data),t("saved",e.data)}).catch(e=>{console.error("Error creating surcharge:",e),window.alert("Lỗi khi tạo phụ phí: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))})}return(0,s.wB)(a,e=>{l.value=e?e.code:"",o.value=e?e.description:"",n.value=e?e.amount:0,i.value=!e||void 0===e.is_active||e.is_active}),{code:l,description:o,amount:n,amountDisplay:c,isActive:i,item:a,handleSubmit:p,selectAll:u,onlyNumbers:d}}};const lc=(0,p.A)(ac,[["render",tc],["__scopeId","data-v-3633bf30"]]);var sc=lc,oc={name:"Invoices",components:{AddEditInvoice:Ur,AddEditSurcharge:sc},props:{channels:{type:Array,default:()=>[]},d_edit_days:{type:Number,default:3}},setup(e){const t=(0,be.KR)("new"),a=(0,be.KR)({top:"0px",left:"0px",width:"200px"}),l=(0,n.Pj)(),o=(0,be.KR)([]),i=(0,be.KR)(""),c=(0,be.KR)(1),u=(0,be.KR)(200),d=(0,be.KR)(!1),p=(0,be.KR)({}),m=(0,be.KR)(!1),v=(0,be.KR)([]),h=(0,be.KR)([]),k=(0,be.KR)(!1),g=(0,be.KR)(null),b=(0,be.KR)([]),f=(0,be.KR)([]),L=(0,be.KR)([]),y=(0,be.KR)(!1),w=(0,be.KR)(null),_=(0,be.KR)([]),C=(0,be.KR)([]),x=(0,be.KR)(!1),S=(0,be.KR)(null),E=(0,be.KR)(null),A=()=>{E.value&&E.value.click()},T=(0,s.EW)(()=>e.channels||[]),P=async e=>{const t=e.target.files[0];if(!t)return;const a=new FormData;a.append("file",t),l.commit("setLoading",!0);try{await r.A.post("/process_shopee/",a,{headers:{"Content-Type":"multipart/form-data"}}),await H(),window.alert("Import thành công!")}catch(s){console.error("Error importing shopee file:",s),window.alert("Lỗi import file: "+(s.response?.data?.message||s.message))}finally{l.commit("setLoading",!1),e.target.value=null}},D=e=>new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().slice(0,10),I=(0,be.KR)(D(new Date(Date.now()-6048e5))),K=(0,be.KR)(D(new Date)),R=[{title:"",key:"actions",sortable:!1,headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Mã HĐ",key:"code",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Khách hàng",key:"customer_name",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Người bán",key:"seller",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Tổng tiền",key:"final_total",headerProps:{class:"my-custom-header-class"},align:"end",cellProps:{class:"text-right"}},{title:"Ngày",key:"date",headerProps:{class:"my-custom-header-class"},align:"end",cellProps:{class:"text-right"}},{title:"Trạng thái",key:"is_active",headerProps:{class:"my-custom-header-class"},align:"end",cellProps:{class:"text-right"}},{title:"Thời gian tạo",key:"created_at",headerProps:{class:"my-custom-header-class pr-3"},align:"end",cellProps:{class:"text-right pr-3"}}],V=(0,be.KR)(null),N=()=>{m.value=!m.value,m.value&&X()},X=()=>{(0,s.dY)(()=>{const e=document.querySelector(".create-new-btn-group");if(e){const t=e.getBoundingClientRect();a.value={top:`${t.bottom+window.scrollY}px`,left:`${t.left+window.scrollX}px`,width:`${t.width}px`}}})},F=()=>{y.value=!y.value},U=()=>{x.value=!x.value},O=e=>{if(m.value){const t=V.value;t&&!t.contains(e.target)&&(m.value=!1)}y.value&&w.value&&!w.value.contains(e.target)&&(y.value=!1),x.value&&S.value&&!S.value.contains(e.target)&&(x.value=!1)},W=(0,s.EW)(()=>f.value&&0!==f.value.length?f.value.length===L.value.length?"Tất cả":f.value.length>1?`${f.value.length} người bán đã chọn`:f.value[0]:"Tất cả"),q=(0,s.EW)({get:()=>L.value.length>0&&f.value.length===L.value.length,set:e=>{f.value=e?L.value.slice():[]}}),Q=(0,s.EW)(()=>_.value&&0!==_.value.length?_.value.length===C.value.length?"Tất cả":_.value.length>1?`${_.value.length} kênh đã chọn`:_.value[0]:"Tất cả"),J=(0,s.EW)({get:()=>C.value.length>0&&_.value.length===C.value.length,set:e=>{_.value=e?C.value.slice():[]}}),M=e=>{let t=v.value.find(t=>"object"===typeof e&&null!==e?t.id===e.id:t.id===e);console.log("Editing surcharge:",t),m.value=!1,g.value=t,k.value=!0},$=(0,be.KR)([!0]),B=(0,s.EW)(()=>{let e=o.value;if($.value&&$.value.length>0&&(e=e.filter(e=>$.value.includes(e.is_active))),f.value&&f.value.length>0&&(e=e.filter(e=>f.value.includes(e.seller))),_.value&&_.value.length>0&&(e=e.filter(e=>_.value.includes(e.channel))),!i.value.trim())return e;const t=i.value.toLowerCase();return e.filter(e=>e.code&&e.code.toLowerCase().includes(t)||e.customer_name&&e.customer_name.toLowerCase().includes(t))}),H=async()=>{l.commit("setLoading",!0);try{const e=await r.A.get("/invoices/",{params:{dateFrom:I.value,dateTo:K.value}});o.value=e.data}catch(e){console.error("Error fetching invoices:",e)}l.commit("setLoading",!1)},j=e=>"number"!==typeof e?e:e.toLocaleString("en-US"),G=e=>{if(!e)return"";const t=new Date(e),a=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0");return`${a}/${l}/${s} ${o}:${n}:${i}`},z=async()=>{try{const[e,t]=await Promise.all([r.A.get("/provinces/"),r.A.get("/wards/")]);b.value=e.data,h.value=t.data}catch(e){console.error("Error fetching provinces or wards:",e)}},Y=async()=>{try{const e=await r.A.get("/surcharges/",{});v.value=e.data}catch(e){}};function Z(){t.value="new",p.value={},d.value=!0}async function ee(){l.commit("setLoading",!0);try{const e=await r.A.get("/invoices/",{params:{dateFrom:I.value,dateTo:K.value,export:"true"},responseType:"blob"}),t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.download="invoices.xlsx",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t)}catch(e){console.error("Error exporting invoices:",e)}l.commit("setLoading",!1)}const te=t=>{if(l.getters.userAdmin||l.getters.userSuperadmin)return!0;if(!t)return!1;const a=new Date;a.setHours(0,0,0,0);const s=new Date(t);s.setHours(0,0,0,0);const o=(a.getTime()-s.getTime())/864e5;return o<e.d_edit_days};function ae(){selectedCustomer.value={},d.value=!0}function le(e,{item:a}){console.log("Editing invoice:",a),p.value={...a},t.value="edit",d.value=!0}async function se(){console.log("Invoice saved, refreshing list..."),await H(),d.value=!1}return(0,s.wB)([I,K],H),(0,s.wB)(o,e=>{if(e&&e.length>0){const t=e.map(e=>e.seller).filter(Boolean);L.value=[...new Set(t)];const a=e.map(e=>e.channel).filter(Boolean);C.value=[...new Set(a)]}}),(0,s.sV)(()=>{H(),z(),Y(),document.addEventListener("mousedown",O)}),(0,s.xo)(()=>{document.removeEventListener("mousedown",O)}),{editOrNew:t,invoices:o,filterText:i,currentPage:c,pageSize:u,showAddEdit:d,selectedInvoice:p,showSurchargeList:m,surchargeList:v,headers:R,filteredInvoices:B,isActiveFilter:$,provinces:b,wards:h,groupListPosition:a,groupListRef:V,showAddEditSurchargeModal:k,editingSurcharge:g,channels:T,sellerFilter:f,uniqueSellers:L,showSellerFilterDropdown:y,sellerFilterDropdownRef:w,toggleSellerFilterDropdown:F,selectedSellerNames:W,allSellersSelected:q,channelFilter:_,uniqueChannels:C,showChannelFilterDropdown:x,channelFilterDropdownRef:S,toggleChannelFilterDropdown:U,selectedChannelNames:Q,allChannelsSelected:J,formatPrice:j,formatDateTime:G,exportToCSV:ee,openAddCustomer:ae,openEditInvoice:le,onInvoiceSaved:se,createNewInvoice:Z,toggleGroupList:N,openAddEditSurcharge:M,fetchSurcharges:Y,dateFrom:I,dateTo:K,fileInputShopee:E,isEditable:te,triggerImportShopee:A,handleFileUploadShopee:P,store:l}}};const nc=(0,p.A)(oc,[["render",ji],["__scopeId","data-v-7fc39641"]]);var ic=nc;const rc={class:"work-area"},cc={class:"top-area"},uc={class:"action-area"},dc={class:"page-actions"},pc={class:"datatable-toolbar"},mc=["value"],vc={class:"other-actions"},hc={class:"buttons-area"},kc={class:"bottom-area"},gc={class:"filter-area"},bc={class:"filters"},fc={class:"form-group"},Lc={class:"checkbox-group"},yc={class:"data-area"},wc=["onClick"];function _c(e,t,a,o,n,i){const r=(0,s.g2)("v-data-table"),c=(0,s.g2)("AddEditSettings");return(0,s.uX)(),(0,s.CE)("div",rc,[(0,s.Lk)("div",cc,[t[8]||(t[8]=(0,s.Lk)("div",{class:"page-name-area"},"Cài Đặt",-1)),(0,s.Lk)("div",uc,[(0,s.Lk)("div",dc,[(0,s.Lk)("div",pc,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.filterText=e),placeholder:"Tìm kiếm...",class:"search-input",style:{"margin-right":"1rem"}},null,512),[[l.Jo,o.filterText]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.pageSize=e),class:"page-size-select"},[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)([5,10,20,50,100,200],e=>(0,s.Lk)("option",{key:e,value:e},(0,y.v_)(e)+" rows",9,mc)),64))],512),[[l.u1,o.pageSize]])])]),(0,s.Lk)("div",vc,[(0,s.Lk)("div",hc,[(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>o.createNewItem&&o.createNewItem(...e)),class:"btn btn-primary"}," Tạo mới "),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>o.exportToCSV&&o.exportToCSV(...e)),class:"btn btn-secondary"},[...t[7]||(t[7]=[(0,s.Lk)("i",{class:"fa-solid fa-file-excel",style:{"margin-right":"0.5rem"}},null,-1),(0,s.eW)(" Export CSV ",-1)])])])])])]),(0,s.Lk)("div",kc,[(0,s.Lk)("div",gc,[(0,s.Lk)("div",bc,[(0,s.Lk)("div",fc,[t[11]||(t[11]=(0,s.Lk)("label",null,"Trạng thái",-1)),(0,s.Lk)("div",Lc,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>o.isActiveFilter=e),value:!0},null,512),[[l.lH,o.isActiveFilter]]),t[9]||(t[9]=(0,s.eW)(" Kích hoạt",-1))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>o.isActiveFilter=e),value:!1},null,512),[[l.lH,o.isActiveFilter]]),t[10]||(t[10]=(0,s.eW)(" Không kích hoạt",-1))])])])])]),(0,s.Lk)("div",yc,[(0,s.bF)(r,{headers:o.headers,items:o.filteredItems,"items-per-page":o.pageSize,page:o.currentPage,class:"elevation-1","fixed-header":"",search:o.filterText},{"item.actions":(0,s.k6)(({item:e})=>[(0,s.Lk)("button",{class:"c-button",onClick:t=>o.openEditItem(t,{item:e})},[...t[12]||(t[12]=[(0,s.Lk)("i",{class:"fa-solid fa-pen-to-square"},null,-1)])],8,wc)]),"item.price":(0,s.k6)(({item:e})=>[(0,s.eW)((0,y.v_)(o.formatPrice(e.price)),1)]),_:1},8,["headers","items","items-per-page","page","search"])])]),o.showAddEditItem?((0,s.uX)(),(0,s.Wv)(c,{key:0,item:o.selectedItem,onClose:t[6]||(t[6]=e=>o.showAddEditItem=!1),onSaved:o.onItemSaved},null,8,["item","onSaved"])):(0,s.Q3)("",!0)])}const Cc={class:"window-header"},xc={class:"window-title"},Sc={class:"no-select"},Ec={class:"window-actions no-select"},Ac={class:"window-content"},Tc={class:"form-body"},Pc={class:"tab-pane"},Dc={class:"form-layout"},Ic={class:"col-left"},Kc={class:"form-group"},Rc=["disabled"],Vc={class:"form-group"},Nc={class:"form-group"},Xc={class:"window-footer"};function Fc(e,t,a,o,n,i){return(0,s.uX)(),(0,s.CE)("div",{class:"modal-overlay",onMousedown:t[7]||(t[7]=(0,l.D$)(t=>e.$emit("close"),["self"]))},[(0,s.Lk)("div",{class:"settings-window",onClick:t[6]||(t[6]=(0,l.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",Cc,[(0,s.Lk)("span",xc,[(0,s.Lk)("span",Sc,(0,y.v_)(o.item&&o.item.id?"Chỉnh sửa cấu hình":"Tạo cấu hình mới"),1)]),(0,s.Lk)("div",Ec,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},[...t[8]||(t[8]=[(0,s.Lk)("span",null,"×",-1)])])])]),(0,s.Lk)("div",Ac,[t[12]||(t[12]=(0,s.Lk)("div",{class:"tabs-nav no-select"},[(0,s.Lk)("ul",null,[(0,s.Lk)("li",{class:"active"},[(0,s.Lk)("a",{href:"#"},"Thông tin chung")])])],-1)),(0,s.Lk)("div",Tc,[(0,s.Lk)("div",Pc,[(0,s.Lk)("div",Dc,[(0,s.Lk)("div",Ic,[(0,s.Lk)("div",Kc,[t[9]||(t[9]=(0,s.Lk)("label",{for:"key"},"Key",-1)),(0,s.bo)((0,s.Lk)("input",{id:"key","onUpdate:modelValue":t[1]||(t[1]=e=>o.key=e),type:"text",required:"",disabled:!!o.item.id},null,8,Rc),[[l.Jo,o.key]])]),(0,s.Lk)("div",Vc,[t[10]||(t[10]=(0,s.Lk)("label",{for:"value"},"Value",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"value","onUpdate:modelValue":t[2]||(t[2]=e=>o.value=e),rows:"5",required:""},null,512),[[l.Jo,o.value]])]),(0,s.Lk)("div",Nc,[t[11]||(t[11]=(0,s.Lk)("label",{for:"is_active"},"Kích hoạt",-1)),(0,s.bo)((0,s.Lk)("input",{id:"is_active","onUpdate:modelValue":t[3]||(t[3]=e=>o.isActive=e),type:"checkbox"},null,512),[[l.lH,o.isActive]])])])])])]),(0,s.Lk)("div",Xc,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline",onClick:t[4]||(t[4]=t=>e.$emit("close"))},"Đóng"),(0,s.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=(...e)=>o.handleSubmit&&o.handleSubmit(...e))},(0,y.v_)(o.item&&o.item.id?"Lưu":"Tạo mới"),1)])])])],32)}var Uc={name:"AddEditSettings",props:{item:{type:Object,default:null}},emits:["close","saved"],setup(e,{emit:t}){const{item:a}=(0,be.QW)(e),l=(0,be.KR)(a.value?a.value.key:""),o=(0,be.KR)(a.value?a.value.value:""),n=(0,be.KR)(!a.value||void 0===a.value.is_active||a.value.is_active);async function i(){if(a.value&&a.value.id){const e={id:a.value.id,key:l.value,value:o.value,is_active:n.value};return void await r.A.put(`/logicconfigs/${a.value.id}/`,e).then(a=>{console.log("Product group updated:",a.data),t("saved",e)}).catch(e=>{console.error("Error updating product group:",e),window.alert("Lỗi khi cập nhật cấu hình: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))})}{const e={key:l.value,value:o.value,is_active:n.value};await r.A.post("/logicconfigs/",e).then(a=>{console.log("Product group created:",a.data),t("saved",e)}).catch(e=>{console.error("Error creating product group:",e),window.alert("Lỗi khi tạo cấu hình: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))})}}return(0,s.wB)(a,e=>{l.value=e?e.key:"",o.value=e?e.value:"",n.value=!e||void 0===e.is_active||e.is_active}),{key:l,value:o,isActive:n,item:a,handleSubmit:i}}};const Oc=(0,p.A)(Uc,[["render",Fc],["__scopeId","data-v-1610e3ea"]]);var Wc=Oc,qc={name:"Settings",components:{AddEditSettings:Wc},setup(){const e=(0,be.KR)([]),t=(0,be.KR)(""),a=(0,be.KR)(1),l=(0,be.KR)(50),o=(0,be.KR)(!1),n=(0,be.KR)({}),i=[{title:"",key:"actions",sortable:!1,headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"id",key:"id",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Mã",key:"key",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Nội Dung",key:"value",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Kích Hoạt",key:"is_active",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}}],c=(0,be.KR)([!0]),u=(0,s.EW)(()=>{let a=e.value;if(c.value&&c.value.length>0&&(a=a.filter(e=>c.value.includes(e.is_active))),!t.value.trim())return a;const l=t.value.toLowerCase();return a.filter(e=>e.name&&e.name.toLowerCase().includes(l))}),d=async()=>{try{const t=await r.A.get("/logicconfigs/");e.value=t.data.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at))}catch(t){console.error("Error fetching items:",t)}},p=e=>"number"!==typeof e?e:e.toLocaleString("en-US");function m(){const e=[];e.push(i.map(e=>e.title).join(",")),u.value.forEach(t=>{e.push(i.map(e=>{let a=t[e.key];return"price"===e.key&&(a=p(a)),'"'+(void 0!==a?String(a).replace(/"/g,'""'):"")+'"'}).join(","))});const t=e.join("\n"),a=new Blob([t],{type:"text/csv"}),l=window.URL.createObjectURL(a),s=document.createElement("a");s.href=l,s.download="data.csv",s.click(),window.URL.revokeObjectURL(l)}function v(){n.value={},o.value=!0}function h(e,{item:t}){console.log("Clicked item:",t),n.value={...t},o.value=!0}function k(){n.value={},o.value=!0}async function g(){console.log("Item saved, refreshing list..."),await d(),o.value=!1}return(0,s.sV)(()=>{d()}),{items:e,filterText:t,currentPage:a,pageSize:l,showAddEditItem:o,selectedItem:n,headers:i,filteredItems:u,isActiveFilter:c,formatPrice:p,exportToCSV:m,openAddItem:v,openEditItem:h,createNewItem:k,onItemSaved:g}}};const Qc=(0,p.A)(qc,[["render",_c],["__scopeId","data-v-d04e8c88"]]);var Jc=Qc;const Mc={class:"work-area"},$c={class:"top-area"},Bc={class:"action-area"},Hc={class:"page-actions"},jc={class:"datatable-toolbar"},Gc=["value"],zc={class:"other-actions"},Yc={class:"buttons-area"},Zc={class:"list-product-groups btn-group",style:{position:"relative"}},eu={style:{margin:"0",padding:"0","list-style":"none"}},tu=["onClick"],au={style:{padding:"0.5rem 0","border-bottom":"none"}},lu={style:{"text-align":"right","margin-top":"0.5rem"}},su={class:"list-product-groups btn-group",style:{position:"relative"}},ou={style:{margin:"0",padding:"0","list-style":"none"}},nu=["onClick"],iu={style:{padding:"0.5rem 0","border-bottom":"none"}},ru={style:{"text-align":"right","margin-top":"0.5rem"}},cu={class:"bottom-area"},uu={class:"filter-area"},du={class:"filters"},pu={class:"form-group"},mu={class:"form-group"},vu={class:"form-group"},hu={class:"checkbox-group"},ku={class:"form-group"},gu={class:"checkbox-group"},bu={class:"form-group"},fu={class:"multiselect-dropdown",ref:"transactionTypeFilterDropdownRef"},Lu={key:0,class:"multiselect-menu"},yu={class:"multiselect-item"},wu=["value"],_u={class:"form-group"},Cu={class:"multiselect-dropdown",ref:"bankAccountFilterDropdownRef"},xu={key:0,class:"multiselect-menu"},Su={class:"multiselect-item"},Eu=["value"],Au={class:"data-area"},Tu=["onClick"];function Pu(e,t,a,o,n,i){const r=(0,s.g2)("v-data-table"),c=(0,s.g2)("AddEditTrans"),u=(0,s.g2)("AddEditAccounts"),d=(0,s.g2)("AddEditTransactionType");return(0,s.uX)(),(0,s.CE)("div",Mc,[(0,s.Lk)("div",$c,[t[33]||(t[33]=(0,s.Lk)("div",{class:"page-name-area"},"Sổ Quỹ",-1)),(0,s.Lk)("div",Bc,[(0,s.Lk)("div",Hc,[(0,s.Lk)("div",jc,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.filterText=e),placeholder:"Tìm kiếm...",class:"search-input",style:{"margin-right":"1rem"}},null,512),[[l.Jo,o.filterText]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.pageSize=e),class:"page-size-select"},[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)([5,10,20,50,100,200],e=>(0,s.Lk)("option",{key:e,value:e},(0,y.v_)(e)+" rows",9,Gc)),64))],512),[[l.u1,o.pageSize]])])]),(0,s.Lk)("div",zc,[(0,s.Lk)("div",Yc,[(0,s.Lk)("button",{onClick:t[2]||(t[2]=e=>o.createNewItem("DR")),class:"btn btn-primary",style:{"margin-right":"0.5rem"}}," Phiếu Thu "),(0,s.Lk)("button",{onClick:t[3]||(t[3]=e=>o.createNewItem("CR")),class:"btn btn-primary",style:{"margin-right":"0.5rem"}}," Phiếu Chi "),o.store.getters.userAdmin||o.store.getters.userSuperadmin?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[4]||(t[4]=(...e)=>o.toggleSubList&&o.toggleSubList(...e)),class:"btn btn-outline create-new-btn-group",style:{"margin-right":"0.5rem"}}," Bank Accounts ")):(0,s.Q3)("",!0),(0,s.Lk)("div",Zc,[((0,s.uX)(),(0,s.Wv)(s.Im,{to:"body"},[o.showSubList?((0,s.uX)(),(0,s.CE)("div",{key:0,ref:"subListRef",class:"product-group-teleport",onClick:t[7]||(t[7]=(0,l.D$)(e=>o.showSubList=!1,["self"])),style:(0,y.Tr)({position:"fixed",maxHeight:"50vh",overflow:"auto",top:o.subListPosition.top,left:o.subListPosition.left,zIndex:9999,background:"white",border:"1px solid #ccc",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",padding:"1rem",minWidth:o.subListPosition.width})},[(0,s.Lk)("ul",eu,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.subList,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.id,style:{padding:"0.5rem 0","border-bottom":"1px solid #eee"}},[(0,s.Lk)("span",null,(0,y.v_)(e.bank_name+" - "+e.account_number),1),(0,s.Lk)("button",{onClick:(0,l.D$)(t=>o.openAddEditSub(e),["stop","prevent"]),class:"c-button"},[...t[30]||(t[30]=[(0,s.Lk)("i",{class:"fa-solid fa-pen-to-square"},null,-1)])],8,tu)]))),128)),(0,s.Lk)("li",au,[(0,s.Lk)("button",{onClick:t[5]||(t[5]=e=>o.openAddEditSub(null)),style:{padding:"0.3rem 1rem"}},"+ Tạo mới")])]),(0,s.Lk)("div",lu,[(0,s.Lk)("button",{onClick:t[6]||(t[6]=e=>o.showSubList=!1),style:{padding:"0.3rem 1rem"}},"Đóng")])],4)):(0,s.Q3)("",!0)]))]),o.store.getters.userAdmin||o.store.getters.userSuperadmin?((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:t[8]||(t[8]=(...e)=>o.toggleSubList2&&o.toggleSubList2(...e)),class:"btn btn-outline create-new-btn-group-2",style:{"margin-right":"0.5rem"}}," Loại Giao Dịch ")):(0,s.Q3)("",!0),(0,s.Lk)("div",su,[((0,s.uX)(),(0,s.Wv)(s.Im,{to:"body"},[o.showSubList2?((0,s.uX)(),(0,s.CE)("div",{key:0,ref:"subListRef2",class:"product-group-teleport",onClick:t[11]||(t[11]=(0,l.D$)(e=>o.showSubList2=!1,["self"])),style:(0,y.Tr)({position:"fixed",maxHeight:"50vh",overflow:"auto",top:o.subListPosition2.top,left:o.subListPosition2.left,zIndex:9999,background:"white",border:"1px solid #ccc",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",padding:"1rem",minWidth:o.subListPosition2.width})},[(0,s.Lk)("ul",ou,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.subList2,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.id,style:{padding:"0.5rem 0","border-bottom":"1px solid #eee"}},[(0,s.Lk)("span",null,(0,y.v_)(e.name),1),e.id>4?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:(0,l.D$)(t=>o.openAddEditSub2(e),["stop","prevent"]),class:"c-button"},[...t[31]||(t[31]=[(0,s.Lk)("i",{class:"fa-solid fa-pen-to-square"},null,-1)])],8,nu)):(0,s.Q3)("",!0)]))),128)),(0,s.Lk)("li",iu,[(0,s.Lk)("button",{onClick:t[9]||(t[9]=e=>o.openAddEditSub2(null)),style:{padding:"0.3rem 1rem"}},"+ Tạo mới")])]),(0,s.Lk)("div",ru,[(0,s.Lk)("button",{onClick:t[10]||(t[10]=e=>o.showSubList2=!1),style:{padding:"0.3rem 1rem"}},"Đóng")])],4)):(0,s.Q3)("",!0)]))]),(0,s.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>o.exportToExcel&&o.exportToExcel(...e)),class:"btn btn-secondary"},[...t[32]||(t[32]=[(0,s.Lk)("i",{class:"fa-solid fa-file-excel",style:{"margin-right":"0.5rem"}},null,-1),(0,s.eW)(" Export Excel ",-1)])])])])])]),(0,s.Lk)("div",cu,[(0,s.Lk)("div",uu,[(0,s.Lk)("div",du,[(0,s.Lk)("div",pu,[t[34]||(t[34]=(0,s.Lk)("label",null,"Từ ngày",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[13]||(t[13]=e=>o.dateFrom=e),onClick:t[14]||(t[14]=e=>e.target.showPicker())},null,512),[[l.Jo,o.dateFrom]])]),(0,s.Lk)("div",mu,[t[35]||(t[35]=(0,s.Lk)("label",null,"Đến ngày",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[15]||(t[15]=e=>o.dateTo=e),onClick:t[16]||(t[16]=e=>e.target.showPicker())},null,512),[[l.Jo,o.dateTo]])]),(0,s.Lk)("div",vu,[t[38]||(t[38]=(0,s.Lk)("label",null,"Trạng thái",-1)),(0,s.Lk)("div",hu,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[17]||(t[17]=e=>o.isActiveFilter=e),value:!0},null,512),[[l.lH,o.isActiveFilter]]),t[36]||(t[36]=(0,s.eW)(" Kích hoạt",-1))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[18]||(t[18]=e=>o.isActiveFilter=e),value:!1},null,512),[[l.lH,o.isActiveFilter]]),t[37]||(t[37]=(0,s.eW)(" Không kích hoạt",-1))])])]),(0,s.Lk)("div",ku,[t[41]||(t[41]=(0,s.Lk)("label",null,"Loại phiếu",-1)),(0,s.Lk)("div",gu,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[19]||(t[19]=e=>o.debitCreditFilter=e),value:"DR"},null,512),[[l.lH,o.debitCreditFilter]]),t[39]||(t[39]=(0,s.eW)(" Phiếu thu",-1))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[20]||(t[20]=e=>o.debitCreditFilter=e),value:"CR"},null,512),[[l.lH,o.debitCreditFilter]]),t[40]||(t[40]=(0,s.eW)(" Phiếu chi",-1))])])]),(0,s.Lk)("div",bu,[t[43]||(t[43]=(0,s.Lk)("label",null,"Chi tiết loại thu/chi",-1)),(0,s.Lk)("div",fu,[(0,s.Lk)("button",{onClick:t[21]||(t[21]=(...e)=>o.toggleTransactionTypeFilterDropdown&&o.toggleTransactionTypeFilterDropdown(...e)),class:"multiselect-toggle"},(0,y.v_)(o.selectedTransactionTypeNames),1),o.showTransactionTypeFilterDropdown?((0,s.uX)(),(0,s.CE)("div",Lu,[(0,s.Lk)("div",yu,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[22]||(t[22]=e=>o.allTransactionTypesSelected=e),style:{"margin-right":"0.5rem"}},null,512),[[l.lH,o.allTransactionTypesSelected]]),t[42]||(t[42]=(0,s.eW)(" Tất cả ",-1))])]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredTransactionTypesForFilter,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"multiselect-item"},[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[23]||(t[23]=e=>o.transactionTypeFilter=e),value:e.id,style:{"margin-right":"0.5rem"}},null,8,wu),[[l.lH,o.transactionTypeFilter]]),(0,s.eW)(" "+(0,y.v_)(e.name),1)])]))),128))])):(0,s.Q3)("",!0)],512)]),(0,s.Lk)("div",_u,[t[45]||(t[45]=(0,s.Lk)("label",null,"Tài khoản",-1)),(0,s.Lk)("div",Cu,[(0,s.Lk)("button",{onClick:t[24]||(t[24]=(...e)=>o.toggleBankAccountFilterDropdown&&o.toggleBankAccountFilterDropdown(...e)),class:"multiselect-toggle"},(0,y.v_)(o.selectedBankAccountNames),1),o.showBankAccountFilterDropdown?((0,s.uX)(),(0,s.CE)("div",xu,[(0,s.Lk)("div",Su,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[25]||(t[25]=e=>o.allBankAccountsSelected=e),style:{"margin-right":"0.5rem"}},null,512),[[l.lH,o.allBankAccountsSelected]]),t[44]||(t[44]=(0,s.eW)(" Tất cả ",-1))])]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.allAccounts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"multiselect-item"},[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[26]||(t[26]=e=>o.bankAccountFilter=e),value:e.id,style:{"margin-right":"0.5rem"}},null,8,Eu),[[l.lH,o.bankAccountFilter]]),(0,s.eW)(" "+(0,y.v_)(e.bank_name)+" - "+(0,y.v_)(e.account_number),1)])]))),128))])):(0,s.Q3)("",!0)],512)])])]),(0,s.Lk)("div",Au,[(0,s.bF)(r,{headers:o.headers,items:o.filteredItems,"items-per-page":o.pageSize,page:o.currentPage,class:"elevation-1","fixed-header":"",search:o.filterText},{"item.actions":(0,s.k6)(({item:e})=>[o.isEditable(e.date)?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"c-button",onClick:t=>o.openEditItem(t,{item:e})},[...t[46]||(t[46]=[(0,s.Lk)("i",{class:"fa-solid fa-pen-to-square"},null,-1)])],8,Tu)):(0,s.Q3)("",!0)]),"item.amount":(0,s.k6)(({item:e})=>[(0,s.eW)((0,y.v_)(o.formatPrice(parseInt(e.amount))),1)]),"item.debit_or_credit":(0,s.k6)(({item:e})=>[(0,s.eW)((0,y.v_)("DR"==e.debit_or_credit?"Phiếu Thu":"Phiếu Chi"),1)]),"item.created_at":(0,s.k6)(({item:e})=>[(0,s.eW)((0,y.v_)(o.formatDateTime(e.created_at)),1)]),_:1},8,["headers","items","items-per-page","page","search"])])]),o.showAddEditItem?((0,s.uX)(),(0,s.Wv)(c,{key:0,item:o.selectedItem,accounts:o.allAccounts,"transaction-types":o.subList2,onClose:t[27]||(t[27]=e=>o.showAddEditItem=!1),onSaved:o.onItemSaved},null,8,["item","accounts","transaction-types","onSaved"])):(0,s.Q3)("",!0),o.showAddEditSub?((0,s.uX)(),(0,s.Wv)(u,{key:1,item:o.selectedSubItem,onClose:t[28]||(t[28]=e=>o.showAddEditSub=!1),onSaved:o.onSubItemSaved},null,8,["item","onSaved"])):(0,s.Q3)("",!0),o.showAddEditSub2?((0,s.uX)(),(0,s.Wv)(d,{key:2,item:o.selectedSubItem2,onClose:t[29]||(t[29]=e=>o.showAddEditSub2=!1),onSaved:o.onSubItemSaved2},null,8,["item","onSaved"])):(0,s.Q3)("",!0)])}a(1148);const Du={class:"window-header"},Iu={class:"window-title"},Ku={class:"no-select"},Ru={class:"window-actions no-select"},Vu={class:"window-content"},Nu={class:"form-body"},Xu={class:"tab-pane"},Fu={class:"form-layout"},Uu={class:"col-left"},Ou={class:"form-group"},Wu={class:"form-group"},qu={class:"form-group"},Qu={class:"form-group"},Ju={class:"window-footer"};function Mu(e,t,a,o,n,i){return(0,s.uX)(),(0,s.CE)("div",{class:"modal-overlay",onMousedown:t[8]||(t[8]=(0,l.D$)(t=>e.$emit("close"),["self"]))},[(0,s.Lk)("div",{class:"account-window",onClick:t[7]||(t[7]=(0,l.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",Du,[(0,s.Lk)("span",Iu,[(0,s.Lk)("span",Ku,(0,y.v_)(o.item&&o.item.id?"Chỉnh sửa tài khoản":"Tạo tài khoản mới"),1)]),(0,s.Lk)("div",Ru,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},[...t[9]||(t[9]=[(0,s.Lk)("span",null,"×",-1)])])])]),(0,s.Lk)("div",Vu,[t[14]||(t[14]=(0,s.Lk)("div",{class:"tabs-nav no-select"},[(0,s.Lk)("ul",null,[(0,s.Lk)("li",{class:"active"},[(0,s.Lk)("a",{href:"#"},"Thông tin chung")])])],-1)),(0,s.Lk)("div",Nu,[(0,s.Lk)("div",Xu,[(0,s.Lk)("div",Fu,[(0,s.Lk)("div",Uu,[(0,s.Lk)("div",Ou,[t[10]||(t[10]=(0,s.Lk)("label",{for:"account_number"},"Số tài khoản",-1)),(0,s.bo)((0,s.Lk)("input",{id:"account_number","onUpdate:modelValue":t[1]||(t[1]=e=>o.account_number=e),type:"text",required:""},null,512),[[l.Jo,o.account_number]])]),(0,s.Lk)("div",Wu,[t[11]||(t[11]=(0,s.Lk)("label",{for:"account_holder_name"},"Tên chủ tài khoản",-1)),(0,s.bo)((0,s.Lk)("input",{id:"account_holder_name","onUpdate:modelValue":t[2]||(t[2]=e=>o.account_holder_name=e),type:"text",required:""},null,512),[[l.Jo,o.account_holder_name]])]),(0,s.Lk)("div",qu,[t[12]||(t[12]=(0,s.Lk)("label",{for:"bank_name"},"Ngân hàng",-1)),(0,s.bo)((0,s.Lk)("input",{id:"bank_name","onUpdate:modelValue":t[3]||(t[3]=e=>o.bank_name=e),type:"text",required:""},null,512),[[l.Jo,o.bank_name]])]),(0,s.Lk)("div",Qu,[t[13]||(t[13]=(0,s.Lk)("label",{for:"is_active"},"Kích hoạt",-1)),(0,s.bo)((0,s.Lk)("input",{id:"is_active","onUpdate:modelValue":t[4]||(t[4]=e=>o.is_active=e),type:"checkbox"},null,512),[[l.lH,o.is_active]])])])])])]),(0,s.Lk)("div",Ju,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline",onClick:t[5]||(t[5]=t=>e.$emit("close"))},"Đóng"),(0,s.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[6]||(t[6]=(...e)=>o.handleSubmit&&o.handleSubmit(...e))},(0,y.v_)(o.item&&o.item.id?"Lưu":"Tạo mới"),1)])])])],32)}var $u={name:"AddEditAccounts",props:{item:{type:Object,default:null}},emits:["close","saved"],setup(e,{emit:t}){const{item:a}=(0,be.QW)(e),l=(0,be.KR)(a.value?a.value.account_number:""),o=(0,be.KR)(a.value?a.value.account_holder_name:""),n=(0,be.KR)(a.value?a.value.bank_name:""),i=(0,be.KR)(!a.value||void 0===a.value.is_active||a.value.is_active);async function c(){if(a.value&&a.value.id){const e={id:a.value.id,account_number:l.value,account_holder_name:o.value,bank_name:n.value,is_active:i.value};return void await r.A.put(`/accounts/${a.value.id}/`,e).then(a=>{console.log("Account updated:",a.data),t("saved",e)}).catch(e=>{console.error("Error updating account:",e),window.alert("Lỗi khi cập nhật: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))})}{const e={account_number:l.value,account_holder_name:o.value,bank_name:n.value,is_active:i.value};await r.A.post("/accounts/",e).then(a=>{console.log("Account created:",a.data),t("saved",e)}).catch(e=>{console.error("Error creating account:",e),window.alert("Lỗi khi tạo mới: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))})}}return(0,s.wB)(a,e=>{l.value=e?e.account_number:"",o.value=e?e.account_holder_name:"",n.value=e?e.bank_name:"",i.value=!e||void 0===e.is_active||e.is_active}),{account_number:l,account_holder_name:o,bank_name:n,is_active:i,item:a,handleSubmit:c}}};const Bu=(0,p.A)($u,[["render",Mu],["__scopeId","data-v-733da5f6"]]);var Hu=Bu;const ju={class:"window-header"},Gu={class:"window-title"},zu={class:"no-select"},Yu={class:"window-actions no-select"},Zu={class:"window-content"},ed={class:"form-body"},td={class:"tab-pane"},ad={class:"form-layout"},ld={class:"col-left"},sd={class:"form-group"},od={class:"form-group"},nd={class:"form-group"},id={class:"form-group"},rd={class:"window-footer"};function cd(e,t,a,o,n,i){return(0,s.uX)(),(0,s.CE)("div",{class:"modal-overlay",onMousedown:t[8]||(t[8]=(0,l.D$)(t=>e.$emit("close"),["self"]))},[(0,s.Lk)("div",{class:"transaction-type-window",onClick:t[7]||(t[7]=(0,l.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",ju,[(0,s.Lk)("span",Gu,[(0,s.Lk)("span",zu,(0,y.v_)(o.item&&o.item.id?"Chỉnh sửa loại giao dịch":"Tạo loại giao dịch mới"),1)]),(0,s.Lk)("div",Yu,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},[...t[9]||(t[9]=[(0,s.Lk)("span",null,"×",-1)])])])]),(0,s.Lk)("div",Zu,[t[15]||(t[15]=(0,s.Lk)("div",{class:"tabs-nav no-select"},[(0,s.Lk)("ul",null,[(0,s.Lk)("li",{class:"active"},[(0,s.Lk)("a",{href:"#"},"Thông tin chung")])])],-1)),(0,s.Lk)("div",ed,[(0,s.Lk)("div",td,[(0,s.Lk)("div",ad,[(0,s.Lk)("div",ld,[(0,s.Lk)("div",sd,[t[10]||(t[10]=(0,s.Lk)("label",{for:"name"},"Tên loại",-1)),(0,s.bo)((0,s.Lk)("input",{id:"name","onUpdate:modelValue":t[1]||(t[1]=e=>o.name=e),type:"text",required:""},null,512),[[l.Jo,o.name]])]),(0,s.Lk)("div",od,[t[11]||(t[11]=(0,s.Lk)("label",{for:"description"},"Mô tả",-1)),(0,s.bo)((0,s.Lk)("input",{id:"description","onUpdate:modelValue":t[2]||(t[2]=e=>o.description=e),type:"text"},null,512),[[l.Jo,o.description]])]),(0,s.Lk)("div",nd,[t[13]||(t[13]=(0,s.Lk)("label",{for:"transaction_type"},"Loại (Thu/Chi)",-1)),(0,s.bo)((0,s.Lk)("select",{id:"transaction_type","onUpdate:modelValue":t[3]||(t[3]=e=>o.debit_or_credit=e),required:""},[...t[12]||(t[12]=[(0,s.Lk)("option",{value:"DR"},"Thu",-1),(0,s.Lk)("option",{value:"CR"},"Chi",-1)])],512),[[l.u1,o.debit_or_credit]])]),(0,s.Lk)("div",id,[t[14]||(t[14]=(0,s.Lk)("label",{for:"is_active"},"Kích hoạt",-1)),(0,s.bo)((0,s.Lk)("input",{id:"is_active","onUpdate:modelValue":t[4]||(t[4]=e=>o.is_active=e),type:"checkbox"},null,512),[[l.lH,o.is_active]])])])])])]),(0,s.Lk)("div",rd,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline",onClick:t[5]||(t[5]=t=>e.$emit("close"))},"Đóng"),(0,s.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[6]||(t[6]=(...e)=>o.handleSubmit&&o.handleSubmit(...e))},(0,y.v_)(o.item&&o.item.id?"Lưu":"Tạo mới"),1)])])])],32)}var ud={name:"AddEditTransactionType",props:{item:{type:Object,default:null}},emits:["close","saved"],setup(e,{emit:t}){const{item:a}=(0,be.QW)(e),l=(0,be.KR)(a.value?a.value.name:""),o=(0,be.KR)(a.value?a.value.debit_or_credit:"DR"),n=(0,be.KR)(a.value?a.value.description:""),i=(0,be.KR)(!a.value||void 0===a.value.is_active||a.value.is_active);async function c(){if(a.value&&a.value.id){const e={id:a.value.id,name:l.value,description:n.value,debit_or_credit:o.value,is_active:i.value};return void await r.A.put(`/transactiontypes/${a.value.id}/`,e).then(a=>{console.log("TransactionType updated:",a.data),t("saved",e)}).catch(e=>{console.error("Error updating transaction type:",e),window.alert("Lỗi khi cập nhật loại giao dịch: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))})}{const e={name:l.value,description:n.value,debit_or_credit:o.value,is_active:i.value};await r.A.post("/transactiontypes/",e).then(a=>{console.log("TransactionType created:",a.data),t("saved",e)}).catch(e=>{console.error("Error creating transaction type:",e),window.alert("Lỗi khi tạo loại giao dịch: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))})}}return(0,s.wB)(a,e=>{l.value=e?e.name:"",n.value=e?e.description:"",o.value=e?e.debit_or_credit:"DR",i.value=!e||void 0===e.is_active||e.is_active}),{name:l,description:n,debit_or_credit:o,is_active:i,item:a,handleSubmit:c}}};const dd=(0,p.A)(ud,[["render",cd],["__scopeId","data-v-430418d3"]]);var pd=dd,md={name:"Trans",components:{AddEditTrans:Ts,AddEditAccounts:Hu,AddEditTransactionType:pd},props:{d_edit_days:{type:Number,default:3}},setup(e){const t=(0,n.Pj)(),a=a=>{if(t.getters.userAdmin||t.getters.userSuperadmin)return!0;if(!a)return!1;const l=new Date;l.setHours(0,0,0,0);const s=new Date(a);s.setHours(0,0,0,0);const o=(l.getTime()-s.getTime())/864e5;return o<e.d_edit_days},l=(0,be.KR)(!1),o=(0,be.KR)(null),i=(0,be.KR)(null),c=(0,be.KR)(!1),u=(0,be.KR)([]),d=(0,be.KR)([]),p=(0,be.KR)([]),m=(0,be.KR)(!1),v=(0,be.KR)(null),h=(0,be.KR)([]),k=(0,be.KR)(!1),g=(0,be.KR)(null),b=()=>{k.value=!k.value},f=(0,s.EW)(()=>ae.value&&0!==ae.value.length?X.value.filter(e=>ae.value.includes(e.debit_or_credit)):X.value),L=e=>{if(!e)return"";const t=new Date(e),a=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0");return`${a}/${l}/${s} ${o}:${n}:${i}`},y=(0,s.EW)(()=>{if(!h.value||0===h.value.length)return"Tất cả";if(h.value.length>1)return`${h.value.length} loại đã chọn`;const e=X.value.find(e=>e.id===h.value[0]);return e?e.name:"Chọn loại"}),w=(0,s.EW)({get:()=>{const e=f.value.map(e=>e.id);return e.length>0&&e.every(e=>h.value.includes(e))},set:e=>{const t=f.value.map(e=>e.id);if(e){const e=[...h.value];t.forEach(t=>{e.includes(t)||e.push(t)}),h.value=e}else h.value=h.value.filter(e=>!t.includes(e))}}),_=()=>{m.value=!m.value},C=(0,s.EW)(()=>{if(!p.value||0===p.value.length)return"Tất cả";if(p.value.length===d.value.length)return"Tất cả";if(p.value.length>1)return`${p.value.length} tài khoản đã chọn`;const e=d.value.find(e=>e.id===p.value[0]);return e?`${e.bank_name} - ${e.account_number}`:"Chọn tài khoản"}),x=(0,s.EW)({get:()=>d.value.length>0&&p.value.length===d.value.length,set:e=>{p.value=e?d.value.map(e=>e.id):[]}}),S=(0,be.KR)({top:"0px",left:"0px",width:"0px"}),E=async()=>{try{const e=await r.A.get("/accounts/");d.value=e.data.filter(e=>e.is_active),u.value=e.data.filter(e=>e.is_active&&!e.bank_name.toLowerCase().includes("cash"))}catch(e){console.error("Error fetching sub list:",e)}},A=()=>{l.value=!l.value,l.value&&setTimeout(()=>{T()},0)},T=()=>{(0,s.dY)(()=>{const e=document.querySelector(".create-new-btn-group");if(e){const t=e.getBoundingClientRect();S.value={top:`${t.bottom+window.scrollY}px`,left:`${t.left+window.scrollX}px`,width:`${t.width}px`}}})},P=e=>{console.log("Open Add/Edit Sub Item:",e),i.value=e?{...e}:{},c.value=!0,l.value=!1},D=e=>{if(l.value){const t=o.value;t&&!t.contains(e.target)&&(l.value=!1)}m.value&&v.value&&!v.value.contains(e.target)&&(m.value=!1),k.value&&g.value&&!g.value.contains(e.target)&&(k.value=!1)},I=async()=>{console.log("Sub Item saved, refreshing sub list..."),await E(),c.value=!1},K=(0,be.KR)(!1),R=(0,be.KR)(null),V=(0,be.KR)(null),N=(0,be.KR)(!1),X=(0,be.KR)([]),F=e=>new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().slice(0,10),U=(0,be.KR)(F(new Date(Date.now()-2592e6))),O=(0,be.KR)(F(new Date)),W=(0,be.KR)({top:"0px",left:"0px",width:"0px"}),q=async()=>{try{const e=await r.A.get("/transactiontypes/");X.value=e.data}catch(e){console.error("Error fetching sub list:",e)}},Q=()=>{K.value=!K.value,K.value&&setTimeout(()=>{J()},0)},J=()=>{(0,s.dY)(()=>{const e=document.querySelector(".create-new-btn-group-2");if(e){const t=e.getBoundingClientRect();W.value={top:`${t.bottom+window.scrollY}px`,left:`${t.left+window.scrollX}px`,width:`${t.width}px`}}})},M=e=>{console.log("Open Add/Edit Sub Item:",e),V.value=e?{...e}:{},N.value=!0,K.value=!1},$=e=>{if(K.value){const t=R.value;t&&!t.contains(e.target)&&(K.value=!1)}},B=async()=>{console.log("Sub Item saved, refreshing sub list..."),await q(),N.value=!1},H=(0,be.KR)([]),j=(0,be.KR)(""),G=(0,be.KR)(1),z=(0,be.KR)(50),Y=(0,be.KR)(!1),Z=(0,be.KR)({}),ee=[{title:"",key:"actions",sortable:!1,headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Thu/Chi",key:"debit_or_credit",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Mã",key:"id",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Nội Dung",key:"description",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Loại",key:"transaction_type_name",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Số Tiền",key:"amount",align:"end",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-right"}},{title:"Ngày Hiệu Lực",key:"date",align:"end",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-right"}},{title:"Trạng Thái",key:"is_active",align:"end",headerProps:{class:"my-custom-header-class pr-3"},cellProps:{class:"text-right pr-3"}},{title:"Tài Khoản",key:"bank_account_name",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Ngày Tạo",key:"created_at",headerProps:{class:"my-custom-header-class pr-3"},align:"end",cellProps:{class:"text-right pr-3"}}],te=(0,be.KR)([!0]),ae=(0,be.KR)([]),le=(0,s.EW)(()=>{let e=H.value;if(te.value&&te.value.length>0&&(e=e.filter(e=>te.value.includes(e.is_active))),ae.value&&ae.value.length>0&&(e=e.filter(e=>ae.value.includes(e.debit_or_credit))),h.value&&h.value.length>0&&(e=e.filter(e=>h.value.includes(e.transaction_type))),p.value&&p.value.length>0&&(e=e.filter(e=>p.value.includes(e.account))),!j.value.trim())return e;const t=j.value.toLowerCase();return e.filter(e=>e.description&&e.description.toLowerCase().includes(t))}),se=async()=>{try{const e={};U.value&&(e.dateFrom=U.value),O.value&&(e.dateTo=O.value);const t=await r.A.get("/transactions/",{params:e});H.value=t.data.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at))}catch(e){console.error("Error fetching items:",e)}},oe=e=>"number"!==typeof e?e:e.toLocaleString("en-US");async function ne(){try{const e={export:"true",dateFrom:U.value,dateTo:O.value},t=await r.A.get("/transactions/",{params:e,responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),l=document.createElement("a");l.href=a;const s=`transactions_${U.value}_to_${O.value}.xlsx`;l.setAttribute("download",s),document.body.appendChild(l),l.click(),l.remove()}catch(e){console.error("Error exporting to Excel:",e)}}function ie(){Z.value={},Y.value=!0}function re(e,{item:t}){console.log("Clicked item:",t),Z.value={...t},Y.value=!0}function ce(e){Z.value={debit_or_credit:e},Y.value=!0}async function ue(){console.log("Item saved, refreshing list..."),await se(),Y.value=!1}return(0,s.wB)([U,O],se),(0,s.sV)(()=>{se(),E(),q(),document.addEventListener("mousedown",D),document.addEventListener("mousedown",$)}),(0,s.xo)(()=>{document.removeEventListener("mousedown",D),document.removeEventListener("mousedown",$)}),{items:H,filterText:j,currentPage:G,pageSize:z,showAddEditItem:Y,selectedItem:Z,headers:ee,filteredItems:le,isActiveFilter:te,debitCreditFilter:ae,formatPrice:oe,exportToExcel:ne,openAddItem:ie,openEditItem:re,createNewItem:ce,onItemSaved:ue,formatDateTime:L,showSubList:l,subList:u,subListPosition:S,toggleSubList:A,fetchSubList:E,showAddEditSub:c,selectedSubItem:i,openAddEditSub:P,subListRef:o,onSubItemSaved:I,allAccounts:d,showSubList2:K,subList2:X,subListPosition2:W,toggleSubList2:Q,fetchSubList2:q,showAddEditSub2:N,selectedSubItem2:V,openAddEditSub2:M,subListRef2:R,onSubItemSaved2:B,dateFrom:U,dateTo:O,bankAccountFilter:p,showBankAccountFilterDropdown:m,bankAccountFilterDropdownRef:v,toggleBankAccountFilterDropdown:_,selectedBankAccountNames:C,allBankAccountsSelected:x,transactionTypeFilter:h,showTransactionTypeFilterDropdown:k,transactionTypeFilterDropdownRef:g,toggleTransactionTypeFilterDropdown:b,filteredTransactionTypesForFilter:f,selectedTransactionTypeNames:y,allTransactionTypesSelected:w,store:t,isEditable:a}}};const vd=(0,p.A)(md,[["render",Pu],["__scopeId","data-v-1867ba3e"]]);var hd=vd;const kd={class:"work-area"},gd={class:"top-area"},bd={class:"action-area"},fd={class:"page-actions"},Ld={class:"datatable-toolbar"},yd=["value"],wd={class:"other-actions"},_d={class:"buttons-area"},Cd={class:"list-product-groups btn-group",style:{position:"relative"}},xd={style:{margin:"0",padding:"0","list-style":"none"}},Sd={style:{"text-align":"right","margin-top":"0.5rem"}},Ed={class:"bottom-area"},Ad={class:"filter-area"},Td={class:"filters"},Pd={class:"form-group"},Dd={class:"checkbox-group"},Id={class:"data-area"},Kd=["onClick"];function Rd(e,t,a,o,n,i){const r=(0,s.g2)("v-data-table"),c=(0,s.g2)("AddEditUsers");return(0,s.uX)(),(0,s.CE)("div",kd,[(0,s.Lk)("div",gd,[t[11]||(t[11]=(0,s.Lk)("div",{class:"page-name-area"},"Người dùng",-1)),(0,s.Lk)("div",bd,[(0,s.Lk)("div",fd,[(0,s.Lk)("div",Ld,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.filterText=e),placeholder:"Tìm kiếm...",class:"search-input",style:{"margin-right":"1rem"}},null,512),[[l.Jo,o.filterText]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.pageSize=e),class:"page-size-select"},[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)([5,10,20,50,100,200],e=>(0,s.Lk)("option",{key:e,value:e},(0,y.v_)(e)+" rows",9,yd)),64))],512),[[l.u1,o.pageSize]])])]),(0,s.Lk)("div",wd,[(0,s.Lk)("div",_d,[(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>o.createNewItem&&o.createNewItem(...e)),class:"btn btn-primary"}," Tạo mới "),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>o.toggleSubList&&o.toggleSubList(...e)),class:"btn btn-outline create-new-btn-group"}," Nhóm Users "),(0,s.Lk)("div",Cd,[((0,s.uX)(),(0,s.Wv)(s.Im,{to:"body"},[o.showSubList?((0,s.uX)(),(0,s.CE)("div",{key:0,ref:"subListRef",class:"product-group-teleport",onClick:t[5]||(t[5]=(0,l.D$)(e=>o.showSubList=!1,["self"])),style:(0,y.Tr)({position:"fixed",maxHeight:"50vh",overflow:"auto",top:o.subListPosition.top,left:o.subListPosition.left,zIndex:9999,background:"white",border:"1px solid #ccc",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",padding:"1rem",minWidth:o.subListPosition.width})},[(0,s.Lk)("ul",xd,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.subList,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.id,style:{padding:"0.5rem 0","border-bottom":"1px solid #eee"}},[(0,s.Lk)("span",null,(0,y.v_)(e.name),1)]))),128))]),(0,s.Lk)("div",Sd,[(0,s.Lk)("button",{onClick:t[4]||(t[4]=e=>o.showSubList=!1),style:{padding:"0.3rem 1rem"}},"Đóng")])],4)):(0,s.Q3)("",!0)]))]),(0,s.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>o.exportToCSV&&o.exportToCSV(...e)),class:"btn btn-secondary"},[...t[10]||(t[10]=[(0,s.Lk)("i",{class:"fa-solid fa-file-excel",style:{"margin-right":"0.5rem"}},null,-1),(0,s.eW)(" Export CSV ",-1)])])])])])]),(0,s.Lk)("div",Ed,[(0,s.Lk)("div",Ad,[(0,s.Lk)("div",Td,[(0,s.Lk)("div",Pd,[t[14]||(t[14]=(0,s.Lk)("label",null,"Trạng thái",-1)),(0,s.Lk)("div",Dd,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>o.isActiveFilter=e),value:!0},null,512),[[l.lH,o.isActiveFilter]]),t[12]||(t[12]=(0,s.eW)(" Kích hoạt",-1))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>o.isActiveFilter=e),value:!1},null,512),[[l.lH,o.isActiveFilter]]),t[13]||(t[13]=(0,s.eW)(" Không kích hoạt",-1))])])])])]),(0,s.Lk)("div",Id,[(0,s.bF)(r,{headers:o.headers,items:o.filteredItems,"items-per-page":o.pageSize,page:o.currentPage,class:"elevation-1","fixed-header":"",search:o.filterText},{"item.actions":(0,s.k6)(({item:e})=>[(0,s.Lk)("button",{class:"c-button",onClick:t=>o.openEditItem(t,{item:e})},[...t[15]||(t[15]=[(0,s.Lk)("i",{class:"fa-solid fa-pen-to-square"},null,-1)])],8,Kd)]),"item.price":(0,s.k6)(({item:e})=>[(0,s.eW)((0,y.v_)(o.formatPrice(e.price)),1)]),_:1},8,["headers","items","items-per-page","page","search"])])]),o.showAddEditItem?((0,s.uX)(),(0,s.Wv)(c,{key:0,item:o.selectedItem,"user-groups":o.subList,onClose:t[9]||(t[9]=e=>o.showAddEditItem=!1),onSaved:o.onItemSaved},null,8,["item","user-groups","onSaved"])):(0,s.Q3)("",!0)])}const Vd={class:"window-header"},Nd={class:"window-title"},Xd={class:"no-select"},Fd={class:"window-actions no-select"},Ud={class:"window-content"},Od={class:"form-body"},Wd={class:"tab-pane"},qd={class:"form-layout"},Qd={class:"col-left"},Jd={class:"form-group"},Md=["disabled"],$d={class:"form-group"},Bd={for:"password"},Hd={key:0,class:"required"},jd=["required"],Gd={key:0,class:"field-note"},zd={class:"form-group"},Yd={class:"form-group"},Zd={class:"form-group"},ep={class:"col-right"},tp={class:"form-group-column"},ap={class:"checkbox-container"},lp=["for"],sp=["id","value"],op={key:0,class:"empty-text"},np={class:"form-group",style:{"margin-top":"1rem"}},ip={class:"window-footer"};function rp(e,t,a,o,n,i){return(0,s.uX)(),(0,s.CE)("div",{class:"modal-overlay",onMousedown:t[11]||(t[11]=(0,l.D$)(t=>e.$emit("close"),["self"]))},[(0,s.Lk)("div",{class:"user-window",onClick:t[10]||(t[10]=(0,l.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",Vd,[(0,s.Lk)("span",Nd,[(0,s.Lk)("span",Xd,(0,y.v_)(o.item&&o.item.id?"Cập nhật người dùng":"Thêm người dùng mới"),1)]),(0,s.Lk)("div",Fd,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},[...t[12]||(t[12]=[(0,s.Lk)("span",null,"×",-1)])])])]),(0,s.Lk)("div",Ud,[t[20]||(t[20]=(0,s.Lk)("div",{class:"tabs-nav no-select"},[(0,s.Lk)("ul",null,[(0,s.Lk)("li",{class:"active"},[(0,s.Lk)("a",{href:"#"},"Thông tin chung")])])],-1)),(0,s.Lk)("div",Od,[(0,s.Lk)("div",Wd,[(0,s.Lk)("div",qd,[(0,s.Lk)("div",Qd,[(0,s.Lk)("div",Jd,[t[13]||(t[13]=(0,s.Lk)("label",{for:"username"},[(0,s.eW)("Tên đăng nhập "),(0,s.Lk)("span",{class:"required"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{id:"username","onUpdate:modelValue":t[1]||(t[1]=e=>o.form.username=e),type:"text",required:"",disabled:!!o.item.id,placeholder:"Ví dụ: admin"},null,8,Md),[[l.Jo,o.form.username]])]),(0,s.Lk)("div",$d,[(0,s.Lk)("label",Bd,[t[14]||(t[14]=(0,s.eW)("Mật khẩu ",-1)),o.item.id?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",Hd,"*"))]),(0,s.bo)((0,s.Lk)("input",{id:"password","onUpdate:modelValue":t[2]||(t[2]=e=>o.form.password=e),type:"password",required:!o.item.id,placeholder:"Nhập mật khẩu",autocomplete:"new-password"},null,8,jd),[[l.Jo,o.form.password]]),o.item.id?((0,s.uX)(),(0,s.CE)("small",Gd,"Để trống nếu không muốn đổi mật khẩu")):(0,s.Q3)("",!0)]),(0,s.Lk)("div",zd,[t[15]||(t[15]=(0,s.Lk)("label",{for:"lastName"},"Họ",-1)),(0,s.bo)((0,s.Lk)("input",{id:"lastName","onUpdate:modelValue":t[3]||(t[3]=e=>o.form.last_name=e),type:"text",placeholder:"Họ"},null,512),[[l.Jo,o.form.last_name]])]),(0,s.Lk)("div",Yd,[t[16]||(t[16]=(0,s.Lk)("label",{for:"firstName"},"Tên",-1)),(0,s.bo)((0,s.Lk)("input",{id:"firstName","onUpdate:modelValue":t[4]||(t[4]=e=>o.form.first_name=e),type:"text",placeholder:"Tên"},null,512),[[l.Jo,o.form.first_name]])]),(0,s.Lk)("div",Zd,[t[17]||(t[17]=(0,s.Lk)("label",{for:"email"},"Email",-1)),(0,s.bo)((0,s.Lk)("input",{id:"email","onUpdate:modelValue":t[5]||(t[5]=e=>o.form.email=e),type:"email",placeholder:"Email"},null,512),[[l.Jo,o.form.email]])])]),(0,s.Lk)("div",ep,[(0,s.Lk)("div",tp,[t[18]||(t[18]=(0,s.Lk)("label",null,"Nhóm quyền",-1)),(0,s.Lk)("div",ap,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.userGroups,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"checkbox-item"},[(0,s.Lk)("label",{for:"group-"+e.id,class:"checkbox-label"},[(0,s.bo)((0,s.Lk)("input",{type:"checkbox",id:"group-"+e.id,value:e.id,"onUpdate:modelValue":t[6]||(t[6]=e=>o.form.groups=e)},null,8,sp),[[l.lH,o.form.groups]]),(0,s.eW)(" "+(0,y.v_)(e.name),1)],8,lp)]))),128)),0===a.userGroups.length?((0,s.uX)(),(0,s.CE)("div",op,"Chưa có nhóm nào.")):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",np,[t[19]||(t[19]=(0,s.Lk)("label",{for:"is_active"},"Kích hoạt",-1)),(0,s.bo)((0,s.Lk)("input",{id:"is_active",type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>o.form.is_active=e)},null,512),[[l.lH,o.form.is_active]])])])])])]),(0,s.Lk)("div",ip,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline",onClick:t[8]||(t[8]=t=>e.$emit("close"))},"Đóng"),(0,s.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[9]||(t[9]=(...e)=>o.handleSubmit&&o.handleSubmit(...e))},(0,y.v_)(o.item&&o.item.id?"Lưu":"Tạo mới"),1)])])])],32)}var cp={name:"AddEditUser",props:{item:{type:Object,default:null},userGroups:{type:Array,default:()=>[]}},emits:["close","saved"],setup(e,{emit:t}){const{item:a}=(0,be.QW)(e),l=(0,be.Kh)({username:"",first_name:"",last_name:"",email:"",password:"",groups:[],is_active:!0}),o=e=>{e?(l.username=e.username||"",l.first_name=e.first_name||"",l.last_name=e.last_name||"",l.email=e.email||"",l.groups=e.groups||[],l.is_active=void 0===e.is_active||e.is_active,l.password=""):(l.username="",l.first_name="",l.last_name="",l.email="",l.groups=[],l.is_active=!0,l.password="")};async function n(){const e={username:l.username,first_name:l.first_name,last_name:l.last_name,email:l.email,groups:l.groups,is_active:l.is_active};l.password&&(e.password=l.password);try{if(a.value&&a.value.id){const l=await r.A.put(`/users/${a.value.id}/`,e);console.log("User updated:",l.data),t("saved",l.data)}else{const a=await r.A.post("/users/",e);console.log("User created:",a.data),t("saved",a.data)}}catch(s){console.error("Error saving user:",s.response?s.response.data:s),window.alert("Lỗi khi lưu người dùng: "+(s.response&&s.response.data?JSON.stringify(s.response.data):s.message))}}return(0,s.wB)(a,e=>{o(e)}),(0,s.sV)(()=>{o(a.value)}),{form:l,item:a,handleSubmit:n}}};const up=(0,p.A)(cp,[["render",rp],["__scopeId","data-v-446b76e7"]]);var dp=up,pp={name:"Trans",components:{AddEditUsers:dp},setup(){const e=(0,be.KR)(!1),t=(0,be.KR)(null),a=(0,be.KR)(null),l=(0,be.KR)(!1),o=(0,be.KR)([]),n=(0,be.KR)({top:"0px",left:"0px",width:"0px"}),i=async()=>{try{const e=await r.A.get("/usergroups/");o.value=e.data,console.log("Fetched sub list:",o.value)}catch(e){console.error("Error fetching sub list:",e)}},c=()=>{e.value=!e.value,e.value&&setTimeout(()=>{u()},0)},u=()=>{(0,s.dY)(()=>{const e=document.querySelector(".create-new-btn-group");if(e){const t=e.getBoundingClientRect();n.value={top:`${t.bottom+window.scrollY}px`,left:`${t.left+window.scrollX}px`,width:`${t.width}px`}}})},d=t=>{console.log("Open Add/Edit Sub Item:",t),a.value=t?{...t}:{},l.value=!0,e.value=!1},p=a=>{if(e.value){const l=t.value;l&&!l.contains(a.target)&&(e.value=!1)}},m=async()=>{console.log("Sub Item saved, refreshing sub list..."),await i(),l.value=!1},v=(0,be.KR)([]),h=(0,be.KR)(""),k=(0,be.KR)(1),g=(0,be.KR)(50),b=(0,be.KR)(!1),f=(0,be.KR)({}),L=[{title:"",key:"actions",sortable:!1,headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"id",key:"id",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"userName",key:"username",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Tên",key:"first_name",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Họ",key:"last_name",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Nhóm",key:"usergroups",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Kích hoạt",key:"is_active",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}}],y=(0,be.KR)([!0]),w=(0,s.EW)(()=>{let e=v.value;if(y.value&&y.value.length>0&&(e=e.filter(e=>y.value.includes(e.is_active))),!h.value.trim())return e;const t=h.value.toLowerCase();return e.filter(e=>e.name&&e.name.toLowerCase().includes(t))}),_=async()=>{try{const e=await r.A.get("/users/");v.value=e.data.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at))}catch(e){console.error("Error fetching items:",e)}},C=e=>"number"!==typeof e?e:e.toLocaleString("en-US");function x(){const e=[];e.push(L.map(e=>e.title).join(",")),w.value.forEach(t=>{e.push(L.map(e=>{let a=t[e.key];return"price"===e.key&&(a=C(a)),'"'+(void 0!==a?String(a).replace(/"/g,'""'):"")+'"'}).join(","))});const t=e.join("\n"),a=new Blob([t],{type:"text/csv"}),l=window.URL.createObjectURL(a),s=document.createElement("a");s.href=l,s.download="data.csv",s.click(),window.URL.revokeObjectURL(l)}function S(){f.value={},b.value=!0}function E(e,{item:t}){console.log("Clicked item:",t),f.value={...t},b.value=!0}function A(){f.value={},b.value=!0}async function T(){console.log("Item saved, refreshing list..."),await _(),b.value=!1}return(0,s.sV)(()=>{_(),i(),document.addEventListener("mousedown",p)}),(0,s.xo)(()=>{document.removeEventListener("mousedown",p)}),{items:v,filterText:h,currentPage:k,pageSize:g,showAddEditItem:b,selectedItem:f,headers:L,filteredItems:w,isActiveFilter:y,formatPrice:C,exportToCSV:x,openAddItem:S,openEditItem:E,createNewItem:A,onItemSaved:T,showSubList:e,subList:o,subListPosition:n,toggleSubList:c,fetchSubList:i,showAddEditSub:l,selectedSubItem:a,openAddEditSub:d,subListRef:t,onSubItemSaved:m}}};const mp=(0,p.A)(pp,[["render",Rd],["__scopeId","data-v-3cc1bf21"]]);var vp=mp;const hp={class:"work-area"},kp={class:"top-area"},gp={class:"action-area"},bp={class:"page-actions"},fp={class:"datatable-toolbar"},Lp=["value"],yp={class:"other-actions"},wp={class:"buttons-area"},_p={class:"bottom-area"},Cp={class:"filter-area"},xp={class:"filters"},Sp={class:"form-group"},Ep={class:"form-group"},Ap={class:"form-group"},Tp={class:"checkbox-group"},Pp={class:"data-area"},Dp=["onClick"];function Ip(e,t,a,o,n,i){const r=(0,s.g2)("v-data-table"),c=(0,s.g2)("AddEditPurchase");return(0,s.uX)(),(0,s.CE)("div",hp,[(0,s.Lk)("div",kp,[t[12]||(t[12]=(0,s.Lk)("div",{class:"page-name-area"},"Nhập hàng",-1)),(0,s.Lk)("div",gp,[(0,s.Lk)("div",bp,[(0,s.Lk)("div",fp,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.filterText=e),placeholder:"Tìm kiếm...",class:"search-input",style:{"margin-right":"1rem"}},null,512),[[l.Jo,o.filterText]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.pageSize=e),class:"page-size-select"},[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)([5,10,20,50,100,200],e=>(0,s.Lk)("option",{key:e,value:e},(0,y.v_)(e)+" rows",9,Lp)),64))],512),[[l.u1,o.pageSize]])])]),(0,s.Lk)("div",yp,[(0,s.Lk)("div",wp,[(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>o.createNewItem&&o.createNewItem(...e)),class:"btn btn-primary"}," Tạo mới "),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>o.exportToCSV&&o.exportToCSV(...e)),class:"btn btn-secondary"},[...t[11]||(t[11]=[(0,s.Lk)("i",{class:"fa-solid fa-file-excel",style:{"margin-right":"0.5rem"}},null,-1),(0,s.eW)(" Export CSV ",-1)])])])])])]),(0,s.Lk)("div",_p,[(0,s.Lk)("div",Cp,[(0,s.Lk)("div",xp,[(0,s.Lk)("div",Sp,[t[13]||(t[13]=(0,s.Lk)("label",null,"Từ ngày",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=e=>o.dateFrom=e),onClick:t[5]||(t[5]=e=>e.target.showPicker())},null,512),[[l.Jo,o.dateFrom]])]),(0,s.Lk)("div",Ep,[t[14]||(t[14]=(0,s.Lk)("label",null,"Đến ngày",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[6]||(t[6]=e=>o.dateTo=e),onClick:t[7]||(t[7]=e=>e.target.showPicker())},null,512),[[l.Jo,o.dateTo]])]),(0,s.Lk)("div",Ap,[t[17]||(t[17]=(0,s.Lk)("label",null,"Trạng thái",-1)),(0,s.Lk)("div",Tp,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>o.isActiveFilter=e),value:!0},null,512),[[l.lH,o.isActiveFilter]]),t[15]||(t[15]=(0,s.eW)(" Kích hoạt",-1))]),(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=e=>o.isActiveFilter=e),value:!1},null,512),[[l.lH,o.isActiveFilter]]),t[16]||(t[16]=(0,s.eW)(" Không kích hoạt",-1))])])])])]),(0,s.Lk)("div",Pp,[(0,s.bF)(r,{headers:o.headers,items:o.filteredItems,"items-per-page":o.pageSize,page:o.currentPage,class:"elevation-1","fixed-header":"",search:o.filterText},{"item.actions":(0,s.k6)(({item:e})=>[o.isEditable(e.date)?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"c-button",onClick:t=>o.openEditItem(t,{item:e})},[...t[18]||(t[18]=[(0,s.Lk)("i",{class:"fa-solid fa-pen-to-square"},null,-1)])],8,Dp)):(0,s.Q3)("",!0)]),"item.total_quantity":(0,s.k6)(({item:e})=>[(0,s.eW)((0,y.v_)(e.total_quantity),1)]),"item.date":(0,s.k6)(({item:e})=>[(0,s.eW)((0,y.v_)(o.formatDate(e.date)),1)]),_:1},8,["headers","items","items-per-page","page","search"])])]),o.showAddEditItem?((0,s.uX)(),(0,s.Wv)(c,{key:0,item:o.selectedItem,d_edit_days:a.d_edit_days,onClose:t[10]||(t[10]=e=>o.showAddEditItem=!1),onSaved:o.onItemSaved},null,8,["item","d_edit_days","onSaved"])):(0,s.Q3)("",!0)])}const Kp={class:"window-header"},Rp={class:"window-title"},Vp={class:"no-select"},Np={class:"window-actions no-select"},Xp={class:"window-content"},Fp={class:"form-body"},Up={class:"tab-pane"},Op={class:"form-layout",style:{display:"flex","flex-direction":"column",height:"100%"}},Wp={class:"row-general",style:{display:"flex",gap:"1rem","margin-bottom":"0.5rem"}},qp={class:"form-group",style:{flex:"1"}},Qp=["value"],Jp={class:"form-group",style:{flex:"1"}},Mp=["min","max","disabled"],$p={class:"form-group",style:{"flex-direction":"row","align-items":"center"}},Bp=["disabled"],Hp={class:"row-search",style:{display:"flex",gap:"1rem","align-items":"flex-start","margin-bottom":"0.5rem"}},jp={style:{position:"relative",flex:"1"}},Gp={key:0,class:"search-dropdown"},zp=["onClick"],Yp={class:"item-name"},Zp={class:"item-code"},em={class:"import-excel-wrapper"},tm={class:"row-items"},am={class:"div-table"},lm={class:"div-table-header"},sm={class:"div-cell col-action"},om={class:"div-table-body"},nm={class:"div-cell col-code"},im={class:"div-cell col-name"},rm={class:"div-cell col-qty"},cm=["onUpdate:modelValue","onChange"],um={class:"div-cell col-action"},dm=["onClick"],pm={class:"window-footer"};function mm(e,t,a,o,n,i){return(0,s.uX)(),(0,s.CE)("div",{class:"modal-overlay",onMousedown:t[15]||(t[15]=(0,l.D$)(t=>e.$emit("close"),["self"]))},[(0,s.Lk)("div",{class:"purchase-window",onClick:t[14]||(t[14]=(0,l.D$)(()=>{},["stop"])),style:{width:"70rem","max-width":"95vw"}},[(0,s.Lk)("div",Kp,[(0,s.Lk)("span",Rp,[(0,s.Lk)("span",Vp,(0,y.v_)(o.item&&o.item.id?"Chỉnh sửa đơn nhập hàng: "+o.item.code:"Tạo đơn nhập hàng mới"),1)]),(0,s.Lk)("div",Np,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},[...t[16]||(t[16]=[(0,s.Lk)("span",null,"×",-1)])])])]),(0,s.Lk)("div",Xp,[t[24]||(t[24]=(0,s.Lk)("div",{class:"tabs-nav no-select"},[(0,s.Lk)("ul",null,[(0,s.Lk)("li",{class:"active"},[(0,s.Lk)("a",{href:"#"},"Thông tin chung")])])],-1)),(0,s.Lk)("div",Fp,[(0,s.Lk)("div",Up,[(0,s.Lk)("div",Op,[(0,s.Lk)("div",Wp,[(0,s.Lk)("div",qp,[t[17]||(t[17]=(0,s.Lk)("label",{for:"supplier"},"Nhà cung cấp",-1)),(0,s.bo)((0,s.Lk)("select",{id:"supplier","onUpdate:modelValue":t[1]||(t[1]=e=>o.supplier=e),required:""},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.suppliers,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,y.v_)(e.name),9,Qp))),128))],512),[[l.u1,o.supplier]])]),(0,s.Lk)("div",Jp,[t[18]||(t[18]=(0,s.Lk)("label",{for:"date"},"Ngày nhập",-1)),(0,s.bo)((0,s.Lk)("input",{id:"date",ref:"dateInput","onUpdate:modelValue":t[2]||(t[2]=e=>o.date=e),type:"date",required:"",onClick:t[3]||(t[3]=(...e)=>o.openDatePicker&&o.openDatePicker(...e)),min:o.minDate,max:o.maxDate,disabled:o.isDateOutsideAllowedRange},null,8,Mp),[[l.Jo,o.date]])]),(0,s.Lk)("div",$p,[t[19]||(t[19]=(0,s.Lk)("label",{for:"is_active",style:{width:"auto","margin-right":"0.5rem"}},"Kích hoạt",-1)),(0,s.bo)((0,s.Lk)("input",{id:"is_active","onUpdate:modelValue":t[4]||(t[4]=e=>o.isActive=e),type:"checkbox",disabled:!o.isActive||!o.store.getters.userAdmin&&!o.store.getters.userSuperadmin},null,8,Bp),[[l.lH,o.isActive]])])]),(0,s.Lk)("div",Hp,[(0,s.Lk)("div",jp,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>o.productSearchTerm=e),placeholder:"Tìm hàng hóa theo mã hoặc tên",class:"product-search-input",onFocus:t[6]||(t[6]=e=>o.showProductDropdown=!0),onBlur:t[7]||(t[7]=(...e)=>o.hideDropdown&&o.hideDropdown(...e))},null,544),[[l.Jo,o.productSearchTerm]]),o.showProductDropdown&&o.filteredProducts.length>0?((0,s.uX)(),(0,s.CE)("div",Gp,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredProducts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"search-item",onClick:t=>o.addProduct(e)},[(0,s.Lk)("div",Yp,(0,y.v_)(e.name),1),(0,s.Lk)("div",Zp,(0,y.v_)(e.code),1)],8,zp))),128))])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",em,[(0,s.Lk)("button",{class:"btn btn-outline",onClick:t[8]||(t[8]=(...e)=>o.downloadTemplate&&o.downloadTemplate(...e)),title:"Download Template",style:{"margin-right":"1rem"}}," Tải template Excel "),!o.showImportButton||o.item&&o.item.id?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:0,class:"btn btn-outline",onClick:t[9]||(t[9]=(...e)=>o.triggerImport&&o.triggerImport(...e)),title:"Import Excel"}," Nhập từ Excel ")),(0,s.Lk)("input",{type:"file",ref:"fileInput",style:{display:"none"},onChange:t[10]||(t[10]=(...e)=>o.handleFileUpload&&o.handleFileUpload(...e)),accept:".xlsx, .xls"},null,544)])]),t[23]||(t[23]=(0,s.Lk)("div",{class:"row-search",style:{display:"flex",gap:"1rem","justify-content":"space-between"}},null,-1)),(0,s.Lk)("div",tm,[(0,s.Lk)("div",am,[(0,s.Lk)("div",lm,[t[20]||(t[20]=(0,s.Lk)("div",{class:"div-cell col-code"},"Mã hàng",-1)),t[21]||(t[21]=(0,s.Lk)("div",{class:"div-cell col-name"},"Tên hàng",-1)),t[22]||(t[22]=(0,s.Lk)("div",{class:"div-cell col-qty"},"Số lượng",-1)),(0,s.Lk)("div",sm,(0,y.v_)(o.totalQuantity),1)]),(0,s.Lk)("div",om,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.items,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"div-table-row"},[(0,s.Lk)("div",nm,(0,y.v_)(e.code),1),(0,s.Lk)("div",im,(0,y.v_)(e.name),1),(0,s.Lk)("div",rm,[(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.quantity=t,class:"qty-input",min:"1",onFocus:t[11]||(t[11]=(...e)=>o.selectAll&&o.selectAll(...e)),onChange:t=>o.handleQuantityChange(e)},null,40,cm),[[l.Jo,e.quantity,void 0,{number:!0}]])]),(0,s.Lk)("div",um,[(0,s.Lk)("button",{onClick:e=>o.removeItem(a),class:"btn-remove"},"×",8,dm)])]))),128))])])])])])]),(0,s.Lk)("div",pm,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline",onClick:t[12]||(t[12]=t=>e.$emit("close"))},"Đóng"),(0,s.Lk)("button",{type:"button",class:"btn btn-primary",onClick:t[13]||(t[13]=(...e)=>o.handleSubmit&&o.handleSubmit(...e))},(0,y.v_)(o.item&&o.item.id?"Lưu":"Tạo mới"),1)])])])],32)}a(6573),a(8100),a(7936),a(9577),a(1549),a(9797),a(9631),a(5623);var vm=a(3230),hm={name:"AddEditPurchase",props:{item:{type:Object,default:null},d_edit_days:{type:Number,default:3}},emits:["close","saved"],setup(e,{emit:t}){const a=e=>{const t=6e4*e.getTimezoneOffset(),a=new Date(e-t).toISOString().slice(0,10);return a},l=(0,n.Pj)(),o=(0,s.EW)(()=>a(new Date)),i=(0,s.EW)(()=>{if(l.getters.userAdmin||l.getters.userSuperadmin)return"";const t=new Date,s=new Date;return s.setDate(t.getDate()-(e.d_edit_days||3)),a(s)}),c=(0,s.EW)(()=>{if(l.getters.userAdmin||l.getters.userSuperadmin)return!1;const e=new Date(h.value),t=i.value?new Date(i.value):null,a=o.value?new Date(o.value):null;return!!(t&&e<t)||a&&e>a}),{item:u}=(0,be.QW)(e),d=(0,be.KR)(null),p=(0,be.KR)(null),m=(0,be.KR)(u.value?u.value.code:""),v=(0,be.KR)(u.value&&u.value.supplier?u.value.supplier:"Sản xuất"),h=(0,be.KR)(u.value&&u.value.date?u.value.date:(new Date).toISOString().slice(0,10)),k=(0,be.KR)(!u.value||void 0===u.value.is_active||u.value.is_active),g=(0,be.KR)(u.value&&u.value.items?JSON.parse(JSON.stringify(u.value.items)):[]),b=(0,be.KR)([]),f=(0,be.KR)([]),L=(0,be.KR)(""),y=(0,be.KR)(!1),w=(0,be.KR)(!0),_=(0,s.EW)(()=>g.value.reduce((e,t)=>e+(Number(t.quantity)||0),0));(0,s.wB)(u,e=>{m.value=e?e.code:"",v.value=e&&e.supplier?e.supplier:"Sản xuất",h.value=e&&e.date?e.date:(new Date).toISOString().slice(0,10),k.value=!e||void 0===e.is_active||e.is_active,g.value=e&&e.items?JSON.parse(JSON.stringify(e.items)):[]});const C=(0,s.EW)(()=>{if(!L.value)return[];const e=L.value.toLowerCase();return f.value.filter(t=>t.is_active&&"normal"===t.product_type&&(t.name&&t.name.toLowerCase().includes(e)||t.code&&t.code.toLowerCase().includes(e))).slice(0,6)}),x=async()=>{try{const e=await r.A.get("/logicconfigs/"),t=e.data.find(e=>"suppliers"===e.key);t&&(b.value=JSON.parse(t.value))}catch(e){console.error(e)}},S=async()=>{try{const e=await r.A.get("/products/");f.value=e.data}catch(e){console.error(e)}};function E(e){const t=g.value.find(t=>t.code===e.code);t?t.quantity++:g.value.push({code:e.code,name:e.name,quantity:1,price:e.price||0}),L.value="",y.value=!1}function A(e){g.value.splice(e,1)}function T(e){return new Intl.NumberFormat("vi-VN").format(e)}function P(){setTimeout(()=>{y.value=!1},200)}async function D(){try{const e=await r.A.get("/download_purchase_template/",{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download","MauFileNhapHang.xlsx"),document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(e){console.error("Error downloading template:",e)}}function I(){p.value&&p.value.click()}async function K(e){const t=e.target.files[0];if(!t)return;const a=new FileReader;a.onload=t=>{const a=new Uint8Array(t.target.result),l=vm.LF(a,{type:"array"}),s=l.SheetNames[0],o=l.Sheets[s],n=vm.Wp.sheet_to_json(o),i=[];if(n.forEach((e,t)=>{const a=Number(e["Số lượng"]||e["Quantity"]);(isNaN(a)||a<1)&&i.push(`Dòng ${t+2} (Mã hàng: ${e["Mã hàng"]||e["Code"]||"N/A"}, Số lượng: ${e["Số lượng"]||e["Quantity"]||"N/A"})`)}),i.length>0)return void window.alert(`Lỗi: Các dòng sau có số lượng không hợp lệ (nhỏ hơn 1 hoặc không phải số):\n${i.join("\n")}`);const r=new Map;f.value.forEach(e=>{"normal"===e.product_type&&e.is_active&&r.set(e.code,e)});const c=[],u=[];if(n.forEach(e=>{const t=e["Mã hàng"]||e["Code"];if(!t)return;const a=String(t).trim();if(r.has(a)){const t=r.get(a);c.push({code:a,name:t.name,quantity:Number(e["Số lượng"]||e["Quantity"])||1,price:Number(e["Đơn giá"]||e["Price"])||t.price||0})}else u.push(a)}),u.length>0)return window.alert(`Lỗi: Các mã hàng sau không tồn tại hoặc không phải là sản phẩm thường hoặc đã bị vô hiệu hóa:\n${u.join(", ")}`),void(e.target.value=null);g.value=[...g.value,...c],w.value=!1},a.readAsArrayBuffer(t),e.target.value=null}function R(e){const t=Number(e.quantity);(isNaN(t)||t<1)&&(e.quantity=1)}function V(){if(d.value)if("function"===typeof d.value.showPicker)try{d.value.showPicker()}catch(e){d.value.focus()}else d.value.focus()}function N(e){e.target.select()}async function X(){const e={code:m.value,supplier:v.value,date:h.value,is_active:k.value,items:g.value};0!==e.items.reduce((e,t)=>e+(Number(t.quantity)||0),0)?u.value&&u.value.id?await r.A.put(`/purchases/${u.value.id}/`,e).then(e=>{t("saved",e.data)}).catch(e=>{console.error("Error updating purchase:",e),window.alert("Lỗi khi cập nhật đơn nhập hàng: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))}):await r.A.post("/purchases/",e).then(e=>{t("saved",e.data)}).catch(e=>{console.error("Error creating purchase:",e),window.alert("Lỗi khi tạo đơn nhập hàng: "+(e.response&&e.response.data?JSON.stringify(e.response.data):e.message))}):window.alert("Vui lòng thêm ít nhất một sản phẩm với số lượng lớn hơn 0.")}return(0,s.sV)(()=>{x(),S()}),{code:m,supplier:v,date:h,totalQuantity:_,isActive:k,item:u,items:g,suppliers:b,productSearchTerm:L,filteredProducts:C,showProductDropdown:y,dateInput:d,openDatePicker:V,selectAll:N,handleSubmit:X,addProduct:E,removeItem:A,formatPrice:T,hideDropdown:P,fileInput:p,triggerImport:I,handleFileUpload:K,downloadTemplate:D,showImportButton:w,handleQuantityChange:R,maxDate:o,minDate:i,isDateOutsideAllowedRange:c,store:l}}};const km=(0,p.A)(hm,[["render",mm],["__scopeId","data-v-ffb95cca"]]);var gm=km,bm={name:"Purchases",components:{AddEditPurchase:gm},props:{d_edit_days:{type:Number,default:3}},setup(e){const t=(0,n.Pj)(),a=a=>{if(t.getters.userAdmin||t.getters.userSuperadmin)return!0;if(!a)return!1;const l=new Date;l.setHours(0,0,0,0);const s=new Date(a);s.setHours(0,0,0,0);const o=(l.getTime()-s.getTime())/864e5;return o<e.d_edit_days},l=(0,be.KR)([]),o=(0,be.KR)(""),i=(0,be.KR)(1),c=(0,be.KR)(50),u=(0,be.KR)(!1),d=(0,be.KR)({}),p=e=>new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().slice(0,10),m=(0,be.KR)(p(new Date(Date.now()-2592e6))),v=(0,be.KR)(p(new Date)),h=[{title:"",key:"actions",sortable:!1,headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Mã đơn",key:"code",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Nhà cung cấp",key:"supplier",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Ngày nhập",key:"date",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left"}},{title:"Tổng Số Lượng",key:"total_quantity",headerProps:{class:"my-custom-header-class"},align:"end",cellProps:{class:"text-right"}},{title:"Kích hoạt",key:"is_active",headerProps:{class:"my-custom-header-class pr-2"},align:"end",cellProps:{class:"text-right pr-2"}}],k=(0,be.KR)([!0]),g=(0,s.EW)(()=>{let e=l.value;if(k.value&&k.value.length>0&&(e=e.filter(e=>k.value.includes(e.is_active))),!o.value.trim())return e;const t=o.value.toLowerCase();return e.filter(e=>e.code&&e.code.toLowerCase().includes(t)||e.supplier&&e.supplier.toLowerCase().includes(t))}),b=async()=>{try{const e=await r.A.get("/purchases/",{params:{dateFrom:m.value,dateTo:v.value}});l.value=e.data.sort((e,t)=>new Date(t.date)-new Date(e.date))}catch(e){console.error("Error fetching purchases:",e)}},f=e=>{const t=Number(e);return isNaN(t)?e:t.toLocaleString("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0})},L=e=>{if(!e)return"";const t=new Date(e);return t.toLocaleDateString("vi-VN")};async function y(){try{const e=await r.A.get("/purchases/",{params:{dateFrom:m.value,dateTo:v.value,export:"true"},responseType:"blob"}),t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.download="purchases.xlsx",document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t)}catch(e){console.error("Error exporting purchases:",e)}}function w(){d.value={},u.value=!0}function _(e,{item:t}){console.log("Clicked item:",t),d.value={...t},u.value=!0}function C(){d.value={},u.value=!0}async function x(){console.log("Item saved, refreshing list..."),await b(),u.value=!1}return(0,s.wB)([m,v],b),(0,s.sV)(()=>{b()}),{items:l,filterText:o,currentPage:i,pageSize:c,showAddEditItem:u,selectedItem:d,headers:h,filteredItems:g,isActiveFilter:k,formatPrice:f,formatDate:L,exportToCSV:y,openAddItem:w,openEditItem:_,createNewItem:C,onItemSaved:x,dateFrom:m,dateTo:v,isEditable:a}}};const fm=(0,p.A)(bm,[["render",Ip],["__scopeId","data-v-1829265b"]]);var Lm=fm;const ym={class:"work-area"},wm={class:"top-area"},_m={class:"action-area"},Cm={class:"page-actions"},xm={class:"pr-3"},Sm=["max","min"],Em={class:"pl-2"},Am={class:"bottom-area"},Tm={class:"data-area"},Pm={class:"font-bold"},Dm=["onUpdate:modelValue"],Im={class:"info-area pl-3"},Km={class:"filters"},Rm={class:"data-table-holder"};function Vm(e,t,a,o,n,i){const r=(0,s.g2)("v-data-table"),c=(0,s.g2)("EditChangesItems");return(0,s.uX)(),(0,s.CE)("div",ym,[(0,s.Lk)("div",wm,[t[12]||(t[12]=(0,s.Lk)("div",{class:"page-name-area"},"Chốt kho ",-1)),(0,s.Lk)("div",_m,[(0,s.Lk)("div",Cm,[(0,s.Lk)("div",xm,[t[10]||(t[10]=(0,s.eW)(" từ ngày ",-1)),(0,s.Lk)("b",null,(0,y.v_)(o.previousDate),1),t[11]||(t[11]=(0,s.eW)(" đến ngày ",-1))]),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=e=>o.chosenDate=e),class:"date-picker",onClick:t[1]||(t[1]=e=>e.target.showPicker()),style:{"background-color":"white",color:"black"},max:o.maxDate,min:o.minDate},null,8,Sm),[[l.Jo,o.chosenDate]]),(0,s.Lk)("div",Em," Đã chốt lúc: "+(0,y.v_)(o.created_at),1),(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>o.copyClosingToActual&&o.copyClosingToActual(...e)),class:"btn btn-primary",style:{"margin-left":"1rem"}}," Copy Tồn cuối -> Thực tế "),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>o.openEditChanges&&o.openEditChanges(...e)),class:"btn btn-info",style:{"margin-left":"1rem"}}," Sửa đổi hàng "),(0,s.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>o.createDateEndInventory&&o.createDateEndInventory(...e)),class:"btn btn-primary",style:{"margin-left":"1rem"}}," CHỐT HÀNG ")])])]),(0,s.Lk)("div",Am,[(0,s.Lk)("div",Tm,[(0,s.bF)(r,{headers:o.headers,items:o.tableRows,class:"elevation-1","fixed-header":"","items-per-page":-1,height:"calc(100vh - 10rem)",style:{"background-color":"white"},density:"compact","hide-default-footer":""},{"item.diff":(0,s.k6)(({item:e})=>[(0,s.Lk)("span",{class:(0,y.C4)({"text-red":0!==e.diff})},(0,y.v_)(e.diff),3)]),"item.closing":(0,s.k6)(({item:e})=>[(0,s.Lk)("span",Pm,(0,y.v_)(e.closing),1)]),"item.check_actual":(0,s.k6)(({item:e})=>[(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.check_actual=t,class:"qty-input",onFocus:t[5]||(t[5]=e=>e.target.select())},null,40,Dm),[[l.Jo,e.check_actual,void 0,{number:!0}]])]),_:1},8,["headers","items"])]),(0,s.Lk)("div",Im,[(0,s.Lk)("div",Km,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>o.searchQuery=e),placeholder:"Tìm kiếm mã hàng, tên hàng"},null,512),[[l.Jo,o.searchQuery]]),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=e=>o.searchQueryInvoice=e),placeholder:"Tìm kiếm hóa đơn"},null,512),[[l.Jo,o.searchQueryInvoice]]),(0,s.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>o.exportToExcel&&o.exportToExcel(...e)),class:"btn btn-secondary"},"Export Excel")]),t[13]||(t[13]=(0,s.Lk)("div",{style:{padding:"0.5rem","text-align":"left"}}," Lưu ý: Hiển thị tối đa 10 hóa đơn, xuất excel sẽ xuất toàn bộ hóa đơn. ",-1)),(0,s.Lk)("div",Rm,[(0,s.bF)(r,{headers:o.infoHeaders,items:o.infoTableRows,class:"elevation-1 bordered-table","fixed-header":"","items-per-page":-1,style:{"background-color":"white",width:"max-content","min-width":"100%"},density:"compact",height:"65vh","hide-default-footer":""},null,8,["headers","items"])])])]),o.showEditChanges?((0,s.uX)(),(0,s.Wv)(c,{key:0,"initial-items":o.currentChangesItems,products:o.products,onClose:t[9]||(t[9]=e=>o.showEditChanges=!1),onSave:o.handleSaveChanges},null,8,["initial-items","products","onSave"])):(0,s.Q3)("",!0)])}const Nm={class:"modal-content"},Xm={class:"modal-header"},Fm={class:"modal-body"},Um={class:"col-deduct search-container"},Om=["onUpdate:modelValue","onFocus","onBlur","onInput"],Wm={class:"col-replace search-container"},qm=["onUpdate:modelValue","onFocus","onBlur","onInput"],Qm={class:"col-description"},Jm=["onUpdate:modelValue"],Mm={class:"col-qty"},$m=["onUpdate:modelValue","onChange"],Bm={class:"col-action"},Hm=["onClick"],jm={class:"modal-footer"},Gm=["disabled"],zm=["onMousedown"];function Ym(e,t,a,o,n,i){return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",{class:"modal-overlay",onMousedown:t[4]||(t[4]=(0,l.D$)(t=>e.$emit("close"),["self"]))},[(0,s.Lk)("div",Nm,[(0,s.Lk)("div",Xm,[t[5]||(t[5]=(0,s.Lk)("h3",null,"Chỉnh sửa đổi hàng",-1)),(0,s.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("close")),class:"close-btn"},"×")]),(0,s.Lk)("div",Fm,[t[6]||(t[6]=(0,s.Fv)('<div class="table-header" data-v-6f829926><div class="col-deduct" data-v-6f829926>Hàng trả (Deduction)</div><div class="col-replace" data-v-6f829926>Hàng đổi (Replacement)</div><div class="col-description" data-v-6f829926>Mô tả</div><div class="col-qty" data-v-6f829926>Số lượng</div><div class="col-action" data-v-6f829926></div></div>',1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.items,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"table-row"},[(0,s.Lk)("div",Um,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.deductSearchTerm=t,onFocus:t=>o.handleFocus(t,e,"deduction"),onBlur:t=>o.onBlur(e,"deduction"),onInput:t=>o.onInputChange(e,"deduction"),placeholder:"Tìm hàng trả",class:"search-input"},null,40,Om),[[l.Jo,e.deductSearchTerm]])]),(0,s.Lk)("div",Wm,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.replaceSearchTerm=t,onFocus:t=>o.handleFocus(t,e,"replace"),onBlur:t=>o.onBlur(e,"replace"),onInput:t=>o.onInputChange(e,"replace"),placeholder:"Tìm hàng đổi",class:"search-input"},null,40,qm),[[l.Jo,e.replaceSearchTerm]])]),(0,s.Lk)("div",Qm,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.description=t,placeholder:"Mô tả",class:"description-input"},null,8,Jm),[[l.Jo,e.description]])]),(0,s.Lk)("div",Mm,[(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.quantity=t,class:"qty-input",min:"1",onChange:t=>o.handleQuantityChange(e)},null,40,$m),[[l.Jo,e.quantity,void 0,{number:!0}]])]),(0,s.Lk)("div",Bm,[(0,s.Lk)("button",{onClick:e=>o.removeItem(t),class:"btn-remove"},"×",8,Hm)])]))),128)),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>o.addItem&&o.addItem(...e)),class:"btn-add-row"},"+ Thêm dòng")]),(0,s.Lk)("div",jm,[(0,s.Lk)("button",{onClick:t[2]||(t[2]=t=>e.$emit("close")),class:"btn btn-secondary"},"Hủy"),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>o.saveChanges&&o.saveChanges(...e)),class:"btn btn-primary new-button",disabled:0===o.items.length||o.items.every(e=>!e.deduction_product_code||!e.replace_product_code||e.quantity<=0)},"Lưu",8,Gm)])])],32),((0,s.uX)(),(0,s.Wv)(s.Im,{to:"body"},[o.activeDropdown.item&&o.currentDropdownList.length?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"dropdown-teleport",style:(0,y.Tr)(o.dropdownStyle)},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.currentDropdownList,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-item",onMousedown:(0,l.D$)(t=>o.selectProduct(o.activeDropdown.item,e,o.activeDropdown.type),["prevent"])},(0,y.v_)(e.name)+" ("+(0,y.v_)(e.code)+") ",41,zm))),128))],4)):(0,s.Q3)("",!0)]))],64)}var Zm={name:"EditChangesItems",props:{initialItems:{type:Array,default:()=>[]},products:{type:Array,default:()=>[]}},emits:["close","save"],setup(e,{emit:t}){const a=t=>{if(!t)return"";const a=e.products.find(e=>e.code===t);return a?`${a.name} - ${a.code}`:t},l=(0,be.KR)(e.initialItems.map(e=>({...e,deductSearchTerm:a(e.deduction_product_code),replaceSearchTerm:a(e.replace_product_code),description:e.description||"",showDeductDropdown:!1,showReplaceDropdown:!1}))),o=(0,be.KR)({item:null,type:null}),n=(0,be.KR)({}),i=(0,s.EW)(()=>e.products.filter(e=>"normal"===e.product_type)),r=e=>{if(!e)return i.value.slice(0,10);const t=e.toLowerCase();return i.value.filter(e=>{const a=e.name.toLowerCase(),l=e.code.toLowerCase(),s=`${a} - ${l}`;return a.includes(t)||l.includes(t)||s.includes(t)}).slice(0,10)},c=(0,s.EW)(()=>{const{item:e,type:t}=o.value;if(!e)return[];const a="deduction"===t?e.deductSearchTerm:e.replaceSearchTerm;return r(a)}),u=(e,t,a)=>{const l=e.target.getBoundingClientRect();n.value={top:`${l.bottom}px`,left:`${l.left}px`,width:`${l.width}px`},o.value={item:t,type:a}},d=(e,t)=>{"deduction"===t?e.deduction_product_code="":e.replace_product_code=""},p=(e,t)=>{setTimeout(()=>{o.value.item===e&&o.value.type===t&&(o.value={item:null,type:null}),"deduction"===t?e.showDeductDropdown=!1:e.showReplaceDropdown=!1},200)},m=(e,t,a)=>{"deduction"===a?(e.deduction_product_code=t.code,e.deductSearchTerm=`${t.name} - ${t.code}`,e.showDeductDropdown=!1,o.value={item:null,type:null}):(e.replace_product_code=t.code,e.replaceSearchTerm=`${t.name} - ${t.code}`,e.showReplaceDropdown=!1,o.value={item:null,type:null})},v=()=>{l.value.push({deduction_product_code:"",replace_product_code:"",quantity:1,description:"",deductSearchTerm:"",replaceSearchTerm:"",showDeductDropdown:!1,showReplaceDropdown:!1})},h=e=>{l.value.splice(e,1)},k=e=>{const t=Number(e.quantity);(isNaN(t)||t<1)&&(e.quantity=1)},g=()=>{const e=l.value.filter(e=>(e.deduction_product_code||e.replace_product_code)&&e.quantity>0).map(e=>({deduction_product_code:e.deduction_product_code,replace_product_code:e.replace_product_code,quantity:e.quantity,description:e.description||""}));t("save",e)};return{items:l,filteredProducts:r,activeDropdown:o,dropdownStyle:n,currentDropdownList:c,handleFocus:u,onInputChange:d,onBlur:p,selectProduct:m,addItem:v,removeItem:h,saveChanges:g,handleQuantityChange:k}}};const ev=(0,p.A)(Zm,[["render",Ym],["__scopeId","data-v-6f829926"]]);var tv=ev,av={name:"DateEndInventory",components:{EditChangesItems:tv},props:{d_edit_days:{type:Number,default:3}},setup(e){const t=(0,n.Pj)(),a=e=>new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().slice(0,10),l=(0,be.KR)([]),o=(0,be.KR)("chưa chốt"),i=(0,be.KR)(a(new Date(Date.now()))),c=(0,be.KR)(""),u=(0,be.KR)(""),d=(0,be.KR)(!1),p=(0,be.KR)([]),m=(0,be.KR)(null),v=(0,be.KR)([]),h=(0,s.EW)(()=>a(new Date)),k=(0,s.EW)(()=>{if(t.getters.userAdmin||t.getters.userSuperadmin)return"";const l=new Date,s=new Date;return s.setDate(l.getDate()-(e.d_edit_days||3)),a(s)}),g=async()=>{try{const e=await r.A.get("/products/");v.value=e.data}catch(e){console.error("Error fetching products:",e)}},b=async()=>{t.commit("setLoading",!0);try{const e=await r.A.get("/dateendinventories/",{params:{dayend:!0,date:i.value}});l.value=e.data,m.value=l.value[0].previous_date?.date||null,o.value=l.value[0].created_at?l.value[0].created_at.slice(0,16):"chưa chốt"}catch(e){console.error("Error fetching date end inventories:",e)}t.commit("setLoading",!1)},f=async()=>{if(i.value){t.commit("setLoading",!0);try{const e=y.value.map(e=>({code:e.code,quantity:e.check_actual}));await r.A.post("/dateendinventories/",{date:i.value,items:e}),await b(),alert("Đã tạo phiếu chốt kho thành công.")}catch(e){console.error("Error creating date end inventory:",e),alert("Lỗi khi tạo phiếu chốt kho: "+(e.response?.data?.detail||e.message))}t.commit("setLoading",!1)}},L=[{title:"Nhóm hàng",key:"group",headerProps:{class:"my-custom-header-class"},align:"start",cellProps:{class:"text-left back-ground-white"}},{title:"Mã hàng",key:"code",headerProps:{class:"my-custom-header-class"},align:"start",cellProps:{class:"text-left back-ground-white"}},{title:"Tên hàng",key:"name",headerProps:{class:"my-custom-header-class"},align:"start",cellProps:{class:"text-left back-ground-white"}},{title:"Tồn đầu",key:"prev",align:"end",headerProps:{class:"my-custom-header-class ",style:"text-align: right;"},align:"end",cellProps:{class:"text-right back-ground-white"}},{title:"Nhập",key:"purchaseSum",align:"end",headerProps:{class:"my-custom-header-class ",style:"text-align: right;"},align:"end",cellProps:{class:"text-right back-ground-white "}},{title:"Xuất",key:"invoiceSum",align:"end",headerProps:{class:"my-custom-header-class ",style:"text-align: right;"},align:"end",cellProps:{class:"text-right  back-ground-white"}},{title:"Đổi hàng",key:"changeSum",align:"end",headerProps:{class:"my-custom-header-class ",style:"text-align: right;"},align:"end",cellProps:{class:"text-right  back-ground-white"}},{title:"Tồn cuối (LT)",key:"closing",align:"end",headerProps:{class:"my-custom-header-class ",style:"text-align: right;"},align:"end",cellProps:{class:"text-right  back-ground-white"}},{title:"Thực tế",key:"actual",align:"end",headerProps:{class:"my-custom-header-class ",style:"text-align: right;"},align:"end",cellProps:{class:"text-right back-ground-white "}},{title:"Chênh lệch",key:"diff",align:"end",headerProps:{class:"my-custom-header-class  pr-3",style:"text-align: right;"},align:"end",cellProps:{class:"text-right  back-ground-white pr-3"}},{title:"Kiểm kê",key:"check_actual",align:"end",headerProps:{class:"my-custom-header-class pr-3",style:"text-align: right;"},align:"end",cellProps:{class:"text-right back-ground-white pr-3"}}],y=(0,be.KR)([]),w=()=>{if(!l.value||0===l.value.length)return void(y.value=[]);const e=l.value[0],t=e.previous_date?.items||[],a=e.items||[],s=e.purchases||[],o=e.invoices||[],n=e.changes_items||[],i=new Set,r=e=>{Array.isArray(e)&&e.forEach(e=>{e.code&&i.add(e.code)})};r(t),r(a),s.forEach(e=>r(e.items)),o.forEach(e=>{r(e.expanded_items)}),n.forEach(e=>{e.deduction_product_code&&i.add(e.deduction_product_code),e.replace_product_code&&i.add(e.replace_product_code)});const c={};v.value.forEach(e=>{c[e.code]={name:e.name,group:e.productGroup}});const u=[];i.forEach(e=>{const l=c[e]||{},i={code:e,name:l.name||"",group:l.group||"",prev:0,purchaseSum:0,invoiceSum:0,changeSum:0,closing:0,actual:"",diff:0,check_actual:0},r=t.find(t=>t.code===e);i.prev=r&&Number(r.quantity)||0;let d=0;s.forEach(t=>{const a=t.items?t.items.find(t=>t.code===e):null,l=a&&Number(a.quantity)||0;d+=l}),i.purchaseSum=0===d?"":d;let p=0;o.forEach(t=>{t.expanded_items?.forEach(t=>{t.code===e&&(p+=Number(t.quantity)||0)})}),i.invoiceSum=0===p?"":p;let m=0;n.forEach(t=>{const a=Number(t.quantity)||0;t.deduction_product_code===e&&(m-=a),t.replace_product_code===e&&(m+=a)}),i.changeSum=0===m?"":m,i.closing=i.prev+d-p,i.closing=i.prev+d-p-m;const v=a.find(t=>t.code===e);i.actual=v?Number(v.quantity)||0:"",i.diff=i.closing-i.actual,u.push(i)}),y.value=u.sort((e,t)=>e.code.localeCompare(t.code)),y.value=y.value.filter(e=>{const t=v.value.find(t=>t.code===e.code);return t&&"combo"!==t.product_type}),y.value=y.value.filter(e=>{const t=v.value.find(t=>t.code===e.code);return!(t&&0===e.prev&&(0===e.purchaseSum||""===e.purchaseSum)&&(0===e.invoiceSum||""===e.invoiceSum)&&(0===e.changeSum||""===e.changeSum)&&0===e.closing&&0===e.actual)}),console.log("Updated table rows:",y.value)},_=(0,s.EW)(()=>{if(!l.value||0===l.value.length)return[];let e=l.value[0].invoices||[];if(u.value){const t=u.value.toLowerCase();e=e.filter(e=>e.code&&e.code.toLowerCase().includes(t)||e.channel&&e.channel.toLowerCase().includes(t))}return e.slice(0,10)}),C=(0,s.EW)(()=>{if(!l.value||0===l.value.length)return[];const e=_.value,t={};e.forEach(e=>{const a=e.expanded_items||[];a.forEach(a=>{if("combo_item"===a.type||"normal"===a.type){if(!t[a.code]){const e=v.value.find(e=>e.code===a.code);t[a.code]={code:a.code,name:e?e.name:""}}const l=`invoice_${e.id}`;t[a.code][l]=(t[a.code][l]||0)+(Number(a.quantity)||0)}})});let a=Object.values(t);if(c.value){const e=c.value.toLowerCase();a=a.filter(t=>t.code&&t.code.toLowerCase().includes(e)||t.name&&t.name.toLowerCase().includes(e))}return a.sort((e,t)=>e.code.localeCompare(t.code))}),x=(0,s.EW)(()=>{if(!l.value||0===l.value.length)return[];const e=_.value,t=C.value,a=[{title:"Mã hàng",key:"code",fixed:!0,align:"start",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left back-ground-white"}},{title:"Tên hàng",key:"name",fixed:!0,align:"start",headerProps:{class:"my-custom-header-class",style:"min-width: 10rem;"},cellProps:{class:"text-left back-ground-white"}}];return e.forEach(e=>{const l=`invoice_${e.id}`,s=!c.value||t.some(e=>e[l]);s&&a.push({title:e.code,key:l,align:"end",headerProps:{class:"my-custom-header-class vertical-header"},cellProps:{class:"text-right back-ground-white pr-2"}})}),a}),S=()=>{if(!l.value||0===l.value.length)return;const e=l.value[0].invoices||[],t={};e.forEach(e=>{const a=e.expanded_items||[];a.forEach(a=>{if("combo_item"===a.type||"normal"===a.type){if(!t[a.code]){const e=v.value.find(e=>e.code===a.code);t[a.code]={code:a.code,name:e?e.name:""}}const l=`invoice_${e.id}`;t[a.code][l]=(t[a.code][l]||0)+(Number(a.quantity)||0)}})});const a=Object.values(t).sort((e,t)=>e.code.localeCompare(t.code)),s=["Mã hàng","Tên hàng"],o=["code","name"];e.forEach(e=>{s.push(e.code),o.push(`invoice_${e.id}`)});const n=[s];a.forEach(e=>{const t=o.map(t=>e[t]||"");n.push(t)});const r=vm.Wp.aoa_to_sheet(n),c=vm.Wp.book_new();vm.Wp.book_append_sheet(c,r,"InfoData"),vm._h(c,`InfoData_${i.value}.xlsx`)};(0,s.wB)([l,v],w);const E=e=>{e.diff=e.closing-e.actual},A=()=>{y.value.forEach(e=>{let t=e.closing;e.check_actual=t})},T=()=>{l.value.length>0?(p.value=JSON.parse(JSON.stringify(l.value[0].changes_items||[])),d.value=!0):alert("Không có dữ liệu chốt kho cho ngày này.")},P=async e=>{if(l.value.length>0){const s=l.value[0].date;if(!s)return void alert("Không thể lưu, không tìm thấy ngày.");try{t.commit("setLoading",!0),await r.A.post("/changeitems/",{date:s,items:e}),d.value=!1,await b()}catch(a){alert("Lỗi khi lưu đổi hàng: "+(a.response?.data?.detail||a.message))}finally{t.commit("setLoading",!1)}}},D=e=>{const t=Number(e);return isNaN(t)?"0 ₫":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t)},I=e=>{if(!e)return"";const t=new Date(e),a=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0");return`${a}/${l}/${s} ${o}:${n}:${i}`};return(0,s.sV)(()=>{b(),g()}),(0,s.wB)(i,b),{getLocalDateISO:a,DateEndInventorys:l,fetchDateEndInventorys:b,chosenDate:i,searchQuery:c,searchQueryInvoice:u,formatPrice:D,formatDateTime:I,tableRows:y,headers:L,onDiffChange:E,copyClosingToActual:A,infoHeaders:x,infoTableRows:C,exportToExcel:S,showEditChanges:d,openEditChanges:T,handleSaveChanges:P,currentChangesItems:p,products:v,previousDate:m,createDateEndInventory:f,created_at:o,minDate:k,maxDate:h}}};const lv=(0,p.A)(av,[["render",Vm],["__scopeId","data-v-657dfc4a"]]);var sv=lv;const ov={class:"p-2 max-w-7xl mx-auto"},nv={class:"flex items-center gap-4 mb-8 bg-white p-4 rounded-lg shadow-sm border",style:{display:"flex","flex-direction":"row","justify-content":"center","align-items":"center"}},iv={class:"font-medium text-gray-700 pr-3"},rv=["max","min"],cv={class:"text-gray-700 pl-3"},uv={key:0,class:"text-center py-10 text-gray-500"},dv={key:1,class:"space-y-6"},pv={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},mv={class:"bg-white p-2 rounded-lg shadow border border-gray-200"},vv={class:"text-2xl font-bold text-gray-800 mt-2"},hv={key:0,class:"text-xs text-gray-400 mt-1"},kv={class:"bg-white p-2 rounded-lg shadow border border-gray-200"},gv={class:"text-2xl font-bold text-green-600 mt-2"},bv={class:"bg-white p-2 rounded-lg shadow border border-gray-200"},fv={class:"text-2xl font-bold text-red-600 mt-2"},Lv={class:"bg-blue-50 p-2 rounded-lg shadow border border-blue-200"},yv={class:"text-2xl font-bold text-blue-700 mt-2"},wv={class:"bg-white p-2 rounded-lg shadow border border-gray-200"},_v={class:"text-2xl font-bold text-blue-700 mt-2"},Cv={class:"bg-white p-2 rounded-lg shadow border border-gray-200"},xv={class:"text-2xl font-bold text-blue-700 mt-2"},Sv={class:"bg-white p-2 rounded-lg shadow border border-gray-200"},Ev={class:""},Av={class:"p-2 rounded-lg shadow border border-gray-200"},Tv=["disabled"],Pv={class:"bg-white rounded-lg shadow border border-gray-200 overflow-hidden"},Dv={class:"",style:{display:"flex","flex-direction":"row","justify-content":"space-between","align-items":"center",padding:"0.5rem"}};function Iv(e,t,a,o,n,i){const r=(0,s.g2)("v-data-table");return(0,s.uX)(),(0,s.CE)("div",ov,[(0,s.Lk)("div",nv,[(0,s.Lk)("div",iv,[t[8]||(t[8]=(0,s.Lk)("b",null," Chốt Tiền ",-1)),t[9]||(t[9]=(0,s.eW)("từ ngày ",-1)),(0,s.Lk)("b",null,(0,y.v_)(i.previousDate),1),t[10]||(t[10]=(0,s.eW)(" đến ngày",-1))]),(0,s.bo)((0,s.Lk)("input",{type:"date",id:"date","onUpdate:modelValue":t[0]||(t[0]=e=>n.selectedDate=e),onChange:t[1]||(t[1]=(...e)=>i.fetchData&&i.fetchData(...e)),onClick:t[2]||(t[2]=e=>e.target.showPicker()),max:i.maxDate,min:i.minDate,class:"border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",style:{"background-color":"white",color:"black",border:"1px solid gray"}},null,40,rv),[[l.Jo,n.selectedDate]]),(0,s.Lk)("div",cv,"Đã chốt lúc: "+(0,y.v_)(i.createdAt),1),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>i.fetchData&&i.fetchData(...e)),class:"btn ml-2"}," Refresh ")]),n.loading?((0,s.uX)(),(0,s.CE)("div",uv,"Loading data...")):n.balanceData?((0,s.uX)(),(0,s.CE)("div",dv,[(0,s.Lk)("div",pv,[(0,s.Lk)("div",mv,[t[11]||(t[11]=(0,s.Lk)("h3",{class:"text-gray-500 text-sm font-medium uppercase"},"Số dư đầu kỳ",-1)),(0,s.Lk)("p",vv,(0,y.v_)(i.formatCurrency(i.beginningBalance)),1),n.balanceData.previous_date?((0,s.uX)(),(0,s.CE)("p",hv," From "+(0,y.v_)(n.balanceData.previous_date.date),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",kv,[t[12]||(t[12]=(0,s.Lk)("h3",{class:"text-gray-500 text-sm font-medium uppercase"},"Tổng Thu (DR)",-1)),(0,s.Lk)("p",gv,"+"+(0,y.v_)(i.formatCurrency(i.totalIn)),1)]),(0,s.Lk)("div",bv,[t[13]||(t[13]=(0,s.Lk)("h3",{class:"text-gray-500 text-sm font-medium uppercase"},"Tổng Chi (CR)",-1)),(0,s.Lk)("p",fv,"-"+(0,y.v_)(i.formatCurrency(i.totalOut)),1)]),(0,s.Lk)("div",Lv,[t[14]||(t[14]=(0,s.Lk)("h3",{class:"text-blue-800 text-sm font-medium uppercase"},"Số dư cuối kỳ",-1)),(0,s.Lk)("p",yv,(0,y.v_)(i.formatCurrency(i.expectedEnding)),1)]),(0,s.Lk)("div",wv,[t[15]||(t[15]=(0,s.Lk)("h3",{class:"text-blue-800 text-sm font-medium uppercase"},"Số dư đã chốt",-1)),(0,s.Lk)("p",_v,(0,y.v_)(n.balanceData.created_at?i.formatCurrency(i.finalisedEnding):"..."),1)]),(0,s.Lk)("div",Cv,[t[16]||(t[16]=(0,s.Lk)("h3",{class:"text-blue-800 text-sm font-medium uppercase"},"Chênh lệch",-1)),(0,s.Lk)("p",xv,(0,y.v_)(i.formatCurrency(i.difference)),1)]),(0,s.Lk)("div",Sv,[(0,s.Lk)("div",Ev,[t[17]||(t[17]=(0,s.Lk)("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tiền mặt thực tế",-1)),(0,s.bo)((0,s.Lk)("input",{style:{"background-color":"white",color:"black",border:"1px solid gray",width:"100%"},type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>i.actualCashInHandDisplay=e),class:"rounded px-3 py-2",onFocus:t[5]||(t[5]=e=>e.target.select())},null,544),[[l.Jo,i.actualCashInHandDisplay]])])]),(0,s.Lk)("div",Av,[(0,s.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>i.saveBalance&&i.saveBalance(...e)),disabled:n.saving,class:"btn btn-secondary"},(0,y.v_)(n.saving?"Đang lưu...":"Lưu số dư"),9,Tv)])]),(0,s.Lk)("div",Pv,[(0,s.Lk)("div",Dv,[t[18]||(t[18]=(0,s.Lk)("h2",{class:"text-lg font-semibold text-gray-800"},[(0,s.Lk)("b",null,"Giao dịch")],-1)),(0,s.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>i.exportToCSV&&i.exportToCSV(...e)),class:"btn btn-secondary",style:{"font-size":"0.8rem"}},"Export CSV")]),(0,s.bF)(r,{headers:n.headers,items:i.transactions,class:"elevation-1",density:"compact","items-per-page":-1,"hide-default-footer":"",height:"calc(100vh - 22rem)",style:{"background-color":"white",color:"black"},"fixed-header":""},{"item.transaction_type_name":(0,s.k6)(({item:e})=>[(0,s.eW)((0,y.v_)(e.transaction_type_name)+" ",1),(0,s.Lk)("span",{class:(0,y.C4)(["ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full","DR"===e.debit_or_credit?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},(0,y.v_)(e.debit_or_credit),3)]),"item.amount":(0,s.k6)(({item:e})=>[(0,s.Lk)("span",{class:(0,y.C4)("DR"===e.debit_or_credit?"text-green-600 font-medium":"text-red-600 font-medium")},(0,y.v_)(i.formatCurrency(e.amount)),3)]),"no-data":(0,s.k6)(()=>[...t[19]||(t[19]=[(0,s.Lk)("div",{class:"px-6 py-8 text-center text-sm text-gray-500",style:{"background-color":"white",color:"black"}},"Không tìm thấy giao dịch cho ngày này.",-1)])]),_:1},8,["headers","items"])])])):(0,s.Q3)("",!0)])}var Kv={name:"DateEndCashBalance",props:{d_edit_days:{type:Number,default:3}},data(e){return{selectedDate:this.getLocalDateISO(new Date(Date.now())),loading:!1,saving:!1,balanceData:null,actualCashInHand:0,headers:[{title:"ID",key:"id",align:"start",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left back-ground-white"}},{title:"Loại",key:"transaction_type_name",align:"start",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left back-ground-white"}},{title:"Mô tả",key:"description",align:"start",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left back-ground-white"}},{title:"Mã hóa đơn",key:"invoice_code",align:"start",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left back-ground-white"}},{title:"Tài khoản",key:"bank_account_name",align:"start",headerProps:{class:"my-custom-header-class"},cellProps:{class:"text-left back-ground-white"}},{title:"Số tiền",key:"amount",align:"end",headerProps:{class:"my-custom-header-class pr-3"},cellProps:{class:"text-right pr-3 back-ground-white"}}]}},computed:{maxDate(){return this.getLocalDateISO(new Date)},minDate(){if(this.$store.getters.userAdmin||this.$store.getters.userSuperadmin)return"";const e=new Date,t=new Date;return t.setDate(e.getDate()-(this.d_edit_days||3)),this.getLocalDateISO(t)},transactions(){return(this.balanceData?.transactions||[]).filter(e=>1===e.account)},beginningBalance(){return this.balanceData?.previous_date&&parseFloat(this.balanceData.previous_date.cash_in_hand)||0},totalIn(){return this.transactions.filter(e=>"DR"===e.debit_or_credit).reduce((e,t)=>e+parseFloat(t.amount),0)},totalOut(){return this.transactions.filter(e=>"CR"===e.debit_or_credit).reduce((e,t)=>e+parseFloat(t.amount),0)},expectedEnding(){return this.beginningBalance+this.totalIn-this.totalOut},finalisedEnding(){return this.balanceData?parseFloat(this.balanceData.cash_in_hand):""},difference(){return this.finalisedEnding-this.expectedEnding},previousDate(){return this.balanceData?.previous_date?.date||"..."},createdAt(){return this.balanceData?.created_at?this.balanceData.created_at.slice(0,16).replace("T"," "):"chưa chốt"},actualCashInHandDisplay:{get(){return this.actualCashInHand.toLocaleString("en-US")},set(e){const t=parseFloat(e.replace(/,/g,""));this.actualCashInHand=isNaN(t)?0:t}}},mounted(){this.fetchData()},methods:{getLocalDateISO(e){return new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().slice(0,10)},async fetchData(){if(this.selectedDate){this.loading=!0;try{const e=await r.A.get(`/dateendcashbalances/?date=${this.selectedDate}&dateend=true`);Array.isArray(e.data)&&e.data.length>0?(this.balanceData=e.data[0],this.balanceData.id?this.actualCashInHand=parseFloat(this.balanceData.cash_in_hand):this.$nextTick(()=>{this.actualCashInHand=this.expectedEnding})):this.balanceData=null}catch(e){console.error("Error fetching balance data:",e),alert("Failed to load data.")}finally{this.loading=!1}}},async saveBalance(){this.saving=!0;try{const e={date:this.selectedDate,cash_in_hand:this.actualCashInHand};this.balanceData.id?await r.A.put(`/dateendcashbalances/${this.balanceData.id}/`,e):await r.A.post("/dateendcashbalances/",e),alert("Balance saved successfully!"),await this.fetchData()}catch(e){console.error("Error saving balance:",e),alert("Failed to save balance.")}finally{this.saving=!1}},formatCurrency(e){return new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e)},exportToCSV(){if(!this.balanceData||!this.balanceData.transactions||0===this.balanceData.transactions.length)return void alert("Không có dữ liệu để xuất.");const e=this.balanceData.transactions,t=["ID","Ngày","Loại","Mô tả","Mã hóa đơn","Tài khoản","Số tiền","Thu/Chi"],a=[t.join(","),...e.map(e=>[e.id,e.date,`"${e.transaction_type_name||""}"`,`"${(e.description||"").replace(/"/g,'""')}"`,`"${e.invoice_code||""}"`,`"${e.bank_account_name||""}"`,e.amount,e.debit_or_credit].join(","))].join("\n"),l=new Blob(["\ufeff"+a],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");if(void 0!==s.download){const e=URL.createObjectURL(l);s.setAttribute("href",e),s.setAttribute("download",`transactions_${this.selectedDate}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}}};const Rv=(0,p.A)(Kv,[["render",Iv],["__scopeId","data-v-04518798"]]);var Vv=Rv,Nv={name:"Manage",components:{Products:gn,Customers:ki,Invoices:ic,Settings:Jc,Trans:hd,Users:vp,Purchases:Lm,DateEndInventory:sv,DateEndCashBalance:Vv},data(){return{d_edit_days:3,menus:[{Id:1,name:"Hóa Đơn",require_admin:!1,query_params:"invoices"},{Id:2,name:"Mua hàng",require_admin:!1,query_params:"purchases"},{Id:3,name:"Sản phẩm",require_admin:!0,query_params:"products"},{Id:4,name:"Khách hàng",require_admin:!0,query_params:"customers"},{Id:5,name:"Sổ quỹ",require_admin:!1,query_params:"trans"},{Id:6,name:"Cài đặt",require_admin:!0,query_params:"settings"},{Id:7,name:"Người dùng",require_admin:!0,query_params:"users"},{Id:8,name:"Chốt Kho",require_admin:!1,query_params:"date_end_inventory"},{Id:9,name:"Chốt Quỹ",require_admin:!1,query_params:"date_end_cash_balance"}],activeView:"Hóa Đơn",channels:[]}},watch:{"$route.query.view"(e){const t=this.menus.find(t=>t.query_params===e);t&&(this.activeView=t.name)}},mounted(){const e=this.$route.query.view,t=this.menus.find(t=>t.query_params===e);t?this.activeView=t.name:this.setActiveView("Hóa Đơn"),this.fetchLogicConfig()},methods:{async fetchLogicConfig(){try{const e=await r.A.get("/logicconfigs/"),t=e.data.find(e=>"channels"===e.key);t&&(this.channels=JSON.parse(t.value));const a=e.data.find(e=>"d_edit_days"===e.key);a&&(this.d_edit_days=parseInt(a.value))}catch(e){console.error("Error fetching channels:",e)}},setActiveView(e){this.activeView=e;const t=this.menus.find(t=>t.name===e);t&&this.$route.query.view!==t.query_params&&this.$router.push({query:{...this.$route.query,view:t.query_params}})},handleSignOut(){this.$store.dispatch("removeToken"),this.$router.push("/signin")},showReportPopup(e){}}};const Xv=(0,p.A)(Nv,[["render",Js],["__scopeId","data-v-73c61ab6"]]);var Fv=Xv;const Uv={class:"sign-in"},Ov={key:0,class:"error-messages"},Wv={class:"form-group"},qv={class:"form-group"};function Qv(e,t,a,o,n,i){return(0,s.uX)(),(0,s.CE)("div",Uv,[(0,s.Lk)("form",{onSubmit:t[2]||(t[2]=(0,l.D$)((...e)=>i.handleSignIn&&i.handleSignIn(...e),["prevent"]))},[t[5]||(t[5]=(0,s.Lk)("h1",null,"Sign In",-1)),n.errors.length?((0,s.uX)(),(0,s.CE)("div",Ov,[(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.errors,(e,t)=>((0,s.uX)(),(0,s.CE)("li",{key:t,class:"error"},(0,y.v_)(e),1))),128))])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Wv,[t[3]||(t[3]=(0,s.Lk)("label",{for:"user"},"User",-1)),(0,s.bo)((0,s.Lk)("input",{id:"user","onUpdate:modelValue":t[0]||(t[0]=e=>n.user=e),placeholder:"Enter your user",required:""},null,512),[[l.Jo,n.user]])]),(0,s.Lk)("div",qv,[t[4]||(t[4]=(0,s.Lk)("label",{for:"password"},"Password",-1)),(0,s.bo)((0,s.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),placeholder:"Enter your password",required:""},null,512),[[l.Jo,n.password]])]),t[6]||(t[6]=(0,s.Lk)("button",{type:"submit",class:"btn"},"Sign In",-1))],32)])}var Jv={name:"SignIn",data(){return{user:"",password:"",errors:[]}},methods:{async handleSignIn(){this.errors=[];const e={username:this.user,password:this.password};this.$store.dispatch("setToken",null),r.A.defaults.headers.common["Authorization"]="",await r.A.post("/jwt/create/",e).then(e=>{const t=e.data.access;this.$store.dispatch("setToken",t),r.A.defaults.headers.common["Authorization"]=`Bearer ${t}`,r.A.get("/who_i_am/").then(e=>{const t=e.data.usergroups||[],a=t.includes("admin");this.$store.dispatch("setUserAdmin",a),this.$store.dispatch("setUserName",e.data.username||"")}).catch(e=>{console.error("Error fetching user info after sign-in:",e)}),this.$router.push("/manage")}).catch(e=>{console.error("Sign-in failed:",e),e.response&&e.response.data?this.errors.push(...Object.values(e.response.data)):this.errors.push("Sign-in failed. Please check your credentials.")})}},beforeMount(){this.$store.getters.isAuthenticated&&this.$router.push("/manage")}};const Mv=(0,p.A)(Jv,[["render",Qv],["__scopeId","data-v-47555536"]]);var $v=Mv;const Bv=[{path:"/",redirect:"/sale"},{path:"/sale",name:"sale",component:Is},{path:"/manage",name:"manage",component:Fv},{path:"/about",name:"about",component:()=>a.e(594).then(a.bind(a,603))},{path:"/signin",name:"signin",component:$v}],Hv=(0,i.aE)({history:(0,i.LA)("/"),routes:Bv});var jv=Hv;const Gv=(0,b.$N)({components:f,directives:L}),zv=(0,l.Ef)(g).use(fo).use(jv).use(Gv);zv.mount("#app")}},t={};function a(l){var s=t[l];if(void 0!==s)return s.exports;var o=t[l]={exports:{}};return e[l].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,l,s,o){if(!l){var n=1/0;for(u=0;u<e.length;u++){l=e[u][0],s=e[u][1],o=e[u][2];for(var i=!0,r=0;r<l.length;r++)(!1&o||n>=o)&&Object.keys(a.O).every(function(e){return a.O[e](l[r])})?l.splice(r--,1):(i=!1,o<n&&(n=o));if(i){e.splice(u--,1);var c=s();void 0!==c&&(t=c)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[l,s,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce(function(t,l){return a.f[l](e,t),t},[]))}}(),function(){a.u=function(e){return"js/about.87d251bb.js"}}(),function(){a.miniCssF=function(e){}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="fppos_vue:";a.l=function(l,s,o,n){if(e[l])e[l].push(s);else{var i,r;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==l||d.getAttribute("data-webpack")==t+o){i=d;break}}i||(r=!0,i=document.createElement("script"),i.charset="utf-8",a.nc&&i.setAttribute("nonce",a.nc),i.setAttribute("data-webpack",t+o),i.src=l),e[l]=[s];var p=function(t,a){i.onerror=i.onload=null,clearTimeout(m);var s=e[l];if(delete e[l],i.parentNode&&i.parentNode.removeChild(i),s&&s.forEach(function(e){return e(a)}),t)return t(a)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=p.bind(null,i.onerror),i.onload=p.bind(null,i.onload),r&&document.head.appendChild(i)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p="/"}(),function(){var e={524:0};a.f.j=function(t,l){var s=a.o(e,t)?e[t]:void 0;if(0!==s)if(s)l.push(s[2]);else{var o=new Promise(function(a,l){s=e[t]=[a,l]});l.push(s[2]=o);var n=a.p+a.u(t),i=new Error,r=function(l){if(a.o(e,t)&&(s=e[t],0!==s&&(e[t]=void 0),s)){var o=l&&("load"===l.type?"missing":l.type),n=l&&l.target&&l.target.src;i.message="Loading chunk "+t+" failed.\n("+o+": "+n+")",i.name="ChunkLoadError",i.type=o,i.request=n,s[1](i)}};a.l(n,r,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,l){var s,o,n=l[0],i=l[1],r=l[2],c=0;if(n.some(function(t){return 0!==e[t]})){for(s in i)a.o(i,s)&&(a.m[s]=i[s]);if(r)var u=r(a)}for(t&&t(l);c<n.length;c++)o=n[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(u)},l=self["webpackChunkfppos_vue"]=self["webpackChunkfppos_vue"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=a.O(void 0,[504],function(){return a(3864)});l=a.O(l)})();
//# sourceMappingURL=app.67aac891.js.map